<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>IGA_for_bsplyne.IGAPatch API documentation</title>
            <link rel="icon" href="../logo.png"/>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../IGA_for_bsplyne.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;IGA_for_bsplyne</a>

            <img src="../logo.png" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#IGAPatch">IGAPatch</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#IGAPatch.__init__">IGAPatch</a>
                        </li>
                        <li>
                                <a class="variable" href="#IGAPatch.spline">spline</a>
                        </li>
                        <li>
                                <a class="variable" href="#IGAPatch.ctrl_pts">ctrl_pts</a>
                        </li>
                        <li>
                                <a class="variable" href="#IGAPatch.xi">xi</a>
                        </li>
                        <li>
                                <a class="variable" href="#IGAPatch.dxi">dxi</a>
                        </li>
                        <li>
                                <a class="variable" href="#IGAPatch.eta">eta</a>
                        </li>
                        <li>
                                <a class="variable" href="#IGAPatch.deta">deta</a>
                        </li>
                        <li>
                                <a class="variable" href="#IGAPatch.zeta">zeta</a>
                        </li>
                        <li>
                                <a class="variable" href="#IGAPatch.dzeta">dzeta</a>
                        </li>
                        <li>
                                <a class="variable" href="#IGAPatch.F_N">F_N</a>
                        </li>
                        <li>
                                <a class="variable" href="#IGAPatch.H">H</a>
                        </li>
                        <li>
                                <a class="function" href="#IGAPatch.jacobian">jacobian</a>
                        </li>
                        <li>
                                <a class="function" href="#IGAPatch.grad_N">grad_N</a>
                        </li>
                        <li>
                                <a class="function" href="#IGAPatch.make_W">make_W</a>
                        </li>
                        <li>
                                <a class="function" href="#IGAPatch.stiffness">stiffness</a>
                        </li>
                        <li>
                                <a class="function" href="#IGAPatch.rhs">rhs</a>
                        </li>
                        <li>
                                <a class="function" href="#IGAPatch.area_border">area_border</a>
                        </li>
                        <li>
                                <a class="function" href="#IGAPatch.epsilon">epsilon</a>
                        </li>
                        <li>
                                <a class="function" href="#IGAPatch.sigma">sigma</a>
                        </li>
                        <li>
                                <a class="function" href="#IGAPatch.sigma_eig">sigma_eig</a>
                        </li>
                        <li>
                                <a class="function" href="#IGAPatch.von_mises">von_mises</a>
                        </li>
                        <li>
                                <a class="function" href="#IGAPatch.save_paraview">save_paraview</a>
                        </li>
                        <li>
                                <a class="function" href="#IGAPatch.make_paraview_fields">make_paraview_fields</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#IGAPatchDensity">IGAPatchDensity</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#IGAPatchDensity.__init__">IGAPatchDensity</a>
                        </li>
                        <li>
                                <a class="variable" href="#IGAPatchDensity.d">d</a>
                        </li>
                        <li>
                                <a class="function" href="#IGAPatchDensity.stiffness">stiffness</a>
                        </li>
                        <li>
                                <a class="function" href="#IGAPatchDensity.density">density</a>
                        </li>
                        <li>
                                <a class="function" href="#IGAPatchDensity.sigma">sigma</a>
                        </li>
                        <li>
                                <a class="function" href="#IGAPatchDensity.make_paraview_fields">make_paraview_fields</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../IGA_for_bsplyne.html">IGA_for_bsplyne</a><wbr>.IGAPatch    </h1>

                
                        <input id="mod-IGAPatch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-IGAPatch-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">functools</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">scipy.sparse</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sps</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">bsplyne</span><span class="w"> </span><span class="kn">import</span> <span class="n">BSpline</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="k">class</span><span class="w"> </span><span class="nc">IGAPatch</span><span class="p">:</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="sd">    Local representation of a 3D B-spline patch for linear elasticity.</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="sd">    This class provides the building blocks to compute linear elasticity operators</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="sd">    (stiffness matrix, right-hand side, strain, stress, von Mises stress) for a</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="sd">    single B-spline volume. It is intended **solely as a component of a multipatch</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="sd">    problem** and is not designed to be used as a standalone solver.</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="sd">    Typically, IGAPatch objects are managed by a `ProblemIGA` instance, which</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="sd">    assembles multiple patches, enforces Dirichlet constraints, and solves the</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="sd">    global linear elasticity problem.</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="sd">    Features provided by IGAPatch include:</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">        - computation of the Jacobian and its determinant,</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd">        - gradients of shape functions in physical space,</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">        - linear elastic stiffness matrix assembly for one patch,</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">        - evaluation of prescribed surface forces,</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">        - post-processing quantities such as displacement, strain, stress, and von Mises stress,</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">        - export of results to visualization tools (e.g., ParaView).</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">    Attributes</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">    ----------</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">    spline : BSpline</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">        The 3D B-spline volume representing the patch geometry and shape functions.</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">    ctrl_pts : np.ndarray[np.floating]</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">        Array of control points of shape (3, n_xi, n_eta, n_zeta) defining the patch geometry.</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">    xi : np.ndarray[np.floating]</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">        Isoparametric integration points along the xi direction.</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">    dxi : np.ndarray[np.floating]</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">        Corresponding quadrature weights for xi.</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">    eta : np.ndarray[np.floating]</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">        Isoparametric integration points along the eta direction.</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">    deta : np.ndarray[np.floating]</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">        Corresponding quadrature weights for eta.</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">    zeta : np.ndarray[np.floating]</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">        Isoparametric integration points along the zeta direction.</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">    dzeta : np.ndarray[np.floating]</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">        Corresponding quadrature weights for zeta.</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">    F_N : np.ndarray[np.floating]</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">        Prescribed surface forces, with shape (3 (direction), 2 (side: front/back), 3 (physical components)).</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">        Used for computing the right-hand side vector.</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">    H : np.ndarray[np.floating]</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">        Constitutive matrix in Voigt notation (6x6) for linear isotropic elasticity.</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">        Defined from `E` and `nu`.</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">    Notes</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">    -----</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">    - All integration points are generated using Gaussian quadrature with a number</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">      of points determined from the spline degree.</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">    - This class **does not handle multipatch connectivity or global constraints**.</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">      Use `ProblemIGA` to assemble and solve multipatch problems.</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">    - Post-processing quantities can be evaluated at the integration points or exported</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">      to visualization tools like ParaView.</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>    <span class="n">spline</span><span class="p">:</span> <span class="n">BSpline</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>    <span class="n">ctrl_pts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>    <span class="n">xi</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>    <span class="n">dxi</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>    <span class="n">eta</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>    <span class="n">deta</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>    <span class="n">zeta</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>    <span class="n">dzeta</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>    <span class="n">F_N</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>    <span class="n">H</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>        <span class="n">spline</span><span class="p">:</span> <span class="n">BSpline</span><span class="p">,</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>        <span class="n">ctrl_pts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>        <span class="n">E</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>        <span class="n">nu</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>        <span class="n">F_N</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">),</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>    <span class="p">):</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">        Initialize a local `IGAPatch` for linear elasticity computations.</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">        This constructor sets up all necessary information for assembling</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">        the stiffness matrix and right-hand side for a single B-spline patch.</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">        Note that `IGAPatch` objects are intended to be used as components of</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">        a `ProblemIGA` multipatch object, and are **not standalone solvers**.</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">        Parameters</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">        ----------</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">        spline : BSpline</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">            The 3D B-spline volume defining the patch geometry and the shape</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">            functions. Provides methods to compute basis functions and derivatives.</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">        ctrl_pts : np.ndarray[np.floating]</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">            Array of control points defining the patch geometry.</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd">            Shape should be (3, n_xi, n_eta, n_zeta) corresponding to</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd">            (physical_dim, n_ctrl_pts_xi, n_ctrl_pts_eta, n_ctrl_pts_zeta).</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">        E : float</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="sd">            Young&#39;s modulus of the material.</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="sd">        nu : float</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">            Poisson&#39;s ratio of the material.</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="sd">        F_N : np.ndarray[np.floating], optional</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">            Prescribed surface forces applied on the patch boundaries.</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">            Shape should be (3 (direction: x, y, z), 2 (side: front/back), 3 (physical components)),</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">            representing forces at the integration points on each face. Default is zero (no surface forces).</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">        Attributes set</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">        ----------------</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">        H : np.ndarray[np.floating]</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">            66 constitutive matrix in Voigt notation, built from `E` and `nu`.</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="sd">        xi, eta, zeta : np.ndarray[np.floating]</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">            Isoparametric coordinates for Gaussian quadrature in each direction.</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="sd">        dxi, deta, dzeta : np.ndarray[np.floating]</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="sd">            Quadrature weights associated with the isoparametric coordinates.</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="sd">        F_N : np.ndarray[np.floating]</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="sd">            Prescribed surface forces, stored for use in the rhs computation.</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="sd">        Notes</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="sd">        -----</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">        - Quadrature points and weights are automatically generated using</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a><span class="sd">        `spline.gauss_legendre_for_integration` with `degree+1` points.</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="sd">        - The constitutive matrix `H` assumes linear isotropic elasticity in Voigt notation.</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a><span class="sd">        - This patch only defines the local operators; global assembly and</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="sd">        enforcement of boundary conditions are handled by `ProblemIGA`.</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">spline</span> <span class="o">=</span> <span class="n">spline</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span> <span class="o">=</span> <span class="n">ctrl_pts</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>                <span class="p">[</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>                    <span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">nu</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>                    <span class="p">[</span><span class="n">nu</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">nu</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>                    <span class="p">[</span><span class="n">nu</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">nu</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>                    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">-</span> <span class="n">nu</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>                    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">-</span> <span class="n">nu</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>                    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">-</span> <span class="n">nu</span><span class="p">)],</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>                <span class="p">],</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>                <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>            <span class="p">)</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>            <span class="o">*</span> <span class="n">E</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>            <span class="o">/</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">nu</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nu</span><span class="p">))</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>        <span class="p">)</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>        <span class="n">xi_eta_zeta_pts_pds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">gauss_legendre_for_integration</span><span class="p">(</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">getDegrees</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>        <span class="p">)</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>        <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeta</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dxi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dzeta</span><span class="p">))</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>            <span class="n">xi_eta_zeta_pts_pds</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>        <span class="p">)</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">F_N</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>            <span class="n">F_N</span>  <span class="c1"># shape (3 (xi, eta, or zeta), 2 (front or back), 3 (vector (x, y, z)))</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>        <span class="p">)</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">jacobian</span><span class="p">(</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">dN_dXI</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">,</span> <span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">,</span> <span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">]</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>    <span class="p">]:</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="sd">        Compute the Jacobian matrix of the mapping from parametric to physical space,</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a><span class="sd">        its inverse, and its determinant at all integration points.</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="sd">        The Jacobian describes how the parametric (xi, eta, zeta) coordinates</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">        are mapped to physical coordinates using the patch&#39;s control points.</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">        Parameters</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="sd">        ----------</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="sd">        dN_dXI : tuple[sps.spmatrix, sps.spmatrix, sps.spmatrix]</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">            Derivatives of the shape functions with respect to the parametric coordinates.</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="sd">            Tuple of sparse matrices `(dN_dxi, dN_deta, dN_dzeta)`, each of shape</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="sd">            (n_intg_pts, n_ctrl_pts).</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="sd">        Returns</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="sd">        -------</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="sd">        J : np.ndarray[np.floating]</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a><span class="sd">            Jacobian matrices at each integration point,</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="sd">            shape `(3, 3, n_intg_pts)` corresponding to (physical_dim, param_dim, n_intg_pts).</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a><span class="sd">        Jinv : np.ndarray[np.floating]</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="sd">            Inverse of the Jacobian matrices, shape `(3, 3, n_intg_pts)` corresponding to</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="sd">            (param_dim, physical_dim, n_intg_pts).</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a><span class="sd">        detJ : np.ndarray[np.floating]</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a><span class="sd">            Determinant of the Jacobian at each integration point, shape `(n_intg_pts,)`.</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a><span class="sd">        Notes</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a><span class="sd">        -----</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a><span class="sd">        - `J[:, :, i]` gives the 33 Jacobian matrix at the i-th integration point.</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a><span class="sd">        - `Jinv[:, :, i]` is the inverse of that matrix, used to compute derivatives</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a><span class="sd">        with respect to physical coordinates.</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a><span class="sd">        - `detJ[i]` is the determinant of `J[:, :, i]`, used for integration weights.</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>        <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>            <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">@</span> <span class="n">dN_dxi</span><span class="o">.</span><span class="n">T</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="k">for</span> <span class="n">dN_dxi</span> <span class="ow">in</span> <span class="n">dN_dXI</span><span class="p">],</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>        <span class="p">)</span>  <span class="c1"># shape(3(phy), 3(param), nb_intg_pts)</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>        <span class="n">Jinv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">J</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>        <span class="p">)</span>  <span class="c1"># shape(3(param), 3(phy), nb_intg_pts)</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>        <span class="n">detJ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">J</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>  <span class="c1"># vector of nb_intg_pts values</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>        <span class="k">return</span> <span class="n">J</span><span class="p">,</span> <span class="n">Jinv</span><span class="p">,</span> <span class="n">detJ</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">grad_N</span><span class="p">(</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>        <span class="n">Jinv</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>        <span class="n">dN_dXI</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">,</span> <span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">,</span> <span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">],</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">object_</span><span class="p">]:</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a><span class="sd">        Compute the gradient of the B-spline shape functions with respect to physical coordinates.</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a><span class="sd">        The gradient is obtained by applying the chain rule:</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a><span class="sd">            dN/dX_i = [J]_ij @ dN/dXI_j</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a><span class="sd">        for each integration point.</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="sd">        Parameters</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="sd">        ----------</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="sd">        Jinv : np.ndarray[np.floating]</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a><span class="sd">            Inverse Jacobian matrices at all integration points,</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">            shape `(3, 3, n_intg_pts)` corresponding to (param_dim, physical_dim, n_intg_pts).</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a><span class="sd">        dN_dXI : tuple[sps.spmatrix, sps.spmatrix, sps.spmatrix]</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a><span class="sd">            Derivatives of shape functions with respect to parametric coordinates</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a><span class="sd">            `(dN_dxi, dN_deta, dN_dzeta)`.</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a><span class="sd">            Each sparse matrix has shape `(n_intg_pts, n_ctrl_pts)`.</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a><span class="sd">        Returns</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a><span class="sd">        -------</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a><span class="sd">        dN_dX : np.ndarray[np.object_]</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="sd">            Gradients of the shape functions with respect to physical coordinates.</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="sd">            Numpy array of shape `(3,)`, where each element is a `sps.spmatrix` of shape</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a><span class="sd">            `(n_intg_pts, n_ctrl_pts)` corresponding to the derivative along each physical axis.</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a><span class="sd">        Notes</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a><span class="sd">        -----</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a><span class="sd">        - `dN_dX[i]` gives the derivative of all shape functions along the i-th physical direction</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="sd">        at all integration points.</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="sd">        - Each sparse matrix can be directly used in the assembly of the stiffness matrix or other</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a><span class="sd">        integrals over the physical domain.</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a><span class="sd">        - The use of `np.object_` array allows each entry to hold a separate sparse matrix.</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>        <span class="n">dN_dX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>            <span class="p">[</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>                <span class="nb">sum</span><span class="p">([</span><span class="n">dN_dXI</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">Jinv</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>            <span class="p">]</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>        <span class="p">)</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>        <span class="k">return</span> <span class="n">dN_dX</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">make_W</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detJ</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]:</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a><span class="sd">        Compute the integration weights in physical space for Gaussian quadrature.</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a><span class="sd">        The integration measure W at each quadrature point combines:</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a><span class="sd">        1. The local volume scaling from the Jacobian determinant `detJ`.</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a><span class="sd">        2. The parametric quadrature weights (`dxi`, `deta`, `dzeta`) in each direction.</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a><span class="sd">        Mathematically:</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a><span class="sd">            W = |detJ| * dxi  deta  dzeta</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a><span class="sd">        with * the pointwise multiplication and  the Kronecker product.</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a><span class="sd">        Parameters</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a><span class="sd">        ----------</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a><span class="sd">        detJ : np.ndarray[np.floating]</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a><span class="sd">            Determinant of the Jacobian at each integration point.</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a><span class="sd">            Shape: (n_intg_pts,)</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a><span class="sd">        Returns</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a><span class="sd">        -------</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a><span class="sd">        W : np.ndarray[np.floating]</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a><span class="sd">            Integration weights in physical space for each quadrature point.</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="sd">            Shape: (n_intg_pts,)</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">detJ</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dxi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deta</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dzeta</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>        <span class="k">return</span> <span class="n">W</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">stiffness</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">:</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a><span class="sd">        Compute the linear elasticity stiffness matrix for this IGAPatch.</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a><span class="sd">        This method constructs the 3D linear elasticity stiffness matrix</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a><span class="sd">        using Gaussian quadrature in the parametric space of the B-spline patch.</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a><span class="sd">        The computation follows standard isogeometric analysis (IGA) procedure:</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a><span class="sd">        1. Evaluate the derivatives of the B-spline shape functions with respect to</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a><span class="sd">        the parametric coordinates (dN/dXI).</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a><span class="sd">        2. Compute the Jacobian, its inverse, and determinant at all integration points.</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a><span class="sd">        3. Transform shape function derivatives to the physical space (dN/dX).</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a><span class="sd">        4. Build the strain-displacement matrices B (Bxx, Byy, Bzz, Bxy, Byz, Bxz).</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a><span class="sd">        5. Assemble the stiffness contributions using the material elasticity tensor H</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a><span class="sd">        and the integration weights W derived from the Jacobian.</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a><span class="sd">        6. Sum all contributions to obtain the global stiffness matrix `K`.</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a><span class="sd">        Returns</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a><span class="sd">        -------</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a><span class="sd">        K : sps.spmatrix</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a><span class="sd">            Sparse stiffness matrix of the patch.</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a><span class="sd">            Shape: (3 * n_ctrl_pts, 3 * n_ctrl_pts), in physical coordinates.</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>        <span class="n">dN_dXI</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">DN</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeta</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">Jinv</span><span class="p">,</span> <span class="n">detJ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jacobian</span><span class="p">(</span><span class="n">dN_dXI</span><span class="p">)</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>        <span class="n">dN_dx</span><span class="p">,</span> <span class="n">dN_dy</span><span class="p">,</span> <span class="n">dN_dz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grad_N</span><span class="p">(</span><span class="n">Jinv</span><span class="p">,</span> <span class="n">dN_dXI</span><span class="p">)</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_W</span><span class="p">(</span><span class="n">detJ</span><span class="p">)</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>        <span class="c1"># B = sps.bmat([[dN_dx, None, None],</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>        <span class="c1">#               [None, dN_dy, None],</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>        <span class="c1">#               [None, None, dN_dz],</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>        <span class="c1">#               [dN_dy, dN_dx, None],</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>        <span class="c1">#               [None, dN_dz, dN_dy],</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>        <span class="c1">#               [dN_dz, None, dN_dx]])</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>        <span class="n">Z</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">coo_matrix</span><span class="p">(</span><span class="n">dN_dx</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>        <span class="n">Bxx</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">dN_dx</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">Z</span><span class="p">))</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>        <span class="n">Byy</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Z</span><span class="p">,</span> <span class="n">dN_dy</span><span class="p">,</span> <span class="n">Z</span><span class="p">))</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>        <span class="n">Bzz</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Z</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">dN_dz</span><span class="p">))</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>        <span class="n">Bxy</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">dN_dy</span><span class="p">,</span> <span class="n">dN_dx</span><span class="p">,</span> <span class="n">Z</span><span class="p">))</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>        <span class="n">Byz</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Z</span><span class="p">,</span> <span class="n">dN_dz</span><span class="p">,</span> <span class="n">dN_dy</span><span class="p">))</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>        <span class="n">Bxz</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">dN_dz</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">dN_dx</span><span class="p">))</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>        <span class="n">K0</span> <span class="o">=</span> <span class="n">Bxx</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bzz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxz</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>        <span class="n">K1</span> <span class="o">=</span> <span class="n">Byy</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bzz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxz</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>        <span class="n">K2</span> <span class="o">=</span> <span class="n">Bzz</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bzz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxz</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>        <span class="n">K3</span> <span class="o">=</span> <span class="n">Bxy</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bzz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxz</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>        <span class="n">K4</span> <span class="o">=</span> <span class="n">Byz</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bzz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxz</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>        <span class="n">K5</span> <span class="o">=</span> <span class="n">Bxz</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bzz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxz</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>        <span class="n">K</span><span class="p">:</span> <span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">K0</span><span class="p">,</span> <span class="n">K1</span><span class="p">,</span> <span class="n">K2</span><span class="p">,</span> <span class="n">K3</span><span class="p">,</span> <span class="n">K4</span><span class="p">,</span> <span class="n">K5</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>        <span class="k">return</span> <span class="n">K</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">rhs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]:</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a><span class="sd">        Compute the right-hand side (load) vector for this `IGAPatch`.</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a><span class="sd">        This method assembles the contribution of the surface forces applied on the</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a><span class="sd">        patch boundary. It uses Gaussian quadrature along the patch faces where</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a><span class="sd">        forces are defined. The procedure is:</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a><span class="sd">        1. Loop over each physical axis (x, y, z) and each side of the patch (0=lower, 1=upper).</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a><span class="sd">        2. Skip faces with zero surface forces.</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a><span class="sd">        3. For each face with a force:</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a><span class="sd">            a. Select the isoparametric coordinate corresponding to the face.</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a><span class="sd">            b. Compute the shape functions `N` and their derivatives along the face.</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a><span class="sd">            c. Compute the surface measure `dS` using the cross product of</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a><span class="sd">                tangent vectors to the surface and parametric quadrature weights.</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a><span class="sd">            d. Integrate the contribution of the shape functions over the surface.</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a><span class="sd">        4. Sum all face contributions into the global right-hand side vector.</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a><span class="sd">        Returns</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a><span class="sd">        -------</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a><span class="sd">        rhs : np.ndarray[np.floating]</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a><span class="sd">            Right-hand side vector for the patch.</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a><span class="sd">            Shape: (3 * n_ctrl_pts,), in physical coordinates.</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>        <span class="n">rhs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>        <span class="n">XI</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeta</span><span class="p">]</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>        <span class="n">dXI</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dxi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dzeta</span><span class="p">]</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>        <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>            <span class="k">for</span> <span class="n">side</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">F_N</span><span class="p">[</span><span class="n">axis</span><span class="p">,</span> <span class="n">side</span><span class="p">],</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>                    <span class="n">xi</span> <span class="o">=</span> <span class="p">[</span><span class="n">xi_i</span> <span class="k">for</span> <span class="n">xi_i</span> <span class="ow">in</span> <span class="n">XI</span><span class="p">]</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>                    <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>                        <span class="n">xi</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">bases</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>                        <span class="n">xi</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">bases</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>                    <span class="n">dxi</span> <span class="o">=</span> <span class="p">[</span><span class="n">dxi_i</span> <span class="k">for</span> <span class="n">dxi_i</span> <span class="ow">in</span> <span class="n">dXI</span><span class="p">]</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>                    <span class="n">dxi</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>                    <span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">DN</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>                    <span class="n">k1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)[(</span><span class="n">axis</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>                    <span class="n">k2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)[(</span><span class="n">axis</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>                    <span class="n">dX1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>                    <span class="n">dX2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k2</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>                    <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">dX1</span><span class="p">,</span> <span class="n">dX2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>                    <span class="n">dxi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">dxi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">dxi</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dxi</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>                    <span class="n">dS</span> <span class="o">=</span> <span class="n">J</span> <span class="o">*</span> <span class="n">dxi</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>                    <span class="n">intg</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">dS</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>                    <span class="n">rhs</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">F_N</span><span class="p">[</span><span class="n">axis</span><span class="p">,</span> <span class="n">side</span><span class="p">],</span> <span class="n">intg</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>        <span class="k">return</span> <span class="n">rhs</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">area_border</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">front_side</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a><span class="sd">        Compute the total surface area of a patch face across a given axis.</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a><span class="sd">        The face is defined by fixing one parametric coordinate (`xi`, `eta`, or `zeta`)</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a><span class="sd">        to either its front or back boundary. The surface area is computed by</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a><span class="sd">        integrating the differential surface measure over the face using</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a><span class="sd">        the Gaussian quadrature points and weights.</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a><span class="sd">        Parameters</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a><span class="sd">        ----------</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a><span class="sd">        axis : int</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a><span class="sd">            Axis across which the face is oriented:</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a><span class="sd">            0  xi, 1  eta, 2  zeta.</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a><span class="sd">        front_side : bool</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a><span class="sd">            If True, select the &quot;front&quot; boundary across the given axis;</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a><span class="sd">            otherwise, select the &quot;back&quot; boundary.</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a><span class="sd">        Returns</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a><span class="sd">        -------</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a><span class="sd">        area : float</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a><span class="sd">            Total surface area of the specified patch face in physical space.</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>        <span class="n">XI</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeta</span><span class="p">]</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>        <span class="n">xi</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>            <span class="p">(</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>                <span class="n">XI</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>                <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">axis</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>                <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>                    <span class="p">[</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>                        <span class="p">(</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">bases</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>                            <span class="k">if</span> <span class="n">front_side</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>                            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">bases</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>                        <span class="p">)</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>                    <span class="p">]</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>                <span class="p">)</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>            <span class="p">)</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>        <span class="p">]</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>        <span class="n">dXI</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dxi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dzeta</span><span class="p">]</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>        <span class="n">dxi</span> <span class="o">=</span> <span class="p">[</span><span class="n">dXI</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">axis</span><span class="p">]</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>        <span class="n">dN1</span><span class="p">,</span> <span class="n">dN2</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">DN</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>            <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>            <span class="k">if</span> <span class="n">ax</span> <span class="o">!=</span> <span class="n">axis</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>        <span class="p">]</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>        <span class="n">dSdXI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">@</span> <span class="n">dN1</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">@</span> <span class="n">dN2</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>                <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>            <span class="p">),</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>            <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>        <span class="p">)</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>        <span class="n">dXI_area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="o">*</span><span class="n">dxi</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>        <span class="n">area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dSdXI</span><span class="p">,</span> <span class="n">dXI_area</span><span class="p">)</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>        <span class="k">return</span> <span class="n">area</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">epsilon</span><span class="p">(</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">U</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="n">XI</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]]</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]:</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a><span class="sd">        Compute the strain tensor in Voigt notation for the patch.</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a><span class="sd">        The strain tensor is computed as:</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a><span class="sd">            eps = [_xx, _yy, _zz, _xy, _yz, _xz]^T</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a><span class="sd">        using the displacement field `U` and the isoparametric coordinates `XI`.</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a><span class="sd">        Small adjustments are applied at the parametric boundaries to avoid</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a><span class="sd">        evaluation exactly on the control point spans.</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a><span class="sd">        Parameters</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a><span class="sd">        ----------</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a><span class="sd">        U : np.ndarray[np.floating]</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a><span class="sd">            Displacement field of shape (3, nb_ctrl_pts), with the first dimension</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a><span class="sd">            corresponding to the physical coordinates (x, y, z).</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a><span class="sd">        XI : list[np.ndarray[np.floating]]</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a><span class="sd">            List of arrays for the parametric coordinates in each direction</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a><span class="sd">            [xi, eta, zeta].</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a><span class="sd">        Returns</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a><span class="sd">        -------</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a><span class="sd">        eps : np.ndarray[np.floating]</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a><span class="sd">            Strain tensor in Voigt notation, shape (6, n_param_pts),</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a><span class="sd">            where n_param_pts = product of lengths of XI arrays.</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>        <span class="k">for</span> <span class="n">xi</span><span class="p">,</span> <span class="n">basis</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">XI</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">bases</span><span class="p">):</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>            <span class="n">xi</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">basis</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)]</span> <span class="o">+=</span> <span class="mf">1e-5</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>            <span class="n">xi</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">basis</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)]</span> <span class="o">-=</span> <span class="mf">1e-5</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>        <span class="n">dN_dXI</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">DN</span><span class="p">(</span><span class="n">XI</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">Jinv</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jacobian</span><span class="p">(</span><span class="n">dN_dXI</span><span class="p">)</span>  <span class="c1"># dXI_dX</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>        <span class="n">dN_dx</span><span class="p">,</span> <span class="n">dN_dy</span><span class="p">,</span> <span class="n">dN_dz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grad_N</span><span class="p">(</span><span class="n">Jinv</span><span class="p">,</span> <span class="n">dN_dXI</span><span class="p">)</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>        <span class="n">eps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>            <span class="p">[</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>                <span class="n">dN_dx</span> <span class="o">@</span> <span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>                <span class="n">dN_dy</span> <span class="o">@</span> <span class="n">U</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>                <span class="n">dN_dz</span> <span class="o">@</span> <span class="n">U</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>                <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">dN_dy</span> <span class="o">@</span> <span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="o">+</span> <span class="n">dN_dx</span> <span class="o">@</span> <span class="n">U</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()),</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>                <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">dN_dz</span> <span class="o">@</span> <span class="n">U</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="o">+</span> <span class="n">dN_dy</span> <span class="o">@</span> <span class="n">U</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()),</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>                <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">dN_dz</span> <span class="o">@</span> <span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="o">+</span> <span class="n">dN_dx</span> <span class="o">@</span> <span class="n">U</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()),</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>            <span class="p">]</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>        <span class="p">)</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>        <span class="k">return</span> <span class="n">eps</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">sigma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eps</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]:</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a><span class="sd">        Compute the stress tensor in Voigt notation for the patch.</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a><span class="sd">        The stress tensor is computed as:</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a><span class="sd">            sigma = H @ eps</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a><span class="sd">        where H is the linear elasticity matrix of the material.</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a><span class="sd">        Parameters</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a><span class="sd">        ----------</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a><span class="sd">        eps : np.ndarray[np.floating]</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a><span class="sd">            Strain tensor in Voigt notation, shape (6, n_param_pts).</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a><span class="sd">        Returns</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a><span class="sd">        -------</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a><span class="sd">        sig : np.ndarray[np.floating]</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a><span class="sd">            Stress tensor in Voigt notation, shape (6, n_param_pts).</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>        <span class="n">eps</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span> <span class="o">*=</span> <span class="mi">2</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>        <span class="n">sig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">@</span> <span class="n">eps</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>        <span class="k">return</span> <span class="n">sig</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">sigma_eig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]:</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a><span class="sd">        Compute the principal stresses (eigenvalues of the stress tensor)</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a><span class="sd">        at the specified parametric points.</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a><span class="sd">        The stress tensor is first converted from Voigt notation to</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a><span class="sd">        full 3x3 tensors before computing eigenvalues.</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a><span class="sd">        Parameters</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a><span class="sd">        ----------</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a><span class="sd">        sig : np.ndarray[np.floating]</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a><span class="sd">            Stress tensor in Voigt notation, shape (6, n_param_pts).</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a><span class="sd">        Returns</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a><span class="sd">        -------</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a><span class="sd">        sig_eig : np.ndarray[np.floating]</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a><span class="sd">            Principal stresses (eigenvalues) of shape (n_param_pts, 3),</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a><span class="sd">            sorted by magnitude.</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>        <span class="n">sig</span> <span class="o">=</span> <span class="n">sig</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])]</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>        <span class="n">sig_eig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvalsh</span><span class="p">(</span><span class="n">sig</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>        <span class="n">order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sig_eig</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>        <span class="n">sig_eig</span> <span class="o">=</span> <span class="n">sig_eig</span><span class="p">[</span><span class="n">order</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">sig_eig</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="kc">None</span><span class="p">]]</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>        <span class="k">return</span> <span class="n">sig_eig</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">von_mises</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig_eig</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]:</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a><span class="sd">        Compute the von Mises equivalent stress at the specified parametric points.</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a><span class="sd">        The von Mises stress is computed from the principal stresses (eigenvalues</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a><span class="sd">        of the stress tensor) as a scalar measure of the deviatoric stress.</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a><span class="sd">        Parameters</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a><span class="sd">        ----------</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a><span class="sd">        sig_eig : np.ndarray[np.floating]</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a><span class="sd">            Principal stresses (eigenvalues) of shape (n_param_pts, 3),</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a><span class="sd">            sorted by magnitude.</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a><span class="sd">        Returns</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a><span class="sd">        -------</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a><span class="sd">        vm : np.ndarray[np.floating]</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a><span class="sd">            Von Mises stress at each parametric point, shape (n_param_pts,).</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>        <span class="n">vm</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>            <span class="n">sig_eig</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">sig_eig</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>        <span class="p">)</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>        <span class="k">return</span> <span class="n">vm</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_paraview</span><span class="p">(</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>        <span class="n">U</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>        <span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>    <span class="p">):</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a><span class="sd">        Export the patch data to a ParaView-readable format.</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a><span class="sd">        The saved data includes the displacement field and derived fields</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a><span class="sd">        (strain, stress, principal stresses, von Mises stress) for visualization.</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a><span class="sd">        Parameters</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a><span class="sd">        ----------</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a><span class="sd">        U : np.ndarray[np.floating]</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a><span class="sd">            Displacement field, shape (3, nb_ctrl_pts), with physical coordinates first.</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a><span class="sd">        path : str</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a><span class="sd">            Directory path where the ParaView file will be saved.</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a><span class="sd">        name : str</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a><span class="sd">            Base name of the saved file.</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a><span class="sd">        n_eval_per_elem : int, optional</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a><span class="sd">            Number of evaluation points per element in each parametric direction</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a><span class="sd">            (higher values produce smoother visualizations). Default is 10.</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>        <span class="n">XI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">n_eval_per_elem</span><span class="p">)</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a>        <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_paraview_fields</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">XI</span><span class="p">)</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">saveParaview</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">XI</span><span class="o">=</span><span class="n">XI</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">)</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">make_paraview_fields</span><span class="p">(</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">U</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="n">XI</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]]</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]]:</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a><span class="sd">        Generate fields for visualization in ParaView from the displacement field.</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a><span class="sd">        This function computes the following fields:</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a><span class="sd">            - Displacement `U`</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a><span class="sd">            - Strain tensor `epsilon` in Voigt notation</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a><span class="sd">            - Stress tensor `sigma` in Voigt notation</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a><span class="sd">            - Principal stresses `sigma_eig`</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a><span class="sd">            - Von Mises stress `von_mises`</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a><span class="sd">        The resulting arrays are reshaped to match the expected ParaView format:</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a><span class="sd">            - The first dimension is for potential time/step (here 1)</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a><span class="sd">            - Subsequent dimensions correspond to physical or Voigt components,</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a><span class="sd">            followed by the parametric grid shape defined by `XI`.</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a><span class="sd">        Parameters</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a><span class="sd">        ----------</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a><span class="sd">        U : np.ndarray[np.floating]</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a><span class="sd">            Displacement field of shape (3, nb_ctrl_pts), with the first dimension</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a><span class="sd">            corresponding to physical coordinates (x, y, z).</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a><span class="sd">        XI : list[np.ndarray[np.floating]]</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a><span class="sd">            List of parametric coordinates for each direction [xi, eta, zeta].</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a><span class="sd">            Determines the evaluation grid for the derived fields.</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a><span class="sd">        Returns</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a><span class="sd">        -------</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a><span class="sd">        fields : dict[str, np.ndarray[np.floating]]</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a><span class="sd">            Dictionary of fields ready for ParaView, with the following shapes:</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a><span class="sd">                - &quot;U&quot; : shape (1, 3, nxi, neta, nzeta)</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a><span class="sd">                - &quot;epsilon&quot; : shape (1, 6, nxi, neta, nzeta)</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a><span class="sd">                - &quot;sigma&quot; : shape (1, 6, nxi, neta, nzeta)</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a><span class="sd">                - &quot;sigma_eig&quot; : shape (1, 3, nxi, neta, nzeta)</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a><span class="sd">                - &quot;von_mises&quot; : shape (1, 1, nxi, neta, nzeta)</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a><span class="sd">            where (nxi, neta, nzeta) = tuple(xi.size for xi in XI)</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a>        <span class="n">epsilon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">XI</span><span class="p">)</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a>        <span class="n">sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">(</span><span class="n">epsilon</span><span class="p">)</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a>        <span class="n">sigma_eig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_eig</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a>        <span class="n">von_mises</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">von_mises</span><span class="p">(</span><span class="n">sigma_eig</span><span class="p">)</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a>        <span class="n">XI_shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">xi</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">XI</span><span class="p">)</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a>        <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a>            <span class="s2">&quot;U&quot;</span><span class="p">:</span> <span class="n">u</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a>            <span class="s2">&quot;epsilon&quot;</span><span class="p">:</span> <span class="n">epsilon</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="n">XI_shape</span><span class="p">)),</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a>            <span class="s2">&quot;sigma&quot;</span><span class="p">:</span> <span class="n">sigma</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="n">XI_shape</span><span class="p">)),</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a>            <span class="s2">&quot;sigma_eig&quot;</span><span class="p">:</span> <span class="n">sigma_eig</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">*</span><span class="n">XI_shape</span><span class="p">)),</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a>            <span class="s2">&quot;von_mises&quot;</span><span class="p">:</span> <span class="n">von_mises</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">XI_shape</span><span class="p">)),</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a>        <span class="p">}</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a>        <span class="k">return</span> <span class="n">fields</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a><span class="k">class</span><span class="w"> </span><span class="nc">IGAPatchDensity</span><span class="p">(</span><span class="n">IGAPatch</span><span class="p">):</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a><span class="sd">    Density-weighted representation of a 3D B-spline patch for linear elasticity.</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a><span class="sd">    This class extends :py:class:`IGAPatch` by allowing a spatially varying</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a><span class="sd">    material density. The density field is defined at the control points and</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a><span class="sd">    interpolated over the parametric domain, scaling the constitutive matrix locally</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a><span class="sd">    for both stiffness assembly and stress evaluation.</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a><span class="sd">    IGAPatchDensity is intended as a component of a multipatch problem and is</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a><span class="sd">    not a standalone solver. Typically, objects of this class are managed by a</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a><span class="sd">    `ProblemIGA` instance that assembles multiple patches, enforces Dirichlet</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a><span class="sd">    constraints, and solves the global elasticity problem.</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a><span class="sd">    Features provided by IGAPatchDensity include:</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a><span class="sd">        - computation of the Jacobian and its determinant,</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a><span class="sd">        - gradients of shape functions in physical space,</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a><span class="sd">        - density-weighted linear elastic stiffness matrix assembly,</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a><span class="sd">        - evaluation of prescribed surface forces,</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a><span class="sd">        - post-processing quantities such as displacement, strain, stress,</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a><span class="sd">        principal stresses, von Mises stress, and local density,</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a><span class="sd">        - export of results to visualization tools (e.g., ParaView).</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a>
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a><span class="sd">    Attributes</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a><span class="sd">    ----------</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos">655</span></a><span class="sd">    spline : BSpline</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos">656</span></a><span class="sd">        The 3D B-spline volume representing the patch geometry and shape functions.</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos">657</span></a><span class="sd">    ctrl_pts : np.ndarray[np.floating]</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos">658</span></a><span class="sd">        Array of control points of shape (3, n_xi, n_eta, n_zeta) defining the patch geometry.</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos">659</span></a><span class="sd">    xi : np.ndarray[np.floating]</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos">660</span></a><span class="sd">        Isoparametric integration points along the xi direction.</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos">661</span></a><span class="sd">    dxi : np.ndarray[np.floating]</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos">662</span></a><span class="sd">        Corresponding quadrature weights for xi.</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos">663</span></a><span class="sd">    eta : np.ndarray[np.floating]</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos">664</span></a><span class="sd">        Isoparametric integration points along the eta direction.</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos">665</span></a><span class="sd">    deta : np.ndarray[np.floating]</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos">666</span></a><span class="sd">        Corresponding quadrature weights for eta.</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos">667</span></a><span class="sd">    zeta : np.ndarray[np.floating]</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos">668</span></a><span class="sd">        Isoparametric integration points along the zeta direction.</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos">669</span></a><span class="sd">    dzeta : np.ndarray[np.floating]</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos">670</span></a><span class="sd">        Corresponding quadrature weights for zeta.</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos">671</span></a><span class="sd">    F_N : np.ndarray[np.floating]</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos">672</span></a><span class="sd">        Prescribed surface forces, shape (3 (direction), 2 (side: front/back), 3 (physical components)),</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos">673</span></a><span class="sd">        used for computing the right-hand side vector.</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos">674</span></a><span class="sd">    H : np.ndarray[np.floating]</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos">675</span></a><span class="sd">        Constitutive matrix in Voigt notation (6x6) for linear isotropic elasticity.</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos">676</span></a><span class="sd">        Defined from `E` and `nu`.</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos">677</span></a><span class="sd">    d : np.ndarray[np.floating]</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos">678</span></a><span class="sd">        Density field expressed in the B-spline basis, used to scale the</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos">679</span></a><span class="sd">        constitutive matrix locally. At evaluation, values are clipped to [0, 1].</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos">680</span></a>
</span><span id="L-681"><a href="#L-681"><span class="linenos">681</span></a><span class="sd">    Notes</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos">682</span></a><span class="sd">    -----</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos">683</span></a><span class="sd">    - All integration points are generated using Gaussian quadrature with a number</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos">684</span></a><span class="sd">    of points determined from the spline degree.</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos">685</span></a><span class="sd">    - The density field modifies the stiffness and stress at each integration point.</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos">686</span></a><span class="sd">    - This class does not handle multipatch connectivity or global constraints.</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos">687</span></a><span class="sd">    Use `ProblemIGA` to assemble and solve multipatch problems.</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos">688</span></a><span class="sd">    - Post-processing quantities can be evaluated at the integration points or exported</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos">689</span></a><span class="sd">    to visualization tools like ParaView.</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos">690</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos">691</span></a>
</span><span id="L-692"><a href="#L-692"><span class="linenos">692</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos">693</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos">694</span></a>        <span class="n">spline</span><span class="p">:</span> <span class="n">BSpline</span><span class="p">,</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos">695</span></a>        <span class="n">ctrl_pts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos">696</span></a>        <span class="n">E</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos">697</span></a>        <span class="n">nu</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos">698</span></a>        <span class="n">d</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos">699</span></a>        <span class="n">F_N</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">),</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos">700</span></a>    <span class="p">):</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos">701</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos">702</span></a><span class="sd">        Initialize a density-weighted IGA patch.</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos">703</span></a>
</span><span id="L-704"><a href="#L-704"><span class="linenos">704</span></a><span class="sd">        This constructor extends :py:meth:`IGAPatch.__init__` by introducing</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos">705</span></a><span class="sd">        a control-point-based density field and by initializing Gaussian</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos">706</span></a><span class="sd">        quadrature points for volumetric integration including the density field.</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos">707</span></a>
</span><span id="L-708"><a href="#L-708"><span class="linenos">708</span></a><span class="sd">        The density field is reshaped to match the control point grid.</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos">709</span></a>
</span><span id="L-710"><a href="#L-710"><span class="linenos">710</span></a><span class="sd">        Parameters</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos">711</span></a><span class="sd">        ----------</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos">712</span></a><span class="sd">        spline : BSpline</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos">713</span></a><span class="sd">            B-spline volume defining the parametric domain.</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos">714</span></a><span class="sd">        ctrl_pts : np.ndarray[np.floating]</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos">715</span></a><span class="sd">            Control points defining the patch geometry.</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos">716</span></a><span class="sd">        E : float</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos">717</span></a><span class="sd">            Young&#39;s modulus of the material.</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos">718</span></a><span class="sd">        nu : float</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos">719</span></a><span class="sd">            Poisson&#39;s ratio of the material.</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos">720</span></a><span class="sd">        d : np.ndarray[np.floating]</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos">721</span></a><span class="sd">            Density field expressed in the B-spline basis.</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos">722</span></a><span class="sd">            Evaluated density (N @ d) will be clipped to the range [0, 1].</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos">723</span></a><span class="sd">        F_N : np.ndarray[np.floating], optional</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos">724</span></a><span class="sd">            Surfacic Neumann forces applied on the patch boundaries.</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos">725</span></a><span class="sd">            Shape: (3, 2, 3). Default is zero.</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos">726</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos">727</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">spline</span><span class="p">,</span> <span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">F_N</span><span class="p">)</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos">728</span></a>        <span class="n">xi_eta_zeta_pts_pds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">gauss_legendre_for_integration</span><span class="p">(</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos">729</span></a>            <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">getDegrees</span><span class="p">())</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos">730</span></a>        <span class="p">)</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos">731</span></a>        <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeta</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dxi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dzeta</span><span class="p">))</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos">732</span></a>            <span class="n">xi_eta_zeta_pts_pds</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos">733</span></a>        <span class="p">)</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos">734</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos">735</span></a>
</span><span id="L-736"><a href="#L-736"><span class="linenos">736</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">stiffness</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">:</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos">737</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos">738</span></a><span class="sd">        Assemble the density-weighted stiffness matrix.</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos">739</span></a>
</span><span id="L-740"><a href="#L-740"><span class="linenos">740</span></a><span class="sd">        This method follows the same formulation as</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos">741</span></a><span class="sd">        :py:meth:`IGAPatch.stiffness`, but the constitutive matrix is scaled</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos">742</span></a><span class="sd">        pointwise by the interpolated density field.</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos">743</span></a>
</span><span id="L-744"><a href="#L-744"><span class="linenos">744</span></a><span class="sd">        At each integration point, the elasticity tensor is multiplied by</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos">745</span></a><span class="sd">        the local density value, resulting in a spatially varying stiffness.</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos">746</span></a>
</span><span id="L-747"><a href="#L-747"><span class="linenos">747</span></a><span class="sd">        Returns</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos">748</span></a><span class="sd">        -------</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos">749</span></a><span class="sd">        K : sps.spmatrix</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos">750</span></a><span class="sd">            Sparse stiffness matrix of shape</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos">751</span></a><span class="sd">            (3 * nb_ctrl_pts, 3 * nb_ctrl_pts).</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos">752</span></a>
</span><span id="L-753"><a href="#L-753"><span class="linenos">753</span></a><span class="sd">        See Also</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos">754</span></a><span class="sd">        --------</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos">755</span></a><span class="sd">        IGAPatch.stiffness :</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos">756</span></a><span class="sd">            Stiffness assembly without density weighting.</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos">757</span></a><span class="sd">        IGAPatchDensity.density :</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos">758</span></a><span class="sd">            Evaluation of the density field at parametric points.</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos">759</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos">760</span></a>        <span class="n">dN_dXI</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">DN</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeta</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos">761</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">Jinv</span><span class="p">,</span> <span class="n">detJ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jacobian</span><span class="p">(</span><span class="n">dN_dXI</span><span class="p">)</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos">762</span></a>        <span class="n">dN_dx</span><span class="p">,</span> <span class="n">dN_dy</span><span class="p">,</span> <span class="n">dN_dz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grad_N</span><span class="p">(</span><span class="n">Jinv</span><span class="p">,</span> <span class="n">dN_dXI</span><span class="p">)</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos">763</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_W</span><span class="p">(</span><span class="n">detJ</span><span class="p">)</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos">764</span></a>        <span class="n">Z</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">coo_matrix</span><span class="p">(</span><span class="n">dN_dx</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos">765</span></a>        <span class="n">Bxx</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">dN_dx</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">Z</span><span class="p">))</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos">766</span></a>        <span class="n">Byy</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Z</span><span class="p">,</span> <span class="n">dN_dy</span><span class="p">,</span> <span class="n">Z</span><span class="p">))</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos">767</span></a>        <span class="n">Bzz</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Z</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">dN_dz</span><span class="p">))</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos">768</span></a>        <span class="n">Bxy</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">dN_dy</span><span class="p">,</span> <span class="n">dN_dx</span><span class="p">,</span> <span class="n">Z</span><span class="p">))</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos">769</span></a>        <span class="n">Byz</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Z</span><span class="p">,</span> <span class="n">dN_dz</span><span class="p">,</span> <span class="n">dN_dy</span><span class="p">))</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos">770</span></a>        <span class="n">Bxz</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">dN_dz</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">dN_dx</span><span class="p">))</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos">771</span></a>        <span class="n">H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">density</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeta</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos">772</span></a>            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos">773</span></a>        <span class="p">)</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos">774</span></a>        <span class="n">K0</span> <span class="o">=</span> <span class="n">Bxx</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="n">Bxx</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bzz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">])))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos">775</span></a>        <span class="n">K1</span> <span class="o">=</span> <span class="n">Byy</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="n">Bxx</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bzz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">])))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos">776</span></a>        <span class="n">K2</span> <span class="o">=</span> <span class="n">Bzz</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="n">Bxx</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bzz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">])))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos">777</span></a>        <span class="n">K3</span> <span class="o">=</span> <span class="n">Bxy</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="n">Bxx</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bzz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">])))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos">778</span></a>        <span class="n">K4</span> <span class="o">=</span> <span class="n">Byz</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="n">Bxx</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bzz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">])))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos">779</span></a>        <span class="n">K5</span> <span class="o">=</span> <span class="n">Bxz</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="n">Bxx</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bzz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">])))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos">780</span></a>        <span class="n">K</span><span class="p">:</span> <span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">K0</span><span class="p">,</span> <span class="n">K1</span><span class="p">,</span> <span class="n">K2</span><span class="p">,</span> <span class="n">K3</span><span class="p">,</span> <span class="n">K4</span><span class="p">,</span> <span class="n">K5</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos">781</span></a>        <span class="k">return</span> <span class="n">K</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos">782</span></a>
</span><span id="L-783"><a href="#L-783"><span class="linenos">783</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">XI</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]:</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos">784</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos">785</span></a><span class="sd">        Evaluate the interpolated density field at parametric points.</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos">786</span></a>
</span><span id="L-787"><a href="#L-787"><span class="linenos">787</span></a><span class="sd">        The density is obtained by composition of the evaluated B-spline</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos">788</span></a><span class="sd">        density field with a clipping operator to the interval [0, 1].</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos">789</span></a>
</span><span id="L-790"><a href="#L-790"><span class="linenos">790</span></a><span class="sd">        Parameters</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos">791</span></a><span class="sd">        ----------</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos">792</span></a><span class="sd">        XI : list[np.ndarray[np.floating]]</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos">793</span></a><span class="sd">            Parametric coordinates [xi, eta, zeta] at which to evaluate the density.</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos">794</span></a>
</span><span id="L-795"><a href="#L-795"><span class="linenos">795</span></a><span class="sd">        Returns</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos">796</span></a><span class="sd">        -------</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos">797</span></a><span class="sd">        density : np.ndarray[np.floating]</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos">798</span></a><span class="sd">            Density values at the parametric points.</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos">799</span></a><span class="sd">            Shape corresponds to the tensor-product grid defined by `XI`.</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos">800</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos">801</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">XI</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos">802</span></a>
</span><span id="L-803"><a href="#L-803"><span class="linenos">803</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">sigma</span><span class="p">(</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos">804</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">eps</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="n">density</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos">805</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]:</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos">806</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos">807</span></a><span class="sd">        Compute the density-weighted stress tensor in Voigt notation.</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos">808</span></a>
</span><span id="L-809"><a href="#L-809"><span class="linenos">809</span></a><span class="sd">        The stress is computed from the strain tensor using a linear elastic</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos">810</span></a><span class="sd">        constitutive law, where the constitutive matrix is scaled pointwise</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos">811</span></a><span class="sd">        by the provided density field.</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos">812</span></a>
</span><span id="L-813"><a href="#L-813"><span class="linenos">813</span></a><span class="sd">        Voight notation shear strains are internally converted to tensorial</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos">814</span></a><span class="sd">        shear strains before applying the constitutive law.</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos">815</span></a>
</span><span id="L-816"><a href="#L-816"><span class="linenos">816</span></a><span class="sd">        Parameters</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos">817</span></a><span class="sd">        ----------</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos">818</span></a><span class="sd">        eps : np.ndarray[np.floating]</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos">819</span></a><span class="sd">            Strain tensor in Voigt notation.</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos">820</span></a><span class="sd">            Shape: (6, n_param_pts).</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos">821</span></a><span class="sd">        density : np.ndarray[np.floating]</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos">822</span></a><span class="sd">            Density values at the same parametric points.</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos">823</span></a><span class="sd">            Shape: (n_param_pts,).</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos">824</span></a>
</span><span id="L-825"><a href="#L-825"><span class="linenos">825</span></a><span class="sd">        Returns</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos">826</span></a><span class="sd">        -------</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos">827</span></a><span class="sd">        sig : np.ndarray[np.floating]</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos">828</span></a><span class="sd">            Stress tensor in Voigt notation.</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos">829</span></a><span class="sd">            Shape: (6, n_param_pts).</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos">830</span></a>
</span><span id="L-831"><a href="#L-831"><span class="linenos">831</span></a><span class="sd">        See Also</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos">832</span></a><span class="sd">        --------</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos">833</span></a><span class="sd">        IGAPatch.epsilon :</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos">834</span></a><span class="sd">            Strain computation from the displacement field.</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos">835</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos">836</span></a>        <span class="n">eps</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span> <span class="o">*=</span> <span class="mi">2</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos">837</span></a>        <span class="n">H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">density</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># (6, 6, nb_param_pts)</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos">838</span></a>        <span class="n">sig</span> <span class="o">=</span> <span class="p">(</span><span class="n">H</span> <span class="o">*</span> <span class="n">eps</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># sig_ij = H_ikj * eps_kj</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos">839</span></a>        <span class="k">return</span> <span class="n">sig</span>  <span class="c1"># (6, nb_param_pts)</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos">840</span></a>
</span><span id="L-841"><a href="#L-841"><span class="linenos">841</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">make_paraview_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">U</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="n">XI</span><span class="p">):</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos">842</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos">843</span></a><span class="sd">        Generate ParaView fields including density-dependent quantities.</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos">844</span></a>
</span><span id="L-845"><a href="#L-845"><span class="linenos">845</span></a><span class="sd">        This method extends :py:meth:`IGAPatch.make_paraview_fields` by adding</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos">846</span></a><span class="sd">        the interpolated density field and by ensuring that stress-related</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos">847</span></a><span class="sd">        quantities are computed using the density-weighted constitutive law.</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos">848</span></a>
</span><span id="L-849"><a href="#L-849"><span class="linenos">849</span></a><span class="sd">        The following fields are exported:</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos">850</span></a><span class="sd">            - displacement `U`</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos">851</span></a><span class="sd">            - strain tensor `epsilon`</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos">852</span></a><span class="sd">            - density field `density`</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos">853</span></a><span class="sd">            - stress tensor `sigma`</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos">854</span></a><span class="sd">            - principal stresses `sigma_eig`</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos">855</span></a><span class="sd">            - von Mises stress `von_mises`</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos">856</span></a>
</span><span id="L-857"><a href="#L-857"><span class="linenos">857</span></a><span class="sd">        Parameters</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos">858</span></a><span class="sd">        ----------</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos">859</span></a><span class="sd">        U : np.ndarray[np.floating]</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos">860</span></a><span class="sd">            Displacement field of shape (3, nb_ctrl_pts).</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos">861</span></a><span class="sd">        XI : list[np.ndarray[np.floating]]</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos">862</span></a><span class="sd">            Parametric coordinates [xi, eta, zeta] defining the evaluation grid.</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos">863</span></a>
</span><span id="L-864"><a href="#L-864"><span class="linenos">864</span></a><span class="sd">        Returns</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos">865</span></a><span class="sd">        -------</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos">866</span></a><span class="sd">        fields : dict[str, np.ndarray[np.floating]]</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos">867</span></a><span class="sd">            Dictionary of fields formatted for ParaView export.</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos">868</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos">869</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos">870</span></a>        <span class="n">epsilon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">XI</span><span class="p">)</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos">871</span></a>        <span class="n">density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">XI</span><span class="p">)</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos">872</span></a>        <span class="n">sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">(</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos">873</span></a>        <span class="n">sigma_eig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_eig</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos">874</span></a>        <span class="n">von_mises</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">von_mises</span><span class="p">(</span><span class="n">sigma_eig</span><span class="p">)</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos">875</span></a>        <span class="n">XI_shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">xi</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">XI</span><span class="p">)</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos">876</span></a>        <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos">877</span></a>            <span class="s2">&quot;U&quot;</span><span class="p">:</span> <span class="n">u</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos">878</span></a>            <span class="s2">&quot;epsilon&quot;</span><span class="p">:</span> <span class="n">epsilon</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="n">XI_shape</span><span class="p">)),</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos">879</span></a>            <span class="s2">&quot;density&quot;</span><span class="p">:</span> <span class="n">density</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">XI_shape</span><span class="p">)),</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos">880</span></a>            <span class="s2">&quot;sigma&quot;</span><span class="p">:</span> <span class="n">sigma</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="n">XI_shape</span><span class="p">)),</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos">881</span></a>            <span class="s2">&quot;sigma_eig&quot;</span><span class="p">:</span> <span class="n">sigma_eig</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">*</span><span class="n">XI_shape</span><span class="p">)),</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos">882</span></a>            <span class="s2">&quot;von_mises&quot;</span><span class="p">:</span> <span class="n">von_mises</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">XI_shape</span><span class="p">)),</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos">883</span></a>        <span class="p">}</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos">884</span></a>        <span class="k">return</span> <span class="n">fields</span>
</span></pre></div>


            </section>
                <section id="IGAPatch">
                            <input id="IGAPatch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">IGAPatch</span>:

                <label class="view-source-button" for="IGAPatch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IGAPatch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IGAPatch-9"><a href="#IGAPatch-9"><span class="linenos">  9</span></a><span class="k">class</span><span class="w"> </span><span class="nc">IGAPatch</span><span class="p">:</span>
</span><span id="IGAPatch-10"><a href="#IGAPatch-10"><span class="linenos"> 10</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatch-11"><a href="#IGAPatch-11"><span class="linenos"> 11</span></a><span class="sd">    Local representation of a 3D B-spline patch for linear elasticity.</span>
</span><span id="IGAPatch-12"><a href="#IGAPatch-12"><span class="linenos"> 12</span></a>
</span><span id="IGAPatch-13"><a href="#IGAPatch-13"><span class="linenos"> 13</span></a><span class="sd">    This class provides the building blocks to compute linear elasticity operators</span>
</span><span id="IGAPatch-14"><a href="#IGAPatch-14"><span class="linenos"> 14</span></a><span class="sd">    (stiffness matrix, right-hand side, strain, stress, von Mises stress) for a</span>
</span><span id="IGAPatch-15"><a href="#IGAPatch-15"><span class="linenos"> 15</span></a><span class="sd">    single B-spline volume. It is intended **solely as a component of a multipatch</span>
</span><span id="IGAPatch-16"><a href="#IGAPatch-16"><span class="linenos"> 16</span></a><span class="sd">    problem** and is not designed to be used as a standalone solver.</span>
</span><span id="IGAPatch-17"><a href="#IGAPatch-17"><span class="linenos"> 17</span></a>
</span><span id="IGAPatch-18"><a href="#IGAPatch-18"><span class="linenos"> 18</span></a><span class="sd">    Typically, IGAPatch objects are managed by a `ProblemIGA` instance, which</span>
</span><span id="IGAPatch-19"><a href="#IGAPatch-19"><span class="linenos"> 19</span></a><span class="sd">    assembles multiple patches, enforces Dirichlet constraints, and solves the</span>
</span><span id="IGAPatch-20"><a href="#IGAPatch-20"><span class="linenos"> 20</span></a><span class="sd">    global linear elasticity problem.</span>
</span><span id="IGAPatch-21"><a href="#IGAPatch-21"><span class="linenos"> 21</span></a>
</span><span id="IGAPatch-22"><a href="#IGAPatch-22"><span class="linenos"> 22</span></a><span class="sd">    Features provided by IGAPatch include:</span>
</span><span id="IGAPatch-23"><a href="#IGAPatch-23"><span class="linenos"> 23</span></a><span class="sd">        - computation of the Jacobian and its determinant,</span>
</span><span id="IGAPatch-24"><a href="#IGAPatch-24"><span class="linenos"> 24</span></a><span class="sd">        - gradients of shape functions in physical space,</span>
</span><span id="IGAPatch-25"><a href="#IGAPatch-25"><span class="linenos"> 25</span></a><span class="sd">        - linear elastic stiffness matrix assembly for one patch,</span>
</span><span id="IGAPatch-26"><a href="#IGAPatch-26"><span class="linenos"> 26</span></a><span class="sd">        - evaluation of prescribed surface forces,</span>
</span><span id="IGAPatch-27"><a href="#IGAPatch-27"><span class="linenos"> 27</span></a><span class="sd">        - post-processing quantities such as displacement, strain, stress, and von Mises stress,</span>
</span><span id="IGAPatch-28"><a href="#IGAPatch-28"><span class="linenos"> 28</span></a><span class="sd">        - export of results to visualization tools (e.g., ParaView).</span>
</span><span id="IGAPatch-29"><a href="#IGAPatch-29"><span class="linenos"> 29</span></a>
</span><span id="IGAPatch-30"><a href="#IGAPatch-30"><span class="linenos"> 30</span></a><span class="sd">    Attributes</span>
</span><span id="IGAPatch-31"><a href="#IGAPatch-31"><span class="linenos"> 31</span></a><span class="sd">    ----------</span>
</span><span id="IGAPatch-32"><a href="#IGAPatch-32"><span class="linenos"> 32</span></a><span class="sd">    spline : BSpline</span>
</span><span id="IGAPatch-33"><a href="#IGAPatch-33"><span class="linenos"> 33</span></a><span class="sd">        The 3D B-spline volume representing the patch geometry and shape functions.</span>
</span><span id="IGAPatch-34"><a href="#IGAPatch-34"><span class="linenos"> 34</span></a><span class="sd">    ctrl_pts : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-35"><a href="#IGAPatch-35"><span class="linenos"> 35</span></a><span class="sd">        Array of control points of shape (3, n_xi, n_eta, n_zeta) defining the patch geometry.</span>
</span><span id="IGAPatch-36"><a href="#IGAPatch-36"><span class="linenos"> 36</span></a><span class="sd">    xi : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-37"><a href="#IGAPatch-37"><span class="linenos"> 37</span></a><span class="sd">        Isoparametric integration points along the xi direction.</span>
</span><span id="IGAPatch-38"><a href="#IGAPatch-38"><span class="linenos"> 38</span></a><span class="sd">    dxi : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-39"><a href="#IGAPatch-39"><span class="linenos"> 39</span></a><span class="sd">        Corresponding quadrature weights for xi.</span>
</span><span id="IGAPatch-40"><a href="#IGAPatch-40"><span class="linenos"> 40</span></a><span class="sd">    eta : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-41"><a href="#IGAPatch-41"><span class="linenos"> 41</span></a><span class="sd">        Isoparametric integration points along the eta direction.</span>
</span><span id="IGAPatch-42"><a href="#IGAPatch-42"><span class="linenos"> 42</span></a><span class="sd">    deta : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-43"><a href="#IGAPatch-43"><span class="linenos"> 43</span></a><span class="sd">        Corresponding quadrature weights for eta.</span>
</span><span id="IGAPatch-44"><a href="#IGAPatch-44"><span class="linenos"> 44</span></a><span class="sd">    zeta : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-45"><a href="#IGAPatch-45"><span class="linenos"> 45</span></a><span class="sd">        Isoparametric integration points along the zeta direction.</span>
</span><span id="IGAPatch-46"><a href="#IGAPatch-46"><span class="linenos"> 46</span></a><span class="sd">    dzeta : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-47"><a href="#IGAPatch-47"><span class="linenos"> 47</span></a><span class="sd">        Corresponding quadrature weights for zeta.</span>
</span><span id="IGAPatch-48"><a href="#IGAPatch-48"><span class="linenos"> 48</span></a><span class="sd">    F_N : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-49"><a href="#IGAPatch-49"><span class="linenos"> 49</span></a><span class="sd">        Prescribed surface forces, with shape (3 (direction), 2 (side: front/back), 3 (physical components)).</span>
</span><span id="IGAPatch-50"><a href="#IGAPatch-50"><span class="linenos"> 50</span></a><span class="sd">        Used for computing the right-hand side vector.</span>
</span><span id="IGAPatch-51"><a href="#IGAPatch-51"><span class="linenos"> 51</span></a><span class="sd">    H : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-52"><a href="#IGAPatch-52"><span class="linenos"> 52</span></a><span class="sd">        Constitutive matrix in Voigt notation (6x6) for linear isotropic elasticity.</span>
</span><span id="IGAPatch-53"><a href="#IGAPatch-53"><span class="linenos"> 53</span></a><span class="sd">        Defined from `E` and `nu`.</span>
</span><span id="IGAPatch-54"><a href="#IGAPatch-54"><span class="linenos"> 54</span></a>
</span><span id="IGAPatch-55"><a href="#IGAPatch-55"><span class="linenos"> 55</span></a><span class="sd">    Notes</span>
</span><span id="IGAPatch-56"><a href="#IGAPatch-56"><span class="linenos"> 56</span></a><span class="sd">    -----</span>
</span><span id="IGAPatch-57"><a href="#IGAPatch-57"><span class="linenos"> 57</span></a><span class="sd">    - All integration points are generated using Gaussian quadrature with a number</span>
</span><span id="IGAPatch-58"><a href="#IGAPatch-58"><span class="linenos"> 58</span></a><span class="sd">      of points determined from the spline degree.</span>
</span><span id="IGAPatch-59"><a href="#IGAPatch-59"><span class="linenos"> 59</span></a><span class="sd">    - This class **does not handle multipatch connectivity or global constraints**.</span>
</span><span id="IGAPatch-60"><a href="#IGAPatch-60"><span class="linenos"> 60</span></a><span class="sd">      Use `ProblemIGA` to assemble and solve multipatch problems.</span>
</span><span id="IGAPatch-61"><a href="#IGAPatch-61"><span class="linenos"> 61</span></a><span class="sd">    - Post-processing quantities can be evaluated at the integration points or exported</span>
</span><span id="IGAPatch-62"><a href="#IGAPatch-62"><span class="linenos"> 62</span></a><span class="sd">      to visualization tools like ParaView.</span>
</span><span id="IGAPatch-63"><a href="#IGAPatch-63"><span class="linenos"> 63</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="IGAPatch-64"><a href="#IGAPatch-64"><span class="linenos"> 64</span></a>
</span><span id="IGAPatch-65"><a href="#IGAPatch-65"><span class="linenos"> 65</span></a>    <span class="n">spline</span><span class="p">:</span> <span class="n">BSpline</span>
</span><span id="IGAPatch-66"><a href="#IGAPatch-66"><span class="linenos"> 66</span></a>    <span class="n">ctrl_pts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>
</span><span id="IGAPatch-67"><a href="#IGAPatch-67"><span class="linenos"> 67</span></a>    <span class="n">xi</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>
</span><span id="IGAPatch-68"><a href="#IGAPatch-68"><span class="linenos"> 68</span></a>    <span class="n">dxi</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>
</span><span id="IGAPatch-69"><a href="#IGAPatch-69"><span class="linenos"> 69</span></a>    <span class="n">eta</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>
</span><span id="IGAPatch-70"><a href="#IGAPatch-70"><span class="linenos"> 70</span></a>    <span class="n">deta</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>
</span><span id="IGAPatch-71"><a href="#IGAPatch-71"><span class="linenos"> 71</span></a>    <span class="n">zeta</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>
</span><span id="IGAPatch-72"><a href="#IGAPatch-72"><span class="linenos"> 72</span></a>    <span class="n">dzeta</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>
</span><span id="IGAPatch-73"><a href="#IGAPatch-73"><span class="linenos"> 73</span></a>    <span class="n">F_N</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>
</span><span id="IGAPatch-74"><a href="#IGAPatch-74"><span class="linenos"> 74</span></a>    <span class="n">H</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>
</span><span id="IGAPatch-75"><a href="#IGAPatch-75"><span class="linenos"> 75</span></a>
</span><span id="IGAPatch-76"><a href="#IGAPatch-76"><span class="linenos"> 76</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="IGAPatch-77"><a href="#IGAPatch-77"><span class="linenos"> 77</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="IGAPatch-78"><a href="#IGAPatch-78"><span class="linenos"> 78</span></a>        <span class="n">spline</span><span class="p">:</span> <span class="n">BSpline</span><span class="p">,</span>
</span><span id="IGAPatch-79"><a href="#IGAPatch-79"><span class="linenos"> 79</span></a>        <span class="n">ctrl_pts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span>
</span><span id="IGAPatch-80"><a href="#IGAPatch-80"><span class="linenos"> 80</span></a>        <span class="n">E</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="IGAPatch-81"><a href="#IGAPatch-81"><span class="linenos"> 81</span></a>        <span class="n">nu</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="IGAPatch-82"><a href="#IGAPatch-82"><span class="linenos"> 82</span></a>        <span class="n">F_N</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">),</span>
</span><span id="IGAPatch-83"><a href="#IGAPatch-83"><span class="linenos"> 83</span></a>    <span class="p">):</span>
</span><span id="IGAPatch-84"><a href="#IGAPatch-84"><span class="linenos"> 84</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatch-85"><a href="#IGAPatch-85"><span class="linenos"> 85</span></a><span class="sd">        Initialize a local `IGAPatch` for linear elasticity computations.</span>
</span><span id="IGAPatch-86"><a href="#IGAPatch-86"><span class="linenos"> 86</span></a>
</span><span id="IGAPatch-87"><a href="#IGAPatch-87"><span class="linenos"> 87</span></a><span class="sd">        This constructor sets up all necessary information for assembling</span>
</span><span id="IGAPatch-88"><a href="#IGAPatch-88"><span class="linenos"> 88</span></a><span class="sd">        the stiffness matrix and right-hand side for a single B-spline patch.</span>
</span><span id="IGAPatch-89"><a href="#IGAPatch-89"><span class="linenos"> 89</span></a><span class="sd">        Note that `IGAPatch` objects are intended to be used as components of</span>
</span><span id="IGAPatch-90"><a href="#IGAPatch-90"><span class="linenos"> 90</span></a><span class="sd">        a `ProblemIGA` multipatch object, and are **not standalone solvers**.</span>
</span><span id="IGAPatch-91"><a href="#IGAPatch-91"><span class="linenos"> 91</span></a>
</span><span id="IGAPatch-92"><a href="#IGAPatch-92"><span class="linenos"> 92</span></a><span class="sd">        Parameters</span>
</span><span id="IGAPatch-93"><a href="#IGAPatch-93"><span class="linenos"> 93</span></a><span class="sd">        ----------</span>
</span><span id="IGAPatch-94"><a href="#IGAPatch-94"><span class="linenos"> 94</span></a><span class="sd">        spline : BSpline</span>
</span><span id="IGAPatch-95"><a href="#IGAPatch-95"><span class="linenos"> 95</span></a><span class="sd">            The 3D B-spline volume defining the patch geometry and the shape</span>
</span><span id="IGAPatch-96"><a href="#IGAPatch-96"><span class="linenos"> 96</span></a><span class="sd">            functions. Provides methods to compute basis functions and derivatives.</span>
</span><span id="IGAPatch-97"><a href="#IGAPatch-97"><span class="linenos"> 97</span></a><span class="sd">        ctrl_pts : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-98"><a href="#IGAPatch-98"><span class="linenos"> 98</span></a><span class="sd">            Array of control points defining the patch geometry.</span>
</span><span id="IGAPatch-99"><a href="#IGAPatch-99"><span class="linenos"> 99</span></a><span class="sd">            Shape should be (3, n_xi, n_eta, n_zeta) corresponding to</span>
</span><span id="IGAPatch-100"><a href="#IGAPatch-100"><span class="linenos">100</span></a><span class="sd">            (physical_dim, n_ctrl_pts_xi, n_ctrl_pts_eta, n_ctrl_pts_zeta).</span>
</span><span id="IGAPatch-101"><a href="#IGAPatch-101"><span class="linenos">101</span></a><span class="sd">        E : float</span>
</span><span id="IGAPatch-102"><a href="#IGAPatch-102"><span class="linenos">102</span></a><span class="sd">            Young&#39;s modulus of the material.</span>
</span><span id="IGAPatch-103"><a href="#IGAPatch-103"><span class="linenos">103</span></a><span class="sd">        nu : float</span>
</span><span id="IGAPatch-104"><a href="#IGAPatch-104"><span class="linenos">104</span></a><span class="sd">            Poisson&#39;s ratio of the material.</span>
</span><span id="IGAPatch-105"><a href="#IGAPatch-105"><span class="linenos">105</span></a><span class="sd">        F_N : np.ndarray[np.floating], optional</span>
</span><span id="IGAPatch-106"><a href="#IGAPatch-106"><span class="linenos">106</span></a><span class="sd">            Prescribed surface forces applied on the patch boundaries.</span>
</span><span id="IGAPatch-107"><a href="#IGAPatch-107"><span class="linenos">107</span></a><span class="sd">            Shape should be (3 (direction: x, y, z), 2 (side: front/back), 3 (physical components)),</span>
</span><span id="IGAPatch-108"><a href="#IGAPatch-108"><span class="linenos">108</span></a><span class="sd">            representing forces at the integration points on each face. Default is zero (no surface forces).</span>
</span><span id="IGAPatch-109"><a href="#IGAPatch-109"><span class="linenos">109</span></a>
</span><span id="IGAPatch-110"><a href="#IGAPatch-110"><span class="linenos">110</span></a><span class="sd">        Attributes set</span>
</span><span id="IGAPatch-111"><a href="#IGAPatch-111"><span class="linenos">111</span></a><span class="sd">        ----------------</span>
</span><span id="IGAPatch-112"><a href="#IGAPatch-112"><span class="linenos">112</span></a><span class="sd">        H : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-113"><a href="#IGAPatch-113"><span class="linenos">113</span></a><span class="sd">            66 constitutive matrix in Voigt notation, built from `E` and `nu`.</span>
</span><span id="IGAPatch-114"><a href="#IGAPatch-114"><span class="linenos">114</span></a><span class="sd">        xi, eta, zeta : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-115"><a href="#IGAPatch-115"><span class="linenos">115</span></a><span class="sd">            Isoparametric coordinates for Gaussian quadrature in each direction.</span>
</span><span id="IGAPatch-116"><a href="#IGAPatch-116"><span class="linenos">116</span></a><span class="sd">        dxi, deta, dzeta : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-117"><a href="#IGAPatch-117"><span class="linenos">117</span></a><span class="sd">            Quadrature weights associated with the isoparametric coordinates.</span>
</span><span id="IGAPatch-118"><a href="#IGAPatch-118"><span class="linenos">118</span></a><span class="sd">        F_N : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-119"><a href="#IGAPatch-119"><span class="linenos">119</span></a><span class="sd">            Prescribed surface forces, stored for use in the rhs computation.</span>
</span><span id="IGAPatch-120"><a href="#IGAPatch-120"><span class="linenos">120</span></a>
</span><span id="IGAPatch-121"><a href="#IGAPatch-121"><span class="linenos">121</span></a><span class="sd">        Notes</span>
</span><span id="IGAPatch-122"><a href="#IGAPatch-122"><span class="linenos">122</span></a><span class="sd">        -----</span>
</span><span id="IGAPatch-123"><a href="#IGAPatch-123"><span class="linenos">123</span></a><span class="sd">        - Quadrature points and weights are automatically generated using</span>
</span><span id="IGAPatch-124"><a href="#IGAPatch-124"><span class="linenos">124</span></a><span class="sd">        `spline.gauss_legendre_for_integration` with `degree+1` points.</span>
</span><span id="IGAPatch-125"><a href="#IGAPatch-125"><span class="linenos">125</span></a><span class="sd">        - The constitutive matrix `H` assumes linear isotropic elasticity in Voigt notation.</span>
</span><span id="IGAPatch-126"><a href="#IGAPatch-126"><span class="linenos">126</span></a><span class="sd">        - This patch only defines the local operators; global assembly and</span>
</span><span id="IGAPatch-127"><a href="#IGAPatch-127"><span class="linenos">127</span></a><span class="sd">        enforcement of boundary conditions are handled by `ProblemIGA`.</span>
</span><span id="IGAPatch-128"><a href="#IGAPatch-128"><span class="linenos">128</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatch-129"><a href="#IGAPatch-129"><span class="linenos">129</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">spline</span> <span class="o">=</span> <span class="n">spline</span>
</span><span id="IGAPatch-130"><a href="#IGAPatch-130"><span class="linenos">130</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span> <span class="o">=</span> <span class="n">ctrl_pts</span>
</span><span id="IGAPatch-131"><a href="#IGAPatch-131"><span class="linenos">131</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="IGAPatch-132"><a href="#IGAPatch-132"><span class="linenos">132</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="IGAPatch-133"><a href="#IGAPatch-133"><span class="linenos">133</span></a>                <span class="p">[</span>
</span><span id="IGAPatch-134"><a href="#IGAPatch-134"><span class="linenos">134</span></a>                    <span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">nu</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="IGAPatch-135"><a href="#IGAPatch-135"><span class="linenos">135</span></a>                    <span class="p">[</span><span class="n">nu</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">nu</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="IGAPatch-136"><a href="#IGAPatch-136"><span class="linenos">136</span></a>                    <span class="p">[</span><span class="n">nu</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">nu</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="IGAPatch-137"><a href="#IGAPatch-137"><span class="linenos">137</span></a>                    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">-</span> <span class="n">nu</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="IGAPatch-138"><a href="#IGAPatch-138"><span class="linenos">138</span></a>                    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">-</span> <span class="n">nu</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="IGAPatch-139"><a href="#IGAPatch-139"><span class="linenos">139</span></a>                    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">-</span> <span class="n">nu</span><span class="p">)],</span>
</span><span id="IGAPatch-140"><a href="#IGAPatch-140"><span class="linenos">140</span></a>                <span class="p">],</span>
</span><span id="IGAPatch-141"><a href="#IGAPatch-141"><span class="linenos">141</span></a>                <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
</span><span id="IGAPatch-142"><a href="#IGAPatch-142"><span class="linenos">142</span></a>            <span class="p">)</span>
</span><span id="IGAPatch-143"><a href="#IGAPatch-143"><span class="linenos">143</span></a>            <span class="o">*</span> <span class="n">E</span>
</span><span id="IGAPatch-144"><a href="#IGAPatch-144"><span class="linenos">144</span></a>            <span class="o">/</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">nu</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nu</span><span class="p">))</span>
</span><span id="IGAPatch-145"><a href="#IGAPatch-145"><span class="linenos">145</span></a>        <span class="p">)</span>
</span><span id="IGAPatch-146"><a href="#IGAPatch-146"><span class="linenos">146</span></a>        <span class="n">xi_eta_zeta_pts_pds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">gauss_legendre_for_integration</span><span class="p">(</span>
</span><span id="IGAPatch-147"><a href="#IGAPatch-147"><span class="linenos">147</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">getDegrees</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="IGAPatch-148"><a href="#IGAPatch-148"><span class="linenos">148</span></a>        <span class="p">)</span>
</span><span id="IGAPatch-149"><a href="#IGAPatch-149"><span class="linenos">149</span></a>        <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeta</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dxi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dzeta</span><span class="p">))</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="IGAPatch-150"><a href="#IGAPatch-150"><span class="linenos">150</span></a>            <span class="n">xi_eta_zeta_pts_pds</span>
</span><span id="IGAPatch-151"><a href="#IGAPatch-151"><span class="linenos">151</span></a>        <span class="p">)</span>
</span><span id="IGAPatch-152"><a href="#IGAPatch-152"><span class="linenos">152</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">F_N</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="IGAPatch-153"><a href="#IGAPatch-153"><span class="linenos">153</span></a>            <span class="n">F_N</span>  <span class="c1"># shape (3 (xi, eta, or zeta), 2 (front or back), 3 (vector (x, y, z)))</span>
</span><span id="IGAPatch-154"><a href="#IGAPatch-154"><span class="linenos">154</span></a>        <span class="p">)</span>
</span><span id="IGAPatch-155"><a href="#IGAPatch-155"><span class="linenos">155</span></a>
</span><span id="IGAPatch-156"><a href="#IGAPatch-156"><span class="linenos">156</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">jacobian</span><span class="p">(</span>
</span><span id="IGAPatch-157"><a href="#IGAPatch-157"><span class="linenos">157</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">dN_dXI</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">,</span> <span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">,</span> <span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">]</span>
</span><span id="IGAPatch-158"><a href="#IGAPatch-158"><span class="linenos">158</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span>
</span><span id="IGAPatch-159"><a href="#IGAPatch-159"><span class="linenos">159</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>
</span><span id="IGAPatch-160"><a href="#IGAPatch-160"><span class="linenos">160</span></a>    <span class="p">]:</span>
</span><span id="IGAPatch-161"><a href="#IGAPatch-161"><span class="linenos">161</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatch-162"><a href="#IGAPatch-162"><span class="linenos">162</span></a><span class="sd">        Compute the Jacobian matrix of the mapping from parametric to physical space,</span>
</span><span id="IGAPatch-163"><a href="#IGAPatch-163"><span class="linenos">163</span></a><span class="sd">        its inverse, and its determinant at all integration points.</span>
</span><span id="IGAPatch-164"><a href="#IGAPatch-164"><span class="linenos">164</span></a>
</span><span id="IGAPatch-165"><a href="#IGAPatch-165"><span class="linenos">165</span></a><span class="sd">        The Jacobian describes how the parametric (xi, eta, zeta) coordinates</span>
</span><span id="IGAPatch-166"><a href="#IGAPatch-166"><span class="linenos">166</span></a><span class="sd">        are mapped to physical coordinates using the patch&#39;s control points.</span>
</span><span id="IGAPatch-167"><a href="#IGAPatch-167"><span class="linenos">167</span></a>
</span><span id="IGAPatch-168"><a href="#IGAPatch-168"><span class="linenos">168</span></a><span class="sd">        Parameters</span>
</span><span id="IGAPatch-169"><a href="#IGAPatch-169"><span class="linenos">169</span></a><span class="sd">        ----------</span>
</span><span id="IGAPatch-170"><a href="#IGAPatch-170"><span class="linenos">170</span></a><span class="sd">        dN_dXI : tuple[sps.spmatrix, sps.spmatrix, sps.spmatrix]</span>
</span><span id="IGAPatch-171"><a href="#IGAPatch-171"><span class="linenos">171</span></a><span class="sd">            Derivatives of the shape functions with respect to the parametric coordinates.</span>
</span><span id="IGAPatch-172"><a href="#IGAPatch-172"><span class="linenos">172</span></a><span class="sd">            Tuple of sparse matrices `(dN_dxi, dN_deta, dN_dzeta)`, each of shape</span>
</span><span id="IGAPatch-173"><a href="#IGAPatch-173"><span class="linenos">173</span></a><span class="sd">            (n_intg_pts, n_ctrl_pts).</span>
</span><span id="IGAPatch-174"><a href="#IGAPatch-174"><span class="linenos">174</span></a>
</span><span id="IGAPatch-175"><a href="#IGAPatch-175"><span class="linenos">175</span></a><span class="sd">        Returns</span>
</span><span id="IGAPatch-176"><a href="#IGAPatch-176"><span class="linenos">176</span></a><span class="sd">        -------</span>
</span><span id="IGAPatch-177"><a href="#IGAPatch-177"><span class="linenos">177</span></a><span class="sd">        J : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-178"><a href="#IGAPatch-178"><span class="linenos">178</span></a><span class="sd">            Jacobian matrices at each integration point,</span>
</span><span id="IGAPatch-179"><a href="#IGAPatch-179"><span class="linenos">179</span></a><span class="sd">            shape `(3, 3, n_intg_pts)` corresponding to (physical_dim, param_dim, n_intg_pts).</span>
</span><span id="IGAPatch-180"><a href="#IGAPatch-180"><span class="linenos">180</span></a><span class="sd">        Jinv : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-181"><a href="#IGAPatch-181"><span class="linenos">181</span></a><span class="sd">            Inverse of the Jacobian matrices, shape `(3, 3, n_intg_pts)` corresponding to</span>
</span><span id="IGAPatch-182"><a href="#IGAPatch-182"><span class="linenos">182</span></a><span class="sd">            (param_dim, physical_dim, n_intg_pts).</span>
</span><span id="IGAPatch-183"><a href="#IGAPatch-183"><span class="linenos">183</span></a><span class="sd">        detJ : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-184"><a href="#IGAPatch-184"><span class="linenos">184</span></a><span class="sd">            Determinant of the Jacobian at each integration point, shape `(n_intg_pts,)`.</span>
</span><span id="IGAPatch-185"><a href="#IGAPatch-185"><span class="linenos">185</span></a>
</span><span id="IGAPatch-186"><a href="#IGAPatch-186"><span class="linenos">186</span></a><span class="sd">        Notes</span>
</span><span id="IGAPatch-187"><a href="#IGAPatch-187"><span class="linenos">187</span></a><span class="sd">        -----</span>
</span><span id="IGAPatch-188"><a href="#IGAPatch-188"><span class="linenos">188</span></a><span class="sd">        - `J[:, :, i]` gives the 33 Jacobian matrix at the i-th integration point.</span>
</span><span id="IGAPatch-189"><a href="#IGAPatch-189"><span class="linenos">189</span></a><span class="sd">        - `Jinv[:, :, i]` is the inverse of that matrix, used to compute derivatives</span>
</span><span id="IGAPatch-190"><a href="#IGAPatch-190"><span class="linenos">190</span></a><span class="sd">        with respect to physical coordinates.</span>
</span><span id="IGAPatch-191"><a href="#IGAPatch-191"><span class="linenos">191</span></a><span class="sd">        - `detJ[i]` is the determinant of `J[:, :, i]`, used for integration weights.</span>
</span><span id="IGAPatch-192"><a href="#IGAPatch-192"><span class="linenos">192</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatch-193"><a href="#IGAPatch-193"><span class="linenos">193</span></a>        <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
</span><span id="IGAPatch-194"><a href="#IGAPatch-194"><span class="linenos">194</span></a>            <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">@</span> <span class="n">dN_dxi</span><span class="o">.</span><span class="n">T</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="k">for</span> <span class="n">dN_dxi</span> <span class="ow">in</span> <span class="n">dN_dXI</span><span class="p">],</span>
</span><span id="IGAPatch-195"><a href="#IGAPatch-195"><span class="linenos">195</span></a>            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="IGAPatch-196"><a href="#IGAPatch-196"><span class="linenos">196</span></a>        <span class="p">)</span>  <span class="c1"># shape(3(phy), 3(param), nb_intg_pts)</span>
</span><span id="IGAPatch-197"><a href="#IGAPatch-197"><span class="linenos">197</span></a>        <span class="n">Jinv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">J</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span>
</span><span id="IGAPatch-198"><a href="#IGAPatch-198"><span class="linenos">198</span></a>            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="IGAPatch-199"><a href="#IGAPatch-199"><span class="linenos">199</span></a>        <span class="p">)</span>  <span class="c1"># shape(3(param), 3(phy), nb_intg_pts)</span>
</span><span id="IGAPatch-200"><a href="#IGAPatch-200"><span class="linenos">200</span></a>        <span class="n">detJ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">J</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>  <span class="c1"># vector of nb_intg_pts values</span>
</span><span id="IGAPatch-201"><a href="#IGAPatch-201"><span class="linenos">201</span></a>        <span class="k">return</span> <span class="n">J</span><span class="p">,</span> <span class="n">Jinv</span><span class="p">,</span> <span class="n">detJ</span>
</span><span id="IGAPatch-202"><a href="#IGAPatch-202"><span class="linenos">202</span></a>
</span><span id="IGAPatch-203"><a href="#IGAPatch-203"><span class="linenos">203</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">grad_N</span><span class="p">(</span>
</span><span id="IGAPatch-204"><a href="#IGAPatch-204"><span class="linenos">204</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="IGAPatch-205"><a href="#IGAPatch-205"><span class="linenos">205</span></a>        <span class="n">Jinv</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span>
</span><span id="IGAPatch-206"><a href="#IGAPatch-206"><span class="linenos">206</span></a>        <span class="n">dN_dXI</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">,</span> <span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">,</span> <span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">],</span>
</span><span id="IGAPatch-207"><a href="#IGAPatch-207"><span class="linenos">207</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">object_</span><span class="p">]:</span>
</span><span id="IGAPatch-208"><a href="#IGAPatch-208"><span class="linenos">208</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatch-209"><a href="#IGAPatch-209"><span class="linenos">209</span></a><span class="sd">        Compute the gradient of the B-spline shape functions with respect to physical coordinates.</span>
</span><span id="IGAPatch-210"><a href="#IGAPatch-210"><span class="linenos">210</span></a>
</span><span id="IGAPatch-211"><a href="#IGAPatch-211"><span class="linenos">211</span></a><span class="sd">        The gradient is obtained by applying the chain rule:</span>
</span><span id="IGAPatch-212"><a href="#IGAPatch-212"><span class="linenos">212</span></a><span class="sd">            dN/dX_i = [J]_ij @ dN/dXI_j</span>
</span><span id="IGAPatch-213"><a href="#IGAPatch-213"><span class="linenos">213</span></a><span class="sd">        for each integration point.</span>
</span><span id="IGAPatch-214"><a href="#IGAPatch-214"><span class="linenos">214</span></a>
</span><span id="IGAPatch-215"><a href="#IGAPatch-215"><span class="linenos">215</span></a><span class="sd">        Parameters</span>
</span><span id="IGAPatch-216"><a href="#IGAPatch-216"><span class="linenos">216</span></a><span class="sd">        ----------</span>
</span><span id="IGAPatch-217"><a href="#IGAPatch-217"><span class="linenos">217</span></a><span class="sd">        Jinv : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-218"><a href="#IGAPatch-218"><span class="linenos">218</span></a><span class="sd">            Inverse Jacobian matrices at all integration points,</span>
</span><span id="IGAPatch-219"><a href="#IGAPatch-219"><span class="linenos">219</span></a><span class="sd">            shape `(3, 3, n_intg_pts)` corresponding to (param_dim, physical_dim, n_intg_pts).</span>
</span><span id="IGAPatch-220"><a href="#IGAPatch-220"><span class="linenos">220</span></a><span class="sd">        dN_dXI : tuple[sps.spmatrix, sps.spmatrix, sps.spmatrix]</span>
</span><span id="IGAPatch-221"><a href="#IGAPatch-221"><span class="linenos">221</span></a><span class="sd">            Derivatives of shape functions with respect to parametric coordinates</span>
</span><span id="IGAPatch-222"><a href="#IGAPatch-222"><span class="linenos">222</span></a><span class="sd">            `(dN_dxi, dN_deta, dN_dzeta)`.</span>
</span><span id="IGAPatch-223"><a href="#IGAPatch-223"><span class="linenos">223</span></a><span class="sd">            Each sparse matrix has shape `(n_intg_pts, n_ctrl_pts)`.</span>
</span><span id="IGAPatch-224"><a href="#IGAPatch-224"><span class="linenos">224</span></a>
</span><span id="IGAPatch-225"><a href="#IGAPatch-225"><span class="linenos">225</span></a><span class="sd">        Returns</span>
</span><span id="IGAPatch-226"><a href="#IGAPatch-226"><span class="linenos">226</span></a><span class="sd">        -------</span>
</span><span id="IGAPatch-227"><a href="#IGAPatch-227"><span class="linenos">227</span></a><span class="sd">        dN_dX : np.ndarray[np.object_]</span>
</span><span id="IGAPatch-228"><a href="#IGAPatch-228"><span class="linenos">228</span></a><span class="sd">            Gradients of the shape functions with respect to physical coordinates.</span>
</span><span id="IGAPatch-229"><a href="#IGAPatch-229"><span class="linenos">229</span></a><span class="sd">            Numpy array of shape `(3,)`, where each element is a `sps.spmatrix` of shape</span>
</span><span id="IGAPatch-230"><a href="#IGAPatch-230"><span class="linenos">230</span></a><span class="sd">            `(n_intg_pts, n_ctrl_pts)` corresponding to the derivative along each physical axis.</span>
</span><span id="IGAPatch-231"><a href="#IGAPatch-231"><span class="linenos">231</span></a>
</span><span id="IGAPatch-232"><a href="#IGAPatch-232"><span class="linenos">232</span></a><span class="sd">        Notes</span>
</span><span id="IGAPatch-233"><a href="#IGAPatch-233"><span class="linenos">233</span></a><span class="sd">        -----</span>
</span><span id="IGAPatch-234"><a href="#IGAPatch-234"><span class="linenos">234</span></a><span class="sd">        - `dN_dX[i]` gives the derivative of all shape functions along the i-th physical direction</span>
</span><span id="IGAPatch-235"><a href="#IGAPatch-235"><span class="linenos">235</span></a><span class="sd">        at all integration points.</span>
</span><span id="IGAPatch-236"><a href="#IGAPatch-236"><span class="linenos">236</span></a><span class="sd">        - Each sparse matrix can be directly used in the assembly of the stiffness matrix or other</span>
</span><span id="IGAPatch-237"><a href="#IGAPatch-237"><span class="linenos">237</span></a><span class="sd">        integrals over the physical domain.</span>
</span><span id="IGAPatch-238"><a href="#IGAPatch-238"><span class="linenos">238</span></a><span class="sd">        - The use of `np.object_` array allows each entry to hold a separate sparse matrix.</span>
</span><span id="IGAPatch-239"><a href="#IGAPatch-239"><span class="linenos">239</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatch-240"><a href="#IGAPatch-240"><span class="linenos">240</span></a>        <span class="n">dN_dX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="IGAPatch-241"><a href="#IGAPatch-241"><span class="linenos">241</span></a>            <span class="p">[</span>
</span><span id="IGAPatch-242"><a href="#IGAPatch-242"><span class="linenos">242</span></a>                <span class="nb">sum</span><span class="p">([</span><span class="n">dN_dXI</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">Jinv</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span>
</span><span id="IGAPatch-243"><a href="#IGAPatch-243"><span class="linenos">243</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="IGAPatch-244"><a href="#IGAPatch-244"><span class="linenos">244</span></a>            <span class="p">]</span>
</span><span id="IGAPatch-245"><a href="#IGAPatch-245"><span class="linenos">245</span></a>        <span class="p">)</span>
</span><span id="IGAPatch-246"><a href="#IGAPatch-246"><span class="linenos">246</span></a>        <span class="k">return</span> <span class="n">dN_dX</span>
</span><span id="IGAPatch-247"><a href="#IGAPatch-247"><span class="linenos">247</span></a>
</span><span id="IGAPatch-248"><a href="#IGAPatch-248"><span class="linenos">248</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">make_W</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detJ</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]:</span>
</span><span id="IGAPatch-249"><a href="#IGAPatch-249"><span class="linenos">249</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatch-250"><a href="#IGAPatch-250"><span class="linenos">250</span></a><span class="sd">        Compute the integration weights in physical space for Gaussian quadrature.</span>
</span><span id="IGAPatch-251"><a href="#IGAPatch-251"><span class="linenos">251</span></a>
</span><span id="IGAPatch-252"><a href="#IGAPatch-252"><span class="linenos">252</span></a><span class="sd">        The integration measure W at each quadrature point combines:</span>
</span><span id="IGAPatch-253"><a href="#IGAPatch-253"><span class="linenos">253</span></a><span class="sd">        1. The local volume scaling from the Jacobian determinant `detJ`.</span>
</span><span id="IGAPatch-254"><a href="#IGAPatch-254"><span class="linenos">254</span></a><span class="sd">        2. The parametric quadrature weights (`dxi`, `deta`, `dzeta`) in each direction.</span>
</span><span id="IGAPatch-255"><a href="#IGAPatch-255"><span class="linenos">255</span></a>
</span><span id="IGAPatch-256"><a href="#IGAPatch-256"><span class="linenos">256</span></a><span class="sd">        Mathematically:</span>
</span><span id="IGAPatch-257"><a href="#IGAPatch-257"><span class="linenos">257</span></a><span class="sd">            W = |detJ| * dxi  deta  dzeta</span>
</span><span id="IGAPatch-258"><a href="#IGAPatch-258"><span class="linenos">258</span></a><span class="sd">        with * the pointwise multiplication and  the Kronecker product.</span>
</span><span id="IGAPatch-259"><a href="#IGAPatch-259"><span class="linenos">259</span></a>
</span><span id="IGAPatch-260"><a href="#IGAPatch-260"><span class="linenos">260</span></a><span class="sd">        Parameters</span>
</span><span id="IGAPatch-261"><a href="#IGAPatch-261"><span class="linenos">261</span></a><span class="sd">        ----------</span>
</span><span id="IGAPatch-262"><a href="#IGAPatch-262"><span class="linenos">262</span></a><span class="sd">        detJ : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-263"><a href="#IGAPatch-263"><span class="linenos">263</span></a><span class="sd">            Determinant of the Jacobian at each integration point.</span>
</span><span id="IGAPatch-264"><a href="#IGAPatch-264"><span class="linenos">264</span></a><span class="sd">            Shape: (n_intg_pts,)</span>
</span><span id="IGAPatch-265"><a href="#IGAPatch-265"><span class="linenos">265</span></a>
</span><span id="IGAPatch-266"><a href="#IGAPatch-266"><span class="linenos">266</span></a><span class="sd">        Returns</span>
</span><span id="IGAPatch-267"><a href="#IGAPatch-267"><span class="linenos">267</span></a><span class="sd">        -------</span>
</span><span id="IGAPatch-268"><a href="#IGAPatch-268"><span class="linenos">268</span></a><span class="sd">        W : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-269"><a href="#IGAPatch-269"><span class="linenos">269</span></a><span class="sd">            Integration weights in physical space for each quadrature point.</span>
</span><span id="IGAPatch-270"><a href="#IGAPatch-270"><span class="linenos">270</span></a><span class="sd">            Shape: (n_intg_pts,)</span>
</span><span id="IGAPatch-271"><a href="#IGAPatch-271"><span class="linenos">271</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatch-272"><a href="#IGAPatch-272"><span class="linenos">272</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">detJ</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dxi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deta</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dzeta</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="IGAPatch-273"><a href="#IGAPatch-273"><span class="linenos">273</span></a>        <span class="k">return</span> <span class="n">W</span>
</span><span id="IGAPatch-274"><a href="#IGAPatch-274"><span class="linenos">274</span></a>
</span><span id="IGAPatch-275"><a href="#IGAPatch-275"><span class="linenos">275</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">stiffness</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">:</span>
</span><span id="IGAPatch-276"><a href="#IGAPatch-276"><span class="linenos">276</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatch-277"><a href="#IGAPatch-277"><span class="linenos">277</span></a><span class="sd">        Compute the linear elasticity stiffness matrix for this IGAPatch.</span>
</span><span id="IGAPatch-278"><a href="#IGAPatch-278"><span class="linenos">278</span></a>
</span><span id="IGAPatch-279"><a href="#IGAPatch-279"><span class="linenos">279</span></a><span class="sd">        This method constructs the 3D linear elasticity stiffness matrix</span>
</span><span id="IGAPatch-280"><a href="#IGAPatch-280"><span class="linenos">280</span></a><span class="sd">        using Gaussian quadrature in the parametric space of the B-spline patch.</span>
</span><span id="IGAPatch-281"><a href="#IGAPatch-281"><span class="linenos">281</span></a><span class="sd">        The computation follows standard isogeometric analysis (IGA) procedure:</span>
</span><span id="IGAPatch-282"><a href="#IGAPatch-282"><span class="linenos">282</span></a>
</span><span id="IGAPatch-283"><a href="#IGAPatch-283"><span class="linenos">283</span></a><span class="sd">        1. Evaluate the derivatives of the B-spline shape functions with respect to</span>
</span><span id="IGAPatch-284"><a href="#IGAPatch-284"><span class="linenos">284</span></a><span class="sd">        the parametric coordinates (dN/dXI).</span>
</span><span id="IGAPatch-285"><a href="#IGAPatch-285"><span class="linenos">285</span></a><span class="sd">        2. Compute the Jacobian, its inverse, and determinant at all integration points.</span>
</span><span id="IGAPatch-286"><a href="#IGAPatch-286"><span class="linenos">286</span></a><span class="sd">        3. Transform shape function derivatives to the physical space (dN/dX).</span>
</span><span id="IGAPatch-287"><a href="#IGAPatch-287"><span class="linenos">287</span></a><span class="sd">        4. Build the strain-displacement matrices B (Bxx, Byy, Bzz, Bxy, Byz, Bxz).</span>
</span><span id="IGAPatch-288"><a href="#IGAPatch-288"><span class="linenos">288</span></a><span class="sd">        5. Assemble the stiffness contributions using the material elasticity tensor H</span>
</span><span id="IGAPatch-289"><a href="#IGAPatch-289"><span class="linenos">289</span></a><span class="sd">        and the integration weights W derived from the Jacobian.</span>
</span><span id="IGAPatch-290"><a href="#IGAPatch-290"><span class="linenos">290</span></a><span class="sd">        6. Sum all contributions to obtain the global stiffness matrix `K`.</span>
</span><span id="IGAPatch-291"><a href="#IGAPatch-291"><span class="linenos">291</span></a>
</span><span id="IGAPatch-292"><a href="#IGAPatch-292"><span class="linenos">292</span></a><span class="sd">        Returns</span>
</span><span id="IGAPatch-293"><a href="#IGAPatch-293"><span class="linenos">293</span></a><span class="sd">        -------</span>
</span><span id="IGAPatch-294"><a href="#IGAPatch-294"><span class="linenos">294</span></a><span class="sd">        K : sps.spmatrix</span>
</span><span id="IGAPatch-295"><a href="#IGAPatch-295"><span class="linenos">295</span></a><span class="sd">            Sparse stiffness matrix of the patch.</span>
</span><span id="IGAPatch-296"><a href="#IGAPatch-296"><span class="linenos">296</span></a><span class="sd">            Shape: (3 * n_ctrl_pts, 3 * n_ctrl_pts), in physical coordinates.</span>
</span><span id="IGAPatch-297"><a href="#IGAPatch-297"><span class="linenos">297</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatch-298"><a href="#IGAPatch-298"><span class="linenos">298</span></a>        <span class="n">dN_dXI</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">DN</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeta</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="IGAPatch-299"><a href="#IGAPatch-299"><span class="linenos">299</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">Jinv</span><span class="p">,</span> <span class="n">detJ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jacobian</span><span class="p">(</span><span class="n">dN_dXI</span><span class="p">)</span>
</span><span id="IGAPatch-300"><a href="#IGAPatch-300"><span class="linenos">300</span></a>        <span class="n">dN_dx</span><span class="p">,</span> <span class="n">dN_dy</span><span class="p">,</span> <span class="n">dN_dz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grad_N</span><span class="p">(</span><span class="n">Jinv</span><span class="p">,</span> <span class="n">dN_dXI</span><span class="p">)</span>
</span><span id="IGAPatch-301"><a href="#IGAPatch-301"><span class="linenos">301</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_W</span><span class="p">(</span><span class="n">detJ</span><span class="p">)</span>
</span><span id="IGAPatch-302"><a href="#IGAPatch-302"><span class="linenos">302</span></a>        <span class="c1"># B = sps.bmat([[dN_dx, None, None],</span>
</span><span id="IGAPatch-303"><a href="#IGAPatch-303"><span class="linenos">303</span></a>        <span class="c1">#               [None, dN_dy, None],</span>
</span><span id="IGAPatch-304"><a href="#IGAPatch-304"><span class="linenos">304</span></a>        <span class="c1">#               [None, None, dN_dz],</span>
</span><span id="IGAPatch-305"><a href="#IGAPatch-305"><span class="linenos">305</span></a>        <span class="c1">#               [dN_dy, dN_dx, None],</span>
</span><span id="IGAPatch-306"><a href="#IGAPatch-306"><span class="linenos">306</span></a>        <span class="c1">#               [None, dN_dz, dN_dy],</span>
</span><span id="IGAPatch-307"><a href="#IGAPatch-307"><span class="linenos">307</span></a>        <span class="c1">#               [dN_dz, None, dN_dx]])</span>
</span><span id="IGAPatch-308"><a href="#IGAPatch-308"><span class="linenos">308</span></a>
</span><span id="IGAPatch-309"><a href="#IGAPatch-309"><span class="linenos">309</span></a>        <span class="n">Z</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">coo_matrix</span><span class="p">(</span><span class="n">dN_dx</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
</span><span id="IGAPatch-310"><a href="#IGAPatch-310"><span class="linenos">310</span></a>        <span class="n">Bxx</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">dN_dx</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">Z</span><span class="p">))</span>
</span><span id="IGAPatch-311"><a href="#IGAPatch-311"><span class="linenos">311</span></a>        <span class="n">Byy</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Z</span><span class="p">,</span> <span class="n">dN_dy</span><span class="p">,</span> <span class="n">Z</span><span class="p">))</span>
</span><span id="IGAPatch-312"><a href="#IGAPatch-312"><span class="linenos">312</span></a>        <span class="n">Bzz</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Z</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">dN_dz</span><span class="p">))</span>
</span><span id="IGAPatch-313"><a href="#IGAPatch-313"><span class="linenos">313</span></a>        <span class="n">Bxy</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">dN_dy</span><span class="p">,</span> <span class="n">dN_dx</span><span class="p">,</span> <span class="n">Z</span><span class="p">))</span>
</span><span id="IGAPatch-314"><a href="#IGAPatch-314"><span class="linenos">314</span></a>        <span class="n">Byz</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Z</span><span class="p">,</span> <span class="n">dN_dz</span><span class="p">,</span> <span class="n">dN_dy</span><span class="p">))</span>
</span><span id="IGAPatch-315"><a href="#IGAPatch-315"><span class="linenos">315</span></a>        <span class="n">Bxz</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">dN_dz</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">dN_dx</span><span class="p">))</span>
</span><span id="IGAPatch-316"><a href="#IGAPatch-316"><span class="linenos">316</span></a>        <span class="n">K0</span> <span class="o">=</span> <span class="n">Bxx</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bzz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxz</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="IGAPatch-317"><a href="#IGAPatch-317"><span class="linenos">317</span></a>        <span class="n">K1</span> <span class="o">=</span> <span class="n">Byy</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bzz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxz</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="IGAPatch-318"><a href="#IGAPatch-318"><span class="linenos">318</span></a>        <span class="n">K2</span> <span class="o">=</span> <span class="n">Bzz</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bzz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxz</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="IGAPatch-319"><a href="#IGAPatch-319"><span class="linenos">319</span></a>        <span class="n">K3</span> <span class="o">=</span> <span class="n">Bxy</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bzz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxz</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="IGAPatch-320"><a href="#IGAPatch-320"><span class="linenos">320</span></a>        <span class="n">K4</span> <span class="o">=</span> <span class="n">Byz</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bzz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxz</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="IGAPatch-321"><a href="#IGAPatch-321"><span class="linenos">321</span></a>        <span class="n">K5</span> <span class="o">=</span> <span class="n">Bxz</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bzz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxz</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="IGAPatch-322"><a href="#IGAPatch-322"><span class="linenos">322</span></a>        <span class="n">K</span><span class="p">:</span> <span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">K0</span><span class="p">,</span> <span class="n">K1</span><span class="p">,</span> <span class="n">K2</span><span class="p">,</span> <span class="n">K3</span><span class="p">,</span> <span class="n">K4</span><span class="p">,</span> <span class="n">K5</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
</span><span id="IGAPatch-323"><a href="#IGAPatch-323"><span class="linenos">323</span></a>        <span class="k">return</span> <span class="n">K</span>
</span><span id="IGAPatch-324"><a href="#IGAPatch-324"><span class="linenos">324</span></a>
</span><span id="IGAPatch-325"><a href="#IGAPatch-325"><span class="linenos">325</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">rhs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]:</span>
</span><span id="IGAPatch-326"><a href="#IGAPatch-326"><span class="linenos">326</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatch-327"><a href="#IGAPatch-327"><span class="linenos">327</span></a><span class="sd">        Compute the right-hand side (load) vector for this `IGAPatch`.</span>
</span><span id="IGAPatch-328"><a href="#IGAPatch-328"><span class="linenos">328</span></a>
</span><span id="IGAPatch-329"><a href="#IGAPatch-329"><span class="linenos">329</span></a><span class="sd">        This method assembles the contribution of the surface forces applied on the</span>
</span><span id="IGAPatch-330"><a href="#IGAPatch-330"><span class="linenos">330</span></a><span class="sd">        patch boundary. It uses Gaussian quadrature along the patch faces where</span>
</span><span id="IGAPatch-331"><a href="#IGAPatch-331"><span class="linenos">331</span></a><span class="sd">        forces are defined. The procedure is:</span>
</span><span id="IGAPatch-332"><a href="#IGAPatch-332"><span class="linenos">332</span></a>
</span><span id="IGAPatch-333"><a href="#IGAPatch-333"><span class="linenos">333</span></a><span class="sd">        1. Loop over each physical axis (x, y, z) and each side of the patch (0=lower, 1=upper).</span>
</span><span id="IGAPatch-334"><a href="#IGAPatch-334"><span class="linenos">334</span></a><span class="sd">        2. Skip faces with zero surface forces.</span>
</span><span id="IGAPatch-335"><a href="#IGAPatch-335"><span class="linenos">335</span></a><span class="sd">        3. For each face with a force:</span>
</span><span id="IGAPatch-336"><a href="#IGAPatch-336"><span class="linenos">336</span></a><span class="sd">            a. Select the isoparametric coordinate corresponding to the face.</span>
</span><span id="IGAPatch-337"><a href="#IGAPatch-337"><span class="linenos">337</span></a><span class="sd">            b. Compute the shape functions `N` and their derivatives along the face.</span>
</span><span id="IGAPatch-338"><a href="#IGAPatch-338"><span class="linenos">338</span></a><span class="sd">            c. Compute the surface measure `dS` using the cross product of</span>
</span><span id="IGAPatch-339"><a href="#IGAPatch-339"><span class="linenos">339</span></a><span class="sd">                tangent vectors to the surface and parametric quadrature weights.</span>
</span><span id="IGAPatch-340"><a href="#IGAPatch-340"><span class="linenos">340</span></a><span class="sd">            d. Integrate the contribution of the shape functions over the surface.</span>
</span><span id="IGAPatch-341"><a href="#IGAPatch-341"><span class="linenos">341</span></a><span class="sd">        4. Sum all face contributions into the global right-hand side vector.</span>
</span><span id="IGAPatch-342"><a href="#IGAPatch-342"><span class="linenos">342</span></a>
</span><span id="IGAPatch-343"><a href="#IGAPatch-343"><span class="linenos">343</span></a><span class="sd">        Returns</span>
</span><span id="IGAPatch-344"><a href="#IGAPatch-344"><span class="linenos">344</span></a><span class="sd">        -------</span>
</span><span id="IGAPatch-345"><a href="#IGAPatch-345"><span class="linenos">345</span></a><span class="sd">        rhs : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-346"><a href="#IGAPatch-346"><span class="linenos">346</span></a><span class="sd">            Right-hand side vector for the patch.</span>
</span><span id="IGAPatch-347"><a href="#IGAPatch-347"><span class="linenos">347</span></a><span class="sd">            Shape: (3 * n_ctrl_pts,), in physical coordinates.</span>
</span><span id="IGAPatch-348"><a href="#IGAPatch-348"><span class="linenos">348</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatch-349"><a href="#IGAPatch-349"><span class="linenos">349</span></a>        <span class="n">rhs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
</span><span id="IGAPatch-350"><a href="#IGAPatch-350"><span class="linenos">350</span></a>        <span class="n">XI</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeta</span><span class="p">]</span>
</span><span id="IGAPatch-351"><a href="#IGAPatch-351"><span class="linenos">351</span></a>        <span class="n">dXI</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dxi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dzeta</span><span class="p">]</span>
</span><span id="IGAPatch-352"><a href="#IGAPatch-352"><span class="linenos">352</span></a>        <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
</span><span id="IGAPatch-353"><a href="#IGAPatch-353"><span class="linenos">353</span></a>            <span class="k">for</span> <span class="n">side</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
</span><span id="IGAPatch-354"><a href="#IGAPatch-354"><span class="linenos">354</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">F_N</span><span class="p">[</span><span class="n">axis</span><span class="p">,</span> <span class="n">side</span><span class="p">],</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="IGAPatch-355"><a href="#IGAPatch-355"><span class="linenos">355</span></a>                    <span class="n">xi</span> <span class="o">=</span> <span class="p">[</span><span class="n">xi_i</span> <span class="k">for</span> <span class="n">xi_i</span> <span class="ow">in</span> <span class="n">XI</span><span class="p">]</span>
</span><span id="IGAPatch-356"><a href="#IGAPatch-356"><span class="linenos">356</span></a>                    <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="IGAPatch-357"><a href="#IGAPatch-357"><span class="linenos">357</span></a>                        <span class="n">xi</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">bases</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</span><span id="IGAPatch-358"><a href="#IGAPatch-358"><span class="linenos">358</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="IGAPatch-359"><a href="#IGAPatch-359"><span class="linenos">359</span></a>                        <span class="n">xi</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">bases</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
</span><span id="IGAPatch-360"><a href="#IGAPatch-360"><span class="linenos">360</span></a>                    <span class="n">dxi</span> <span class="o">=</span> <span class="p">[</span><span class="n">dxi_i</span> <span class="k">for</span> <span class="n">dxi_i</span> <span class="ow">in</span> <span class="n">dXI</span><span class="p">]</span>
</span><span id="IGAPatch-361"><a href="#IGAPatch-361"><span class="linenos">361</span></a>                    <span class="n">dxi</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="IGAPatch-362"><a href="#IGAPatch-362"><span class="linenos">362</span></a>                    <span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">DN</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>
</span><span id="IGAPatch-363"><a href="#IGAPatch-363"><span class="linenos">363</span></a>                    <span class="n">k1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)[(</span><span class="n">axis</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="IGAPatch-364"><a href="#IGAPatch-364"><span class="linenos">364</span></a>                    <span class="n">k2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)[(</span><span class="n">axis</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="IGAPatch-365"><a href="#IGAPatch-365"><span class="linenos">365</span></a>                    <span class="n">dX1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="IGAPatch-366"><a href="#IGAPatch-366"><span class="linenos">366</span></a>                    <span class="n">dX2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k2</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="IGAPatch-367"><a href="#IGAPatch-367"><span class="linenos">367</span></a>                    <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">dX1</span><span class="p">,</span> <span class="n">dX2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="IGAPatch-368"><a href="#IGAPatch-368"><span class="linenos">368</span></a>                    <span class="n">dxi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">dxi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">dxi</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dxi</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="IGAPatch-369"><a href="#IGAPatch-369"><span class="linenos">369</span></a>                    <span class="n">dS</span> <span class="o">=</span> <span class="n">J</span> <span class="o">*</span> <span class="n">dxi</span>
</span><span id="IGAPatch-370"><a href="#IGAPatch-370"><span class="linenos">370</span></a>                    <span class="n">intg</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">dS</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
</span><span id="IGAPatch-371"><a href="#IGAPatch-371"><span class="linenos">371</span></a>                    <span class="n">rhs</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">F_N</span><span class="p">[</span><span class="n">axis</span><span class="p">,</span> <span class="n">side</span><span class="p">],</span> <span class="n">intg</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="IGAPatch-372"><a href="#IGAPatch-372"><span class="linenos">372</span></a>        <span class="k">return</span> <span class="n">rhs</span>
</span><span id="IGAPatch-373"><a href="#IGAPatch-373"><span class="linenos">373</span></a>
</span><span id="IGAPatch-374"><a href="#IGAPatch-374"><span class="linenos">374</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">area_border</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">front_side</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="IGAPatch-375"><a href="#IGAPatch-375"><span class="linenos">375</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatch-376"><a href="#IGAPatch-376"><span class="linenos">376</span></a><span class="sd">        Compute the total surface area of a patch face across a given axis.</span>
</span><span id="IGAPatch-377"><a href="#IGAPatch-377"><span class="linenos">377</span></a>
</span><span id="IGAPatch-378"><a href="#IGAPatch-378"><span class="linenos">378</span></a><span class="sd">        The face is defined by fixing one parametric coordinate (`xi`, `eta`, or `zeta`)</span>
</span><span id="IGAPatch-379"><a href="#IGAPatch-379"><span class="linenos">379</span></a><span class="sd">        to either its front or back boundary. The surface area is computed by</span>
</span><span id="IGAPatch-380"><a href="#IGAPatch-380"><span class="linenos">380</span></a><span class="sd">        integrating the differential surface measure over the face using</span>
</span><span id="IGAPatch-381"><a href="#IGAPatch-381"><span class="linenos">381</span></a><span class="sd">        the Gaussian quadrature points and weights.</span>
</span><span id="IGAPatch-382"><a href="#IGAPatch-382"><span class="linenos">382</span></a>
</span><span id="IGAPatch-383"><a href="#IGAPatch-383"><span class="linenos">383</span></a><span class="sd">        Parameters</span>
</span><span id="IGAPatch-384"><a href="#IGAPatch-384"><span class="linenos">384</span></a><span class="sd">        ----------</span>
</span><span id="IGAPatch-385"><a href="#IGAPatch-385"><span class="linenos">385</span></a><span class="sd">        axis : int</span>
</span><span id="IGAPatch-386"><a href="#IGAPatch-386"><span class="linenos">386</span></a><span class="sd">            Axis across which the face is oriented:</span>
</span><span id="IGAPatch-387"><a href="#IGAPatch-387"><span class="linenos">387</span></a><span class="sd">            0  xi, 1  eta, 2  zeta.</span>
</span><span id="IGAPatch-388"><a href="#IGAPatch-388"><span class="linenos">388</span></a><span class="sd">        front_side : bool</span>
</span><span id="IGAPatch-389"><a href="#IGAPatch-389"><span class="linenos">389</span></a><span class="sd">            If True, select the &quot;front&quot; boundary across the given axis;</span>
</span><span id="IGAPatch-390"><a href="#IGAPatch-390"><span class="linenos">390</span></a><span class="sd">            otherwise, select the &quot;back&quot; boundary.</span>
</span><span id="IGAPatch-391"><a href="#IGAPatch-391"><span class="linenos">391</span></a>
</span><span id="IGAPatch-392"><a href="#IGAPatch-392"><span class="linenos">392</span></a><span class="sd">        Returns</span>
</span><span id="IGAPatch-393"><a href="#IGAPatch-393"><span class="linenos">393</span></a><span class="sd">        -------</span>
</span><span id="IGAPatch-394"><a href="#IGAPatch-394"><span class="linenos">394</span></a><span class="sd">        area : float</span>
</span><span id="IGAPatch-395"><a href="#IGAPatch-395"><span class="linenos">395</span></a><span class="sd">            Total surface area of the specified patch face in physical space.</span>
</span><span id="IGAPatch-396"><a href="#IGAPatch-396"><span class="linenos">396</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatch-397"><a href="#IGAPatch-397"><span class="linenos">397</span></a>        <span class="n">XI</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeta</span><span class="p">]</span>
</span><span id="IGAPatch-398"><a href="#IGAPatch-398"><span class="linenos">398</span></a>        <span class="n">xi</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="IGAPatch-399"><a href="#IGAPatch-399"><span class="linenos">399</span></a>            <span class="p">(</span>
</span><span id="IGAPatch-400"><a href="#IGAPatch-400"><span class="linenos">400</span></a>                <span class="n">XI</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="IGAPatch-401"><a href="#IGAPatch-401"><span class="linenos">401</span></a>                <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">axis</span>
</span><span id="IGAPatch-402"><a href="#IGAPatch-402"><span class="linenos">402</span></a>                <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="IGAPatch-403"><a href="#IGAPatch-403"><span class="linenos">403</span></a>                    <span class="p">[</span>
</span><span id="IGAPatch-404"><a href="#IGAPatch-404"><span class="linenos">404</span></a>                        <span class="p">(</span>
</span><span id="IGAPatch-405"><a href="#IGAPatch-405"><span class="linenos">405</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">bases</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="IGAPatch-406"><a href="#IGAPatch-406"><span class="linenos">406</span></a>                            <span class="k">if</span> <span class="n">front_side</span>
</span><span id="IGAPatch-407"><a href="#IGAPatch-407"><span class="linenos">407</span></a>                            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">bases</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="IGAPatch-408"><a href="#IGAPatch-408"><span class="linenos">408</span></a>                        <span class="p">)</span>
</span><span id="IGAPatch-409"><a href="#IGAPatch-409"><span class="linenos">409</span></a>                    <span class="p">]</span>
</span><span id="IGAPatch-410"><a href="#IGAPatch-410"><span class="linenos">410</span></a>                <span class="p">)</span>
</span><span id="IGAPatch-411"><a href="#IGAPatch-411"><span class="linenos">411</span></a>            <span class="p">)</span>
</span><span id="IGAPatch-412"><a href="#IGAPatch-412"><span class="linenos">412</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="IGAPatch-413"><a href="#IGAPatch-413"><span class="linenos">413</span></a>        <span class="p">]</span>
</span><span id="IGAPatch-414"><a href="#IGAPatch-414"><span class="linenos">414</span></a>        <span class="n">dXI</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dxi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dzeta</span><span class="p">]</span>
</span><span id="IGAPatch-415"><a href="#IGAPatch-415"><span class="linenos">415</span></a>        <span class="n">dxi</span> <span class="o">=</span> <span class="p">[</span><span class="n">dXI</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">axis</span><span class="p">]</span>
</span><span id="IGAPatch-416"><a href="#IGAPatch-416"><span class="linenos">416</span></a>        <span class="n">dN1</span><span class="p">,</span> <span class="n">dN2</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="IGAPatch-417"><a href="#IGAPatch-417"><span class="linenos">417</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">DN</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="IGAPatch-418"><a href="#IGAPatch-418"><span class="linenos">418</span></a>            <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</span><span id="IGAPatch-419"><a href="#IGAPatch-419"><span class="linenos">419</span></a>            <span class="k">if</span> <span class="n">ax</span> <span class="o">!=</span> <span class="n">axis</span>
</span><span id="IGAPatch-420"><a href="#IGAPatch-420"><span class="linenos">420</span></a>        <span class="p">]</span>
</span><span id="IGAPatch-421"><a href="#IGAPatch-421"><span class="linenos">421</span></a>        <span class="n">dSdXI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
</span><span id="IGAPatch-422"><a href="#IGAPatch-422"><span class="linenos">422</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span>
</span><span id="IGAPatch-423"><a href="#IGAPatch-423"><span class="linenos">423</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">@</span> <span class="n">dN1</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
</span><span id="IGAPatch-424"><a href="#IGAPatch-424"><span class="linenos">424</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">@</span> <span class="n">dN2</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
</span><span id="IGAPatch-425"><a href="#IGAPatch-425"><span class="linenos">425</span></a>                <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="IGAPatch-426"><a href="#IGAPatch-426"><span class="linenos">426</span></a>            <span class="p">),</span>
</span><span id="IGAPatch-427"><a href="#IGAPatch-427"><span class="linenos">427</span></a>            <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="IGAPatch-428"><a href="#IGAPatch-428"><span class="linenos">428</span></a>        <span class="p">)</span>
</span><span id="IGAPatch-429"><a href="#IGAPatch-429"><span class="linenos">429</span></a>        <span class="n">dXI_area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="o">*</span><span class="n">dxi</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="IGAPatch-430"><a href="#IGAPatch-430"><span class="linenos">430</span></a>        <span class="n">area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dSdXI</span><span class="p">,</span> <span class="n">dXI_area</span><span class="p">)</span>
</span><span id="IGAPatch-431"><a href="#IGAPatch-431"><span class="linenos">431</span></a>        <span class="k">return</span> <span class="n">area</span>
</span><span id="IGAPatch-432"><a href="#IGAPatch-432"><span class="linenos">432</span></a>
</span><span id="IGAPatch-433"><a href="#IGAPatch-433"><span class="linenos">433</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">epsilon</span><span class="p">(</span>
</span><span id="IGAPatch-434"><a href="#IGAPatch-434"><span class="linenos">434</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">U</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="n">XI</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]]</span>
</span><span id="IGAPatch-435"><a href="#IGAPatch-435"><span class="linenos">435</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]:</span>
</span><span id="IGAPatch-436"><a href="#IGAPatch-436"><span class="linenos">436</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatch-437"><a href="#IGAPatch-437"><span class="linenos">437</span></a><span class="sd">        Compute the strain tensor in Voigt notation for the patch.</span>
</span><span id="IGAPatch-438"><a href="#IGAPatch-438"><span class="linenos">438</span></a>
</span><span id="IGAPatch-439"><a href="#IGAPatch-439"><span class="linenos">439</span></a><span class="sd">        The strain tensor is computed as:</span>
</span><span id="IGAPatch-440"><a href="#IGAPatch-440"><span class="linenos">440</span></a><span class="sd">            eps = [_xx, _yy, _zz, _xy, _yz, _xz]^T</span>
</span><span id="IGAPatch-441"><a href="#IGAPatch-441"><span class="linenos">441</span></a><span class="sd">        using the displacement field `U` and the isoparametric coordinates `XI`.</span>
</span><span id="IGAPatch-442"><a href="#IGAPatch-442"><span class="linenos">442</span></a><span class="sd">        Small adjustments are applied at the parametric boundaries to avoid</span>
</span><span id="IGAPatch-443"><a href="#IGAPatch-443"><span class="linenos">443</span></a><span class="sd">        evaluation exactly on the control point spans.</span>
</span><span id="IGAPatch-444"><a href="#IGAPatch-444"><span class="linenos">444</span></a>
</span><span id="IGAPatch-445"><a href="#IGAPatch-445"><span class="linenos">445</span></a><span class="sd">        Parameters</span>
</span><span id="IGAPatch-446"><a href="#IGAPatch-446"><span class="linenos">446</span></a><span class="sd">        ----------</span>
</span><span id="IGAPatch-447"><a href="#IGAPatch-447"><span class="linenos">447</span></a><span class="sd">        U : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-448"><a href="#IGAPatch-448"><span class="linenos">448</span></a><span class="sd">            Displacement field of shape (3, nb_ctrl_pts), with the first dimension</span>
</span><span id="IGAPatch-449"><a href="#IGAPatch-449"><span class="linenos">449</span></a><span class="sd">            corresponding to the physical coordinates (x, y, z).</span>
</span><span id="IGAPatch-450"><a href="#IGAPatch-450"><span class="linenos">450</span></a><span class="sd">        XI : list[np.ndarray[np.floating]]</span>
</span><span id="IGAPatch-451"><a href="#IGAPatch-451"><span class="linenos">451</span></a><span class="sd">            List of arrays for the parametric coordinates in each direction</span>
</span><span id="IGAPatch-452"><a href="#IGAPatch-452"><span class="linenos">452</span></a><span class="sd">            [xi, eta, zeta].</span>
</span><span id="IGAPatch-453"><a href="#IGAPatch-453"><span class="linenos">453</span></a>
</span><span id="IGAPatch-454"><a href="#IGAPatch-454"><span class="linenos">454</span></a><span class="sd">        Returns</span>
</span><span id="IGAPatch-455"><a href="#IGAPatch-455"><span class="linenos">455</span></a><span class="sd">        -------</span>
</span><span id="IGAPatch-456"><a href="#IGAPatch-456"><span class="linenos">456</span></a><span class="sd">        eps : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-457"><a href="#IGAPatch-457"><span class="linenos">457</span></a><span class="sd">            Strain tensor in Voigt notation, shape (6, n_param_pts),</span>
</span><span id="IGAPatch-458"><a href="#IGAPatch-458"><span class="linenos">458</span></a><span class="sd">            where n_param_pts = product of lengths of XI arrays.</span>
</span><span id="IGAPatch-459"><a href="#IGAPatch-459"><span class="linenos">459</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatch-460"><a href="#IGAPatch-460"><span class="linenos">460</span></a>        <span class="k">for</span> <span class="n">xi</span><span class="p">,</span> <span class="n">basis</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">XI</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">bases</span><span class="p">):</span>
</span><span id="IGAPatch-461"><a href="#IGAPatch-461"><span class="linenos">461</span></a>            <span class="n">xi</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">basis</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)]</span> <span class="o">+=</span> <span class="mf">1e-5</span>
</span><span id="IGAPatch-462"><a href="#IGAPatch-462"><span class="linenos">462</span></a>            <span class="n">xi</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">basis</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)]</span> <span class="o">-=</span> <span class="mf">1e-5</span>
</span><span id="IGAPatch-463"><a href="#IGAPatch-463"><span class="linenos">463</span></a>        <span class="n">dN_dXI</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">DN</span><span class="p">(</span><span class="n">XI</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="IGAPatch-464"><a href="#IGAPatch-464"><span class="linenos">464</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">Jinv</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jacobian</span><span class="p">(</span><span class="n">dN_dXI</span><span class="p">)</span>  <span class="c1"># dXI_dX</span>
</span><span id="IGAPatch-465"><a href="#IGAPatch-465"><span class="linenos">465</span></a>        <span class="n">dN_dx</span><span class="p">,</span> <span class="n">dN_dy</span><span class="p">,</span> <span class="n">dN_dz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grad_N</span><span class="p">(</span><span class="n">Jinv</span><span class="p">,</span> <span class="n">dN_dXI</span><span class="p">)</span>
</span><span id="IGAPatch-466"><a href="#IGAPatch-466"><span class="linenos">466</span></a>        <span class="n">eps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="IGAPatch-467"><a href="#IGAPatch-467"><span class="linenos">467</span></a>            <span class="p">[</span>
</span><span id="IGAPatch-468"><a href="#IGAPatch-468"><span class="linenos">468</span></a>                <span class="n">dN_dx</span> <span class="o">@</span> <span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
</span><span id="IGAPatch-469"><a href="#IGAPatch-469"><span class="linenos">469</span></a>                <span class="n">dN_dy</span> <span class="o">@</span> <span class="n">U</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
</span><span id="IGAPatch-470"><a href="#IGAPatch-470"><span class="linenos">470</span></a>                <span class="n">dN_dz</span> <span class="o">@</span> <span class="n">U</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
</span><span id="IGAPatch-471"><a href="#IGAPatch-471"><span class="linenos">471</span></a>                <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">dN_dy</span> <span class="o">@</span> <span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="o">+</span> <span class="n">dN_dx</span> <span class="o">@</span> <span class="n">U</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()),</span>
</span><span id="IGAPatch-472"><a href="#IGAPatch-472"><span class="linenos">472</span></a>                <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">dN_dz</span> <span class="o">@</span> <span class="n">U</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="o">+</span> <span class="n">dN_dy</span> <span class="o">@</span> <span class="n">U</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()),</span>
</span><span id="IGAPatch-473"><a href="#IGAPatch-473"><span class="linenos">473</span></a>                <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">dN_dz</span> <span class="o">@</span> <span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="o">+</span> <span class="n">dN_dx</span> <span class="o">@</span> <span class="n">U</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()),</span>
</span><span id="IGAPatch-474"><a href="#IGAPatch-474"><span class="linenos">474</span></a>            <span class="p">]</span>
</span><span id="IGAPatch-475"><a href="#IGAPatch-475"><span class="linenos">475</span></a>        <span class="p">)</span>
</span><span id="IGAPatch-476"><a href="#IGAPatch-476"><span class="linenos">476</span></a>        <span class="k">return</span> <span class="n">eps</span>
</span><span id="IGAPatch-477"><a href="#IGAPatch-477"><span class="linenos">477</span></a>
</span><span id="IGAPatch-478"><a href="#IGAPatch-478"><span class="linenos">478</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">sigma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eps</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]:</span>
</span><span id="IGAPatch-479"><a href="#IGAPatch-479"><span class="linenos">479</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatch-480"><a href="#IGAPatch-480"><span class="linenos">480</span></a><span class="sd">        Compute the stress tensor in Voigt notation for the patch.</span>
</span><span id="IGAPatch-481"><a href="#IGAPatch-481"><span class="linenos">481</span></a>
</span><span id="IGAPatch-482"><a href="#IGAPatch-482"><span class="linenos">482</span></a><span class="sd">        The stress tensor is computed as:</span>
</span><span id="IGAPatch-483"><a href="#IGAPatch-483"><span class="linenos">483</span></a><span class="sd">            sigma = H @ eps</span>
</span><span id="IGAPatch-484"><a href="#IGAPatch-484"><span class="linenos">484</span></a><span class="sd">        where H is the linear elasticity matrix of the material.</span>
</span><span id="IGAPatch-485"><a href="#IGAPatch-485"><span class="linenos">485</span></a>
</span><span id="IGAPatch-486"><a href="#IGAPatch-486"><span class="linenos">486</span></a><span class="sd">        Parameters</span>
</span><span id="IGAPatch-487"><a href="#IGAPatch-487"><span class="linenos">487</span></a><span class="sd">        ----------</span>
</span><span id="IGAPatch-488"><a href="#IGAPatch-488"><span class="linenos">488</span></a><span class="sd">        eps : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-489"><a href="#IGAPatch-489"><span class="linenos">489</span></a><span class="sd">            Strain tensor in Voigt notation, shape (6, n_param_pts).</span>
</span><span id="IGAPatch-490"><a href="#IGAPatch-490"><span class="linenos">490</span></a>
</span><span id="IGAPatch-491"><a href="#IGAPatch-491"><span class="linenos">491</span></a><span class="sd">        Returns</span>
</span><span id="IGAPatch-492"><a href="#IGAPatch-492"><span class="linenos">492</span></a><span class="sd">        -------</span>
</span><span id="IGAPatch-493"><a href="#IGAPatch-493"><span class="linenos">493</span></a><span class="sd">        sig : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-494"><a href="#IGAPatch-494"><span class="linenos">494</span></a><span class="sd">            Stress tensor in Voigt notation, shape (6, n_param_pts).</span>
</span><span id="IGAPatch-495"><a href="#IGAPatch-495"><span class="linenos">495</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatch-496"><a href="#IGAPatch-496"><span class="linenos">496</span></a>        <span class="n">eps</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span> <span class="o">*=</span> <span class="mi">2</span>
</span><span id="IGAPatch-497"><a href="#IGAPatch-497"><span class="linenos">497</span></a>        <span class="n">sig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">@</span> <span class="n">eps</span>
</span><span id="IGAPatch-498"><a href="#IGAPatch-498"><span class="linenos">498</span></a>        <span class="k">return</span> <span class="n">sig</span>
</span><span id="IGAPatch-499"><a href="#IGAPatch-499"><span class="linenos">499</span></a>
</span><span id="IGAPatch-500"><a href="#IGAPatch-500"><span class="linenos">500</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">sigma_eig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]:</span>
</span><span id="IGAPatch-501"><a href="#IGAPatch-501"><span class="linenos">501</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatch-502"><a href="#IGAPatch-502"><span class="linenos">502</span></a><span class="sd">        Compute the principal stresses (eigenvalues of the stress tensor)</span>
</span><span id="IGAPatch-503"><a href="#IGAPatch-503"><span class="linenos">503</span></a><span class="sd">        at the specified parametric points.</span>
</span><span id="IGAPatch-504"><a href="#IGAPatch-504"><span class="linenos">504</span></a>
</span><span id="IGAPatch-505"><a href="#IGAPatch-505"><span class="linenos">505</span></a><span class="sd">        The stress tensor is first converted from Voigt notation to</span>
</span><span id="IGAPatch-506"><a href="#IGAPatch-506"><span class="linenos">506</span></a><span class="sd">        full 3x3 tensors before computing eigenvalues.</span>
</span><span id="IGAPatch-507"><a href="#IGAPatch-507"><span class="linenos">507</span></a>
</span><span id="IGAPatch-508"><a href="#IGAPatch-508"><span class="linenos">508</span></a><span class="sd">        Parameters</span>
</span><span id="IGAPatch-509"><a href="#IGAPatch-509"><span class="linenos">509</span></a><span class="sd">        ----------</span>
</span><span id="IGAPatch-510"><a href="#IGAPatch-510"><span class="linenos">510</span></a><span class="sd">        sig : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-511"><a href="#IGAPatch-511"><span class="linenos">511</span></a><span class="sd">            Stress tensor in Voigt notation, shape (6, n_param_pts).</span>
</span><span id="IGAPatch-512"><a href="#IGAPatch-512"><span class="linenos">512</span></a>
</span><span id="IGAPatch-513"><a href="#IGAPatch-513"><span class="linenos">513</span></a><span class="sd">        Returns</span>
</span><span id="IGAPatch-514"><a href="#IGAPatch-514"><span class="linenos">514</span></a><span class="sd">        -------</span>
</span><span id="IGAPatch-515"><a href="#IGAPatch-515"><span class="linenos">515</span></a><span class="sd">        sig_eig : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-516"><a href="#IGAPatch-516"><span class="linenos">516</span></a><span class="sd">            Principal stresses (eigenvalues) of shape (n_param_pts, 3),</span>
</span><span id="IGAPatch-517"><a href="#IGAPatch-517"><span class="linenos">517</span></a><span class="sd">            sorted by magnitude.</span>
</span><span id="IGAPatch-518"><a href="#IGAPatch-518"><span class="linenos">518</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatch-519"><a href="#IGAPatch-519"><span class="linenos">519</span></a>        <span class="n">sig</span> <span class="o">=</span> <span class="n">sig</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])]</span>
</span><span id="IGAPatch-520"><a href="#IGAPatch-520"><span class="linenos">520</span></a>        <span class="n">sig_eig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvalsh</span><span class="p">(</span><span class="n">sig</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span><span class="o">.</span><span class="n">T</span>
</span><span id="IGAPatch-521"><a href="#IGAPatch-521"><span class="linenos">521</span></a>        <span class="n">order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sig_eig</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="IGAPatch-522"><a href="#IGAPatch-522"><span class="linenos">522</span></a>        <span class="n">sig_eig</span> <span class="o">=</span> <span class="n">sig_eig</span><span class="p">[</span><span class="n">order</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">sig_eig</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="kc">None</span><span class="p">]]</span>
</span><span id="IGAPatch-523"><a href="#IGAPatch-523"><span class="linenos">523</span></a>        <span class="k">return</span> <span class="n">sig_eig</span>
</span><span id="IGAPatch-524"><a href="#IGAPatch-524"><span class="linenos">524</span></a>
</span><span id="IGAPatch-525"><a href="#IGAPatch-525"><span class="linenos">525</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">von_mises</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig_eig</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]:</span>
</span><span id="IGAPatch-526"><a href="#IGAPatch-526"><span class="linenos">526</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatch-527"><a href="#IGAPatch-527"><span class="linenos">527</span></a><span class="sd">        Compute the von Mises equivalent stress at the specified parametric points.</span>
</span><span id="IGAPatch-528"><a href="#IGAPatch-528"><span class="linenos">528</span></a>
</span><span id="IGAPatch-529"><a href="#IGAPatch-529"><span class="linenos">529</span></a><span class="sd">        The von Mises stress is computed from the principal stresses (eigenvalues</span>
</span><span id="IGAPatch-530"><a href="#IGAPatch-530"><span class="linenos">530</span></a><span class="sd">        of the stress tensor) as a scalar measure of the deviatoric stress.</span>
</span><span id="IGAPatch-531"><a href="#IGAPatch-531"><span class="linenos">531</span></a>
</span><span id="IGAPatch-532"><a href="#IGAPatch-532"><span class="linenos">532</span></a><span class="sd">        Parameters</span>
</span><span id="IGAPatch-533"><a href="#IGAPatch-533"><span class="linenos">533</span></a><span class="sd">        ----------</span>
</span><span id="IGAPatch-534"><a href="#IGAPatch-534"><span class="linenos">534</span></a><span class="sd">        sig_eig : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-535"><a href="#IGAPatch-535"><span class="linenos">535</span></a><span class="sd">            Principal stresses (eigenvalues) of shape (n_param_pts, 3),</span>
</span><span id="IGAPatch-536"><a href="#IGAPatch-536"><span class="linenos">536</span></a><span class="sd">            sorted by magnitude.</span>
</span><span id="IGAPatch-537"><a href="#IGAPatch-537"><span class="linenos">537</span></a>
</span><span id="IGAPatch-538"><a href="#IGAPatch-538"><span class="linenos">538</span></a><span class="sd">        Returns</span>
</span><span id="IGAPatch-539"><a href="#IGAPatch-539"><span class="linenos">539</span></a><span class="sd">        -------</span>
</span><span id="IGAPatch-540"><a href="#IGAPatch-540"><span class="linenos">540</span></a><span class="sd">        vm : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-541"><a href="#IGAPatch-541"><span class="linenos">541</span></a><span class="sd">            Von Mises stress at each parametric point, shape (n_param_pts,).</span>
</span><span id="IGAPatch-542"><a href="#IGAPatch-542"><span class="linenos">542</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatch-543"><a href="#IGAPatch-543"><span class="linenos">543</span></a>        <span class="n">vm</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
</span><span id="IGAPatch-544"><a href="#IGAPatch-544"><span class="linenos">544</span></a>            <span class="n">sig_eig</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">sig_eig</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
</span><span id="IGAPatch-545"><a href="#IGAPatch-545"><span class="linenos">545</span></a>        <span class="p">)</span>
</span><span id="IGAPatch-546"><a href="#IGAPatch-546"><span class="linenos">546</span></a>        <span class="k">return</span> <span class="n">vm</span>
</span><span id="IGAPatch-547"><a href="#IGAPatch-547"><span class="linenos">547</span></a>
</span><span id="IGAPatch-548"><a href="#IGAPatch-548"><span class="linenos">548</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_paraview</span><span class="p">(</span>
</span><span id="IGAPatch-549"><a href="#IGAPatch-549"><span class="linenos">549</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="IGAPatch-550"><a href="#IGAPatch-550"><span class="linenos">550</span></a>        <span class="n">U</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span>
</span><span id="IGAPatch-551"><a href="#IGAPatch-551"><span class="linenos">551</span></a>        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="IGAPatch-552"><a href="#IGAPatch-552"><span class="linenos">552</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="IGAPatch-553"><a href="#IGAPatch-553"><span class="linenos">553</span></a>        <span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="IGAPatch-554"><a href="#IGAPatch-554"><span class="linenos">554</span></a>    <span class="p">):</span>
</span><span id="IGAPatch-555"><a href="#IGAPatch-555"><span class="linenos">555</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatch-556"><a href="#IGAPatch-556"><span class="linenos">556</span></a><span class="sd">        Export the patch data to a ParaView-readable format.</span>
</span><span id="IGAPatch-557"><a href="#IGAPatch-557"><span class="linenos">557</span></a>
</span><span id="IGAPatch-558"><a href="#IGAPatch-558"><span class="linenos">558</span></a><span class="sd">        The saved data includes the displacement field and derived fields</span>
</span><span id="IGAPatch-559"><a href="#IGAPatch-559"><span class="linenos">559</span></a><span class="sd">        (strain, stress, principal stresses, von Mises stress) for visualization.</span>
</span><span id="IGAPatch-560"><a href="#IGAPatch-560"><span class="linenos">560</span></a>
</span><span id="IGAPatch-561"><a href="#IGAPatch-561"><span class="linenos">561</span></a><span class="sd">        Parameters</span>
</span><span id="IGAPatch-562"><a href="#IGAPatch-562"><span class="linenos">562</span></a><span class="sd">        ----------</span>
</span><span id="IGAPatch-563"><a href="#IGAPatch-563"><span class="linenos">563</span></a><span class="sd">        U : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-564"><a href="#IGAPatch-564"><span class="linenos">564</span></a><span class="sd">            Displacement field, shape (3, nb_ctrl_pts), with physical coordinates first.</span>
</span><span id="IGAPatch-565"><a href="#IGAPatch-565"><span class="linenos">565</span></a><span class="sd">        path : str</span>
</span><span id="IGAPatch-566"><a href="#IGAPatch-566"><span class="linenos">566</span></a><span class="sd">            Directory path where the ParaView file will be saved.</span>
</span><span id="IGAPatch-567"><a href="#IGAPatch-567"><span class="linenos">567</span></a><span class="sd">        name : str</span>
</span><span id="IGAPatch-568"><a href="#IGAPatch-568"><span class="linenos">568</span></a><span class="sd">            Base name of the saved file.</span>
</span><span id="IGAPatch-569"><a href="#IGAPatch-569"><span class="linenos">569</span></a><span class="sd">        n_eval_per_elem : int, optional</span>
</span><span id="IGAPatch-570"><a href="#IGAPatch-570"><span class="linenos">570</span></a><span class="sd">            Number of evaluation points per element in each parametric direction</span>
</span><span id="IGAPatch-571"><a href="#IGAPatch-571"><span class="linenos">571</span></a><span class="sd">            (higher values produce smoother visualizations). Default is 10.</span>
</span><span id="IGAPatch-572"><a href="#IGAPatch-572"><span class="linenos">572</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatch-573"><a href="#IGAPatch-573"><span class="linenos">573</span></a>        <span class="n">XI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">n_eval_per_elem</span><span class="p">)</span>
</span><span id="IGAPatch-574"><a href="#IGAPatch-574"><span class="linenos">574</span></a>        <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_paraview_fields</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">XI</span><span class="p">)</span>
</span><span id="IGAPatch-575"><a href="#IGAPatch-575"><span class="linenos">575</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">saveParaview</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">XI</span><span class="o">=</span><span class="n">XI</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">)</span>
</span><span id="IGAPatch-576"><a href="#IGAPatch-576"><span class="linenos">576</span></a>
</span><span id="IGAPatch-577"><a href="#IGAPatch-577"><span class="linenos">577</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">make_paraview_fields</span><span class="p">(</span>
</span><span id="IGAPatch-578"><a href="#IGAPatch-578"><span class="linenos">578</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">U</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="n">XI</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]]</span>
</span><span id="IGAPatch-579"><a href="#IGAPatch-579"><span class="linenos">579</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]]:</span>
</span><span id="IGAPatch-580"><a href="#IGAPatch-580"><span class="linenos">580</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatch-581"><a href="#IGAPatch-581"><span class="linenos">581</span></a><span class="sd">        Generate fields for visualization in ParaView from the displacement field.</span>
</span><span id="IGAPatch-582"><a href="#IGAPatch-582"><span class="linenos">582</span></a>
</span><span id="IGAPatch-583"><a href="#IGAPatch-583"><span class="linenos">583</span></a><span class="sd">        This function computes the following fields:</span>
</span><span id="IGAPatch-584"><a href="#IGAPatch-584"><span class="linenos">584</span></a><span class="sd">            - Displacement `U`</span>
</span><span id="IGAPatch-585"><a href="#IGAPatch-585"><span class="linenos">585</span></a><span class="sd">            - Strain tensor `epsilon` in Voigt notation</span>
</span><span id="IGAPatch-586"><a href="#IGAPatch-586"><span class="linenos">586</span></a><span class="sd">            - Stress tensor `sigma` in Voigt notation</span>
</span><span id="IGAPatch-587"><a href="#IGAPatch-587"><span class="linenos">587</span></a><span class="sd">            - Principal stresses `sigma_eig`</span>
</span><span id="IGAPatch-588"><a href="#IGAPatch-588"><span class="linenos">588</span></a><span class="sd">            - Von Mises stress `von_mises`</span>
</span><span id="IGAPatch-589"><a href="#IGAPatch-589"><span class="linenos">589</span></a>
</span><span id="IGAPatch-590"><a href="#IGAPatch-590"><span class="linenos">590</span></a><span class="sd">        The resulting arrays are reshaped to match the expected ParaView format:</span>
</span><span id="IGAPatch-591"><a href="#IGAPatch-591"><span class="linenos">591</span></a><span class="sd">            - The first dimension is for potential time/step (here 1)</span>
</span><span id="IGAPatch-592"><a href="#IGAPatch-592"><span class="linenos">592</span></a><span class="sd">            - Subsequent dimensions correspond to physical or Voigt components,</span>
</span><span id="IGAPatch-593"><a href="#IGAPatch-593"><span class="linenos">593</span></a><span class="sd">            followed by the parametric grid shape defined by `XI`.</span>
</span><span id="IGAPatch-594"><a href="#IGAPatch-594"><span class="linenos">594</span></a>
</span><span id="IGAPatch-595"><a href="#IGAPatch-595"><span class="linenos">595</span></a><span class="sd">        Parameters</span>
</span><span id="IGAPatch-596"><a href="#IGAPatch-596"><span class="linenos">596</span></a><span class="sd">        ----------</span>
</span><span id="IGAPatch-597"><a href="#IGAPatch-597"><span class="linenos">597</span></a><span class="sd">        U : np.ndarray[np.floating]</span>
</span><span id="IGAPatch-598"><a href="#IGAPatch-598"><span class="linenos">598</span></a><span class="sd">            Displacement field of shape (3, nb_ctrl_pts), with the first dimension</span>
</span><span id="IGAPatch-599"><a href="#IGAPatch-599"><span class="linenos">599</span></a><span class="sd">            corresponding to physical coordinates (x, y, z).</span>
</span><span id="IGAPatch-600"><a href="#IGAPatch-600"><span class="linenos">600</span></a><span class="sd">        XI : list[np.ndarray[np.floating]]</span>
</span><span id="IGAPatch-601"><a href="#IGAPatch-601"><span class="linenos">601</span></a><span class="sd">            List of parametric coordinates for each direction [xi, eta, zeta].</span>
</span><span id="IGAPatch-602"><a href="#IGAPatch-602"><span class="linenos">602</span></a><span class="sd">            Determines the evaluation grid for the derived fields.</span>
</span><span id="IGAPatch-603"><a href="#IGAPatch-603"><span class="linenos">603</span></a>
</span><span id="IGAPatch-604"><a href="#IGAPatch-604"><span class="linenos">604</span></a><span class="sd">        Returns</span>
</span><span id="IGAPatch-605"><a href="#IGAPatch-605"><span class="linenos">605</span></a><span class="sd">        -------</span>
</span><span id="IGAPatch-606"><a href="#IGAPatch-606"><span class="linenos">606</span></a><span class="sd">        fields : dict[str, np.ndarray[np.floating]]</span>
</span><span id="IGAPatch-607"><a href="#IGAPatch-607"><span class="linenos">607</span></a><span class="sd">            Dictionary of fields ready for ParaView, with the following shapes:</span>
</span><span id="IGAPatch-608"><a href="#IGAPatch-608"><span class="linenos">608</span></a><span class="sd">                - &quot;U&quot; : shape (1, 3, nxi, neta, nzeta)</span>
</span><span id="IGAPatch-609"><a href="#IGAPatch-609"><span class="linenos">609</span></a><span class="sd">                - &quot;epsilon&quot; : shape (1, 6, nxi, neta, nzeta)</span>
</span><span id="IGAPatch-610"><a href="#IGAPatch-610"><span class="linenos">610</span></a><span class="sd">                - &quot;sigma&quot; : shape (1, 6, nxi, neta, nzeta)</span>
</span><span id="IGAPatch-611"><a href="#IGAPatch-611"><span class="linenos">611</span></a><span class="sd">                - &quot;sigma_eig&quot; : shape (1, 3, nxi, neta, nzeta)</span>
</span><span id="IGAPatch-612"><a href="#IGAPatch-612"><span class="linenos">612</span></a><span class="sd">                - &quot;von_mises&quot; : shape (1, 1, nxi, neta, nzeta)</span>
</span><span id="IGAPatch-613"><a href="#IGAPatch-613"><span class="linenos">613</span></a><span class="sd">            where (nxi, neta, nzeta) = tuple(xi.size for xi in XI)</span>
</span><span id="IGAPatch-614"><a href="#IGAPatch-614"><span class="linenos">614</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatch-615"><a href="#IGAPatch-615"><span class="linenos">615</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="IGAPatch-616"><a href="#IGAPatch-616"><span class="linenos">616</span></a>        <span class="n">epsilon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">XI</span><span class="p">)</span>
</span><span id="IGAPatch-617"><a href="#IGAPatch-617"><span class="linenos">617</span></a>        <span class="n">sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">(</span><span class="n">epsilon</span><span class="p">)</span>
</span><span id="IGAPatch-618"><a href="#IGAPatch-618"><span class="linenos">618</span></a>        <span class="n">sigma_eig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_eig</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span>
</span><span id="IGAPatch-619"><a href="#IGAPatch-619"><span class="linenos">619</span></a>        <span class="n">von_mises</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">von_mises</span><span class="p">(</span><span class="n">sigma_eig</span><span class="p">)</span>
</span><span id="IGAPatch-620"><a href="#IGAPatch-620"><span class="linenos">620</span></a>        <span class="n">XI_shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">xi</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">XI</span><span class="p">)</span>
</span><span id="IGAPatch-621"><a href="#IGAPatch-621"><span class="linenos">621</span></a>        <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="IGAPatch-622"><a href="#IGAPatch-622"><span class="linenos">622</span></a>            <span class="s2">&quot;U&quot;</span><span class="p">:</span> <span class="n">u</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span>
</span><span id="IGAPatch-623"><a href="#IGAPatch-623"><span class="linenos">623</span></a>            <span class="s2">&quot;epsilon&quot;</span><span class="p">:</span> <span class="n">epsilon</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="n">XI_shape</span><span class="p">)),</span>
</span><span id="IGAPatch-624"><a href="#IGAPatch-624"><span class="linenos">624</span></a>            <span class="s2">&quot;sigma&quot;</span><span class="p">:</span> <span class="n">sigma</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="n">XI_shape</span><span class="p">)),</span>
</span><span id="IGAPatch-625"><a href="#IGAPatch-625"><span class="linenos">625</span></a>            <span class="s2">&quot;sigma_eig&quot;</span><span class="p">:</span> <span class="n">sigma_eig</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">*</span><span class="n">XI_shape</span><span class="p">)),</span>
</span><span id="IGAPatch-626"><a href="#IGAPatch-626"><span class="linenos">626</span></a>            <span class="s2">&quot;von_mises&quot;</span><span class="p">:</span> <span class="n">von_mises</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">XI_shape</span><span class="p">)),</span>
</span><span id="IGAPatch-627"><a href="#IGAPatch-627"><span class="linenos">627</span></a>        <span class="p">}</span>
</span><span id="IGAPatch-628"><a href="#IGAPatch-628"><span class="linenos">628</span></a>        <span class="k">return</span> <span class="n">fields</span>
</span></pre></div>


            <div class="docstring"><p>Local representation of a 3D B-spline patch for linear elasticity.</p>

<p>This class provides the building blocks to compute linear elasticity operators
(stiffness matrix, right-hand side, strain, stress, von Mises stress) for a
single B-spline volume. It is intended <strong>solely as a component of a multipatch
problem</strong> and is not designed to be used as a standalone solver.</p>

<p>Typically, IGAPatch objects are managed by a <code>ProblemIGA</code> instance, which
assembles multiple patches, enforces Dirichlet constraints, and solves the
global linear elasticity problem.</p>

<p>Features provided by IGAPatch include:
    - computation of the Jacobian and its determinant,
    - gradients of shape functions in physical space,
    - linear elastic stiffness matrix assembly for one patch,
    - evaluation of prescribed surface forces,
    - post-processing quantities such as displacement, strain, stress, and von Mises stress,
    - export of results to visualization tools (e.g., ParaView).</p>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>spline</strong> (BSpline):
The 3D B-spline volume representing the patch geometry and shape functions.</li>
<li><strong>ctrl_pts</strong> (np.ndarray[np.floating]):
Array of control points of shape (3, n_xi, n_eta, n_zeta) defining the patch geometry.</li>
<li><strong>xi</strong> (np.ndarray[np.floating]):
Isoparametric integration points along the xi direction.</li>
<li><strong>dxi</strong> (np.ndarray[np.floating]):
Corresponding quadrature weights for xi.</li>
<li><strong>eta</strong> (np.ndarray[np.floating]):
Isoparametric integration points along the eta direction.</li>
<li><strong>deta</strong> (np.ndarray[np.floating]):
Corresponding quadrature weights for eta.</li>
<li><strong>zeta</strong> (np.ndarray[np.floating]):
Isoparametric integration points along the zeta direction.</li>
<li><strong>dzeta</strong> (np.ndarray[np.floating]):
Corresponding quadrature weights for zeta.</li>
<li><strong>F_N</strong> (np.ndarray[np.floating]):
Prescribed surface forces, with shape (3 (direction), 2 (side: front/back), 3 (physical components)).
Used for computing the right-hand side vector.</li>
<li><strong>H</strong> (np.ndarray[np.floating]):
Constitutive matrix in Voigt notation (6x6) for linear isotropic elasticity.
Defined from <code>E</code> and <code>nu</code>.</li>
</ul>

<h6 id="notes">Notes</h6>

<ul>
<li>All integration points are generated using Gaussian quadrature with a number
of points determined from the spline degree.</li>
<li>This class <strong>does not handle multipatch connectivity or global constraints</strong>.
Use <code>ProblemIGA</code> to assemble and solve multipatch problems.</li>
<li>Post-processing quantities can be evaluated at the integration points or exported
to visualization tools like ParaView.</li>
</ul>
</div>


                            <div id="IGAPatch.__init__" class="classattr">
                                        <input id="IGAPatch.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">IGAPatch</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">spline</span><span class="p">:</span> <span class="n">bsplyne</span><span class="o">.</span><span class="n">b_spline</span><span class="o">.</span><span class="n">BSpline</span>,</span><span class="param">	<span class="n">ctrl_pts</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>,</span><span class="param">	<span class="n">E</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">nu</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">F_N</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">([[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]],</span>

       <span class="p">[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]],</span>

       <span class="p">[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]]])</span></span>)</span>

                <label class="view-source-button" for="IGAPatch.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IGAPatch.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IGAPatch.__init__-76"><a href="#IGAPatch.__init__-76"><span class="linenos"> 76</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="IGAPatch.__init__-77"><a href="#IGAPatch.__init__-77"><span class="linenos"> 77</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="IGAPatch.__init__-78"><a href="#IGAPatch.__init__-78"><span class="linenos"> 78</span></a>        <span class="n">spline</span><span class="p">:</span> <span class="n">BSpline</span><span class="p">,</span>
</span><span id="IGAPatch.__init__-79"><a href="#IGAPatch.__init__-79"><span class="linenos"> 79</span></a>        <span class="n">ctrl_pts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span>
</span><span id="IGAPatch.__init__-80"><a href="#IGAPatch.__init__-80"><span class="linenos"> 80</span></a>        <span class="n">E</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="IGAPatch.__init__-81"><a href="#IGAPatch.__init__-81"><span class="linenos"> 81</span></a>        <span class="n">nu</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="IGAPatch.__init__-82"><a href="#IGAPatch.__init__-82"><span class="linenos"> 82</span></a>        <span class="n">F_N</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">),</span>
</span><span id="IGAPatch.__init__-83"><a href="#IGAPatch.__init__-83"><span class="linenos"> 83</span></a>    <span class="p">):</span>
</span><span id="IGAPatch.__init__-84"><a href="#IGAPatch.__init__-84"><span class="linenos"> 84</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatch.__init__-85"><a href="#IGAPatch.__init__-85"><span class="linenos"> 85</span></a><span class="sd">        Initialize a local `IGAPatch` for linear elasticity computations.</span>
</span><span id="IGAPatch.__init__-86"><a href="#IGAPatch.__init__-86"><span class="linenos"> 86</span></a>
</span><span id="IGAPatch.__init__-87"><a href="#IGAPatch.__init__-87"><span class="linenos"> 87</span></a><span class="sd">        This constructor sets up all necessary information for assembling</span>
</span><span id="IGAPatch.__init__-88"><a href="#IGAPatch.__init__-88"><span class="linenos"> 88</span></a><span class="sd">        the stiffness matrix and right-hand side for a single B-spline patch.</span>
</span><span id="IGAPatch.__init__-89"><a href="#IGAPatch.__init__-89"><span class="linenos"> 89</span></a><span class="sd">        Note that `IGAPatch` objects are intended to be used as components of</span>
</span><span id="IGAPatch.__init__-90"><a href="#IGAPatch.__init__-90"><span class="linenos"> 90</span></a><span class="sd">        a `ProblemIGA` multipatch object, and are **not standalone solvers**.</span>
</span><span id="IGAPatch.__init__-91"><a href="#IGAPatch.__init__-91"><span class="linenos"> 91</span></a>
</span><span id="IGAPatch.__init__-92"><a href="#IGAPatch.__init__-92"><span class="linenos"> 92</span></a><span class="sd">        Parameters</span>
</span><span id="IGAPatch.__init__-93"><a href="#IGAPatch.__init__-93"><span class="linenos"> 93</span></a><span class="sd">        ----------</span>
</span><span id="IGAPatch.__init__-94"><a href="#IGAPatch.__init__-94"><span class="linenos"> 94</span></a><span class="sd">        spline : BSpline</span>
</span><span id="IGAPatch.__init__-95"><a href="#IGAPatch.__init__-95"><span class="linenos"> 95</span></a><span class="sd">            The 3D B-spline volume defining the patch geometry and the shape</span>
</span><span id="IGAPatch.__init__-96"><a href="#IGAPatch.__init__-96"><span class="linenos"> 96</span></a><span class="sd">            functions. Provides methods to compute basis functions and derivatives.</span>
</span><span id="IGAPatch.__init__-97"><a href="#IGAPatch.__init__-97"><span class="linenos"> 97</span></a><span class="sd">        ctrl_pts : np.ndarray[np.floating]</span>
</span><span id="IGAPatch.__init__-98"><a href="#IGAPatch.__init__-98"><span class="linenos"> 98</span></a><span class="sd">            Array of control points defining the patch geometry.</span>
</span><span id="IGAPatch.__init__-99"><a href="#IGAPatch.__init__-99"><span class="linenos"> 99</span></a><span class="sd">            Shape should be (3, n_xi, n_eta, n_zeta) corresponding to</span>
</span><span id="IGAPatch.__init__-100"><a href="#IGAPatch.__init__-100"><span class="linenos">100</span></a><span class="sd">            (physical_dim, n_ctrl_pts_xi, n_ctrl_pts_eta, n_ctrl_pts_zeta).</span>
</span><span id="IGAPatch.__init__-101"><a href="#IGAPatch.__init__-101"><span class="linenos">101</span></a><span class="sd">        E : float</span>
</span><span id="IGAPatch.__init__-102"><a href="#IGAPatch.__init__-102"><span class="linenos">102</span></a><span class="sd">            Young&#39;s modulus of the material.</span>
</span><span id="IGAPatch.__init__-103"><a href="#IGAPatch.__init__-103"><span class="linenos">103</span></a><span class="sd">        nu : float</span>
</span><span id="IGAPatch.__init__-104"><a href="#IGAPatch.__init__-104"><span class="linenos">104</span></a><span class="sd">            Poisson&#39;s ratio of the material.</span>
</span><span id="IGAPatch.__init__-105"><a href="#IGAPatch.__init__-105"><span class="linenos">105</span></a><span class="sd">        F_N : np.ndarray[np.floating], optional</span>
</span><span id="IGAPatch.__init__-106"><a href="#IGAPatch.__init__-106"><span class="linenos">106</span></a><span class="sd">            Prescribed surface forces applied on the patch boundaries.</span>
</span><span id="IGAPatch.__init__-107"><a href="#IGAPatch.__init__-107"><span class="linenos">107</span></a><span class="sd">            Shape should be (3 (direction: x, y, z), 2 (side: front/back), 3 (physical components)),</span>
</span><span id="IGAPatch.__init__-108"><a href="#IGAPatch.__init__-108"><span class="linenos">108</span></a><span class="sd">            representing forces at the integration points on each face. Default is zero (no surface forces).</span>
</span><span id="IGAPatch.__init__-109"><a href="#IGAPatch.__init__-109"><span class="linenos">109</span></a>
</span><span id="IGAPatch.__init__-110"><a href="#IGAPatch.__init__-110"><span class="linenos">110</span></a><span class="sd">        Attributes set</span>
</span><span id="IGAPatch.__init__-111"><a href="#IGAPatch.__init__-111"><span class="linenos">111</span></a><span class="sd">        ----------------</span>
</span><span id="IGAPatch.__init__-112"><a href="#IGAPatch.__init__-112"><span class="linenos">112</span></a><span class="sd">        H : np.ndarray[np.floating]</span>
</span><span id="IGAPatch.__init__-113"><a href="#IGAPatch.__init__-113"><span class="linenos">113</span></a><span class="sd">            66 constitutive matrix in Voigt notation, built from `E` and `nu`.</span>
</span><span id="IGAPatch.__init__-114"><a href="#IGAPatch.__init__-114"><span class="linenos">114</span></a><span class="sd">        xi, eta, zeta : np.ndarray[np.floating]</span>
</span><span id="IGAPatch.__init__-115"><a href="#IGAPatch.__init__-115"><span class="linenos">115</span></a><span class="sd">            Isoparametric coordinates for Gaussian quadrature in each direction.</span>
</span><span id="IGAPatch.__init__-116"><a href="#IGAPatch.__init__-116"><span class="linenos">116</span></a><span class="sd">        dxi, deta, dzeta : np.ndarray[np.floating]</span>
</span><span id="IGAPatch.__init__-117"><a href="#IGAPatch.__init__-117"><span class="linenos">117</span></a><span class="sd">            Quadrature weights associated with the isoparametric coordinates.</span>
</span><span id="IGAPatch.__init__-118"><a href="#IGAPatch.__init__-118"><span class="linenos">118</span></a><span class="sd">        F_N : np.ndarray[np.floating]</span>
</span><span id="IGAPatch.__init__-119"><a href="#IGAPatch.__init__-119"><span class="linenos">119</span></a><span class="sd">            Prescribed surface forces, stored for use in the rhs computation.</span>
</span><span id="IGAPatch.__init__-120"><a href="#IGAPatch.__init__-120"><span class="linenos">120</span></a>
</span><span id="IGAPatch.__init__-121"><a href="#IGAPatch.__init__-121"><span class="linenos">121</span></a><span class="sd">        Notes</span>
</span><span id="IGAPatch.__init__-122"><a href="#IGAPatch.__init__-122"><span class="linenos">122</span></a><span class="sd">        -----</span>
</span><span id="IGAPatch.__init__-123"><a href="#IGAPatch.__init__-123"><span class="linenos">123</span></a><span class="sd">        - Quadrature points and weights are automatically generated using</span>
</span><span id="IGAPatch.__init__-124"><a href="#IGAPatch.__init__-124"><span class="linenos">124</span></a><span class="sd">        `spline.gauss_legendre_for_integration` with `degree+1` points.</span>
</span><span id="IGAPatch.__init__-125"><a href="#IGAPatch.__init__-125"><span class="linenos">125</span></a><span class="sd">        - The constitutive matrix `H` assumes linear isotropic elasticity in Voigt notation.</span>
</span><span id="IGAPatch.__init__-126"><a href="#IGAPatch.__init__-126"><span class="linenos">126</span></a><span class="sd">        - This patch only defines the local operators; global assembly and</span>
</span><span id="IGAPatch.__init__-127"><a href="#IGAPatch.__init__-127"><span class="linenos">127</span></a><span class="sd">        enforcement of boundary conditions are handled by `ProblemIGA`.</span>
</span><span id="IGAPatch.__init__-128"><a href="#IGAPatch.__init__-128"><span class="linenos">128</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatch.__init__-129"><a href="#IGAPatch.__init__-129"><span class="linenos">129</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">spline</span> <span class="o">=</span> <span class="n">spline</span>
</span><span id="IGAPatch.__init__-130"><a href="#IGAPatch.__init__-130"><span class="linenos">130</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span> <span class="o">=</span> <span class="n">ctrl_pts</span>
</span><span id="IGAPatch.__init__-131"><a href="#IGAPatch.__init__-131"><span class="linenos">131</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="IGAPatch.__init__-132"><a href="#IGAPatch.__init__-132"><span class="linenos">132</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="IGAPatch.__init__-133"><a href="#IGAPatch.__init__-133"><span class="linenos">133</span></a>                <span class="p">[</span>
</span><span id="IGAPatch.__init__-134"><a href="#IGAPatch.__init__-134"><span class="linenos">134</span></a>                    <span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">nu</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="IGAPatch.__init__-135"><a href="#IGAPatch.__init__-135"><span class="linenos">135</span></a>                    <span class="p">[</span><span class="n">nu</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">nu</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="IGAPatch.__init__-136"><a href="#IGAPatch.__init__-136"><span class="linenos">136</span></a>                    <span class="p">[</span><span class="n">nu</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">nu</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="IGAPatch.__init__-137"><a href="#IGAPatch.__init__-137"><span class="linenos">137</span></a>                    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">-</span> <span class="n">nu</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="IGAPatch.__init__-138"><a href="#IGAPatch.__init__-138"><span class="linenos">138</span></a>                    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">-</span> <span class="n">nu</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="IGAPatch.__init__-139"><a href="#IGAPatch.__init__-139"><span class="linenos">139</span></a>                    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">-</span> <span class="n">nu</span><span class="p">)],</span>
</span><span id="IGAPatch.__init__-140"><a href="#IGAPatch.__init__-140"><span class="linenos">140</span></a>                <span class="p">],</span>
</span><span id="IGAPatch.__init__-141"><a href="#IGAPatch.__init__-141"><span class="linenos">141</span></a>                <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
</span><span id="IGAPatch.__init__-142"><a href="#IGAPatch.__init__-142"><span class="linenos">142</span></a>            <span class="p">)</span>
</span><span id="IGAPatch.__init__-143"><a href="#IGAPatch.__init__-143"><span class="linenos">143</span></a>            <span class="o">*</span> <span class="n">E</span>
</span><span id="IGAPatch.__init__-144"><a href="#IGAPatch.__init__-144"><span class="linenos">144</span></a>            <span class="o">/</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">nu</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nu</span><span class="p">))</span>
</span><span id="IGAPatch.__init__-145"><a href="#IGAPatch.__init__-145"><span class="linenos">145</span></a>        <span class="p">)</span>
</span><span id="IGAPatch.__init__-146"><a href="#IGAPatch.__init__-146"><span class="linenos">146</span></a>        <span class="n">xi_eta_zeta_pts_pds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">gauss_legendre_for_integration</span><span class="p">(</span>
</span><span id="IGAPatch.__init__-147"><a href="#IGAPatch.__init__-147"><span class="linenos">147</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">getDegrees</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="IGAPatch.__init__-148"><a href="#IGAPatch.__init__-148"><span class="linenos">148</span></a>        <span class="p">)</span>
</span><span id="IGAPatch.__init__-149"><a href="#IGAPatch.__init__-149"><span class="linenos">149</span></a>        <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeta</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dxi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dzeta</span><span class="p">))</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="IGAPatch.__init__-150"><a href="#IGAPatch.__init__-150"><span class="linenos">150</span></a>            <span class="n">xi_eta_zeta_pts_pds</span>
</span><span id="IGAPatch.__init__-151"><a href="#IGAPatch.__init__-151"><span class="linenos">151</span></a>        <span class="p">)</span>
</span><span id="IGAPatch.__init__-152"><a href="#IGAPatch.__init__-152"><span class="linenos">152</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">F_N</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="IGAPatch.__init__-153"><a href="#IGAPatch.__init__-153"><span class="linenos">153</span></a>            <span class="n">F_N</span>  <span class="c1"># shape (3 (xi, eta, or zeta), 2 (front or back), 3 (vector (x, y, z)))</span>
</span><span id="IGAPatch.__init__-154"><a href="#IGAPatch.__init__-154"><span class="linenos">154</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize a local <code><a href="#IGAPatch">IGAPatch</a></code> for linear elasticity computations.</p>

<p>This constructor sets up all necessary information for assembling
the stiffness matrix and right-hand side for a single B-spline patch.
Note that <code><a href="#IGAPatch">IGAPatch</a></code> objects are intended to be used as components of
a <code>ProblemIGA</code> multipatch object, and are <strong>not standalone solvers</strong>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>spline</strong> (BSpline):
The 3D B-spline volume defining the patch geometry and the shape
functions. Provides methods to compute basis functions and derivatives.</li>
<li><strong>ctrl_pts</strong> (np.ndarray[np.floating]):
Array of control points defining the patch geometry.
Shape should be (3, n_xi, n_eta, n_zeta) corresponding to
(physical_dim, n_ctrl_pts_xi, n_ctrl_pts_eta, n_ctrl_pts_zeta).</li>
<li><strong>E</strong> (float):
Young's modulus of the material.</li>
<li><strong>nu</strong> (float):
Poisson's ratio of the material.</li>
<li><strong>F_N</strong> (np.ndarray[np.floating], optional):
Prescribed surface forces applied on the patch boundaries.
Shape should be (3 (direction: x, y, z), 2 (side: front/back), 3 (physical components)),
representing forces at the integration points on each face. Default is zero (no surface forces).</li>
</ul>

<h6 id="attributes-set">Attributes set</h6>

<p>H : np.ndarray[np.floating]
    66 constitutive matrix in Voigt notation, built from <code>E</code> and <code>nu</code>.
xi, eta, zeta : np.ndarray[np.floating]
    Isoparametric coordinates for Gaussian quadrature in each direction.
dxi, deta, dzeta : np.ndarray[np.floating]
    Quadrature weights associated with the isoparametric coordinates.
F_N : np.ndarray[np.floating]
    Prescribed surface forces, stored for use in the rhs computation.</p>

<h6 id="notes">Notes</h6>

<ul>
<li>Quadrature points and weights are automatically generated using
<code>spline.gauss_legendre_for_integration</code> with <code>degree+1</code> points.</li>
<li>The constitutive matrix <code><a href="#IGAPatch.H">H</a></code> assumes linear isotropic elasticity in Voigt notation.</li>
<li>This patch only defines the local operators; global assembly and
enforcement of boundary conditions are handled by <code>ProblemIGA</code>.</li>
</ul>
</div>


                            </div>
                            <div id="IGAPatch.spline" class="classattr">
                                <div class="attr variable">
            <span class="name">spline</span><span class="annotation">: bsplyne.b_spline.BSpline</span>

        
    </div>
    <a class="headerlink" href="#IGAPatch.spline"></a>
    
    

                            </div>
                            <div id="IGAPatch.ctrl_pts" class="classattr">
                                <div class="attr variable">
            <span class="name">ctrl_pts</span><span class="annotation">: numpy.ndarray[numpy.floating]</span>

        
    </div>
    <a class="headerlink" href="#IGAPatch.ctrl_pts"></a>
    
    

                            </div>
                            <div id="IGAPatch.xi" class="classattr">
                                <div class="attr variable">
            <span class="name">xi</span><span class="annotation">: numpy.ndarray[numpy.floating]</span>

        
    </div>
    <a class="headerlink" href="#IGAPatch.xi"></a>
    
    

                            </div>
                            <div id="IGAPatch.dxi" class="classattr">
                                <div class="attr variable">
            <span class="name">dxi</span><span class="annotation">: numpy.ndarray[numpy.floating]</span>

        
    </div>
    <a class="headerlink" href="#IGAPatch.dxi"></a>
    
    

                            </div>
                            <div id="IGAPatch.eta" class="classattr">
                                <div class="attr variable">
            <span class="name">eta</span><span class="annotation">: numpy.ndarray[numpy.floating]</span>

        
    </div>
    <a class="headerlink" href="#IGAPatch.eta"></a>
    
    

                            </div>
                            <div id="IGAPatch.deta" class="classattr">
                                <div class="attr variable">
            <span class="name">deta</span><span class="annotation">: numpy.ndarray[numpy.floating]</span>

        
    </div>
    <a class="headerlink" href="#IGAPatch.deta"></a>
    
    

                            </div>
                            <div id="IGAPatch.zeta" class="classattr">
                                <div class="attr variable">
            <span class="name">zeta</span><span class="annotation">: numpy.ndarray[numpy.floating]</span>

        
    </div>
    <a class="headerlink" href="#IGAPatch.zeta"></a>
    
    

                            </div>
                            <div id="IGAPatch.dzeta" class="classattr">
                                <div class="attr variable">
            <span class="name">dzeta</span><span class="annotation">: numpy.ndarray[numpy.floating]</span>

        
    </div>
    <a class="headerlink" href="#IGAPatch.dzeta"></a>
    
    

                            </div>
                            <div id="IGAPatch.F_N" class="classattr">
                                <div class="attr variable">
            <span class="name">F_N</span><span class="annotation">: numpy.ndarray[numpy.floating]</span>

        
    </div>
    <a class="headerlink" href="#IGAPatch.F_N"></a>
    
    

                            </div>
                            <div id="IGAPatch.H" class="classattr">
                                <div class="attr variable">
            <span class="name">H</span><span class="annotation">: numpy.ndarray[numpy.floating]</span>

        
    </div>
    <a class="headerlink" href="#IGAPatch.H"></a>
    
    

                            </div>
                            <div id="IGAPatch.jacobian" class="classattr">
                                        <input id="IGAPatch.jacobian-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">jacobian</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">dN_dXI</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">_matrix</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">,</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">_matrix</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">,</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">_matrix</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="IGAPatch.jacobian-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IGAPatch.jacobian"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IGAPatch.jacobian-156"><a href="#IGAPatch.jacobian-156"><span class="linenos">156</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">jacobian</span><span class="p">(</span>
</span><span id="IGAPatch.jacobian-157"><a href="#IGAPatch.jacobian-157"><span class="linenos">157</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">dN_dXI</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">,</span> <span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">,</span> <span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">]</span>
</span><span id="IGAPatch.jacobian-158"><a href="#IGAPatch.jacobian-158"><span class="linenos">158</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span>
</span><span id="IGAPatch.jacobian-159"><a href="#IGAPatch.jacobian-159"><span class="linenos">159</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>
</span><span id="IGAPatch.jacobian-160"><a href="#IGAPatch.jacobian-160"><span class="linenos">160</span></a>    <span class="p">]:</span>
</span><span id="IGAPatch.jacobian-161"><a href="#IGAPatch.jacobian-161"><span class="linenos">161</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatch.jacobian-162"><a href="#IGAPatch.jacobian-162"><span class="linenos">162</span></a><span class="sd">        Compute the Jacobian matrix of the mapping from parametric to physical space,</span>
</span><span id="IGAPatch.jacobian-163"><a href="#IGAPatch.jacobian-163"><span class="linenos">163</span></a><span class="sd">        its inverse, and its determinant at all integration points.</span>
</span><span id="IGAPatch.jacobian-164"><a href="#IGAPatch.jacobian-164"><span class="linenos">164</span></a>
</span><span id="IGAPatch.jacobian-165"><a href="#IGAPatch.jacobian-165"><span class="linenos">165</span></a><span class="sd">        The Jacobian describes how the parametric (xi, eta, zeta) coordinates</span>
</span><span id="IGAPatch.jacobian-166"><a href="#IGAPatch.jacobian-166"><span class="linenos">166</span></a><span class="sd">        are mapped to physical coordinates using the patch&#39;s control points.</span>
</span><span id="IGAPatch.jacobian-167"><a href="#IGAPatch.jacobian-167"><span class="linenos">167</span></a>
</span><span id="IGAPatch.jacobian-168"><a href="#IGAPatch.jacobian-168"><span class="linenos">168</span></a><span class="sd">        Parameters</span>
</span><span id="IGAPatch.jacobian-169"><a href="#IGAPatch.jacobian-169"><span class="linenos">169</span></a><span class="sd">        ----------</span>
</span><span id="IGAPatch.jacobian-170"><a href="#IGAPatch.jacobian-170"><span class="linenos">170</span></a><span class="sd">        dN_dXI : tuple[sps.spmatrix, sps.spmatrix, sps.spmatrix]</span>
</span><span id="IGAPatch.jacobian-171"><a href="#IGAPatch.jacobian-171"><span class="linenos">171</span></a><span class="sd">            Derivatives of the shape functions with respect to the parametric coordinates.</span>
</span><span id="IGAPatch.jacobian-172"><a href="#IGAPatch.jacobian-172"><span class="linenos">172</span></a><span class="sd">            Tuple of sparse matrices `(dN_dxi, dN_deta, dN_dzeta)`, each of shape</span>
</span><span id="IGAPatch.jacobian-173"><a href="#IGAPatch.jacobian-173"><span class="linenos">173</span></a><span class="sd">            (n_intg_pts, n_ctrl_pts).</span>
</span><span id="IGAPatch.jacobian-174"><a href="#IGAPatch.jacobian-174"><span class="linenos">174</span></a>
</span><span id="IGAPatch.jacobian-175"><a href="#IGAPatch.jacobian-175"><span class="linenos">175</span></a><span class="sd">        Returns</span>
</span><span id="IGAPatch.jacobian-176"><a href="#IGAPatch.jacobian-176"><span class="linenos">176</span></a><span class="sd">        -------</span>
</span><span id="IGAPatch.jacobian-177"><a href="#IGAPatch.jacobian-177"><span class="linenos">177</span></a><span class="sd">        J : np.ndarray[np.floating]</span>
</span><span id="IGAPatch.jacobian-178"><a href="#IGAPatch.jacobian-178"><span class="linenos">178</span></a><span class="sd">            Jacobian matrices at each integration point,</span>
</span><span id="IGAPatch.jacobian-179"><a href="#IGAPatch.jacobian-179"><span class="linenos">179</span></a><span class="sd">            shape `(3, 3, n_intg_pts)` corresponding to (physical_dim, param_dim, n_intg_pts).</span>
</span><span id="IGAPatch.jacobian-180"><a href="#IGAPatch.jacobian-180"><span class="linenos">180</span></a><span class="sd">        Jinv : np.ndarray[np.floating]</span>
</span><span id="IGAPatch.jacobian-181"><a href="#IGAPatch.jacobian-181"><span class="linenos">181</span></a><span class="sd">            Inverse of the Jacobian matrices, shape `(3, 3, n_intg_pts)` corresponding to</span>
</span><span id="IGAPatch.jacobian-182"><a href="#IGAPatch.jacobian-182"><span class="linenos">182</span></a><span class="sd">            (param_dim, physical_dim, n_intg_pts).</span>
</span><span id="IGAPatch.jacobian-183"><a href="#IGAPatch.jacobian-183"><span class="linenos">183</span></a><span class="sd">        detJ : np.ndarray[np.floating]</span>
</span><span id="IGAPatch.jacobian-184"><a href="#IGAPatch.jacobian-184"><span class="linenos">184</span></a><span class="sd">            Determinant of the Jacobian at each integration point, shape `(n_intg_pts,)`.</span>
</span><span id="IGAPatch.jacobian-185"><a href="#IGAPatch.jacobian-185"><span class="linenos">185</span></a>
</span><span id="IGAPatch.jacobian-186"><a href="#IGAPatch.jacobian-186"><span class="linenos">186</span></a><span class="sd">        Notes</span>
</span><span id="IGAPatch.jacobian-187"><a href="#IGAPatch.jacobian-187"><span class="linenos">187</span></a><span class="sd">        -----</span>
</span><span id="IGAPatch.jacobian-188"><a href="#IGAPatch.jacobian-188"><span class="linenos">188</span></a><span class="sd">        - `J[:, :, i]` gives the 33 Jacobian matrix at the i-th integration point.</span>
</span><span id="IGAPatch.jacobian-189"><a href="#IGAPatch.jacobian-189"><span class="linenos">189</span></a><span class="sd">        - `Jinv[:, :, i]` is the inverse of that matrix, used to compute derivatives</span>
</span><span id="IGAPatch.jacobian-190"><a href="#IGAPatch.jacobian-190"><span class="linenos">190</span></a><span class="sd">        with respect to physical coordinates.</span>
</span><span id="IGAPatch.jacobian-191"><a href="#IGAPatch.jacobian-191"><span class="linenos">191</span></a><span class="sd">        - `detJ[i]` is the determinant of `J[:, :, i]`, used for integration weights.</span>
</span><span id="IGAPatch.jacobian-192"><a href="#IGAPatch.jacobian-192"><span class="linenos">192</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatch.jacobian-193"><a href="#IGAPatch.jacobian-193"><span class="linenos">193</span></a>        <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
</span><span id="IGAPatch.jacobian-194"><a href="#IGAPatch.jacobian-194"><span class="linenos">194</span></a>            <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">@</span> <span class="n">dN_dxi</span><span class="o">.</span><span class="n">T</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="k">for</span> <span class="n">dN_dxi</span> <span class="ow">in</span> <span class="n">dN_dXI</span><span class="p">],</span>
</span><span id="IGAPatch.jacobian-195"><a href="#IGAPatch.jacobian-195"><span class="linenos">195</span></a>            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="IGAPatch.jacobian-196"><a href="#IGAPatch.jacobian-196"><span class="linenos">196</span></a>        <span class="p">)</span>  <span class="c1"># shape(3(phy), 3(param), nb_intg_pts)</span>
</span><span id="IGAPatch.jacobian-197"><a href="#IGAPatch.jacobian-197"><span class="linenos">197</span></a>        <span class="n">Jinv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">J</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span>
</span><span id="IGAPatch.jacobian-198"><a href="#IGAPatch.jacobian-198"><span class="linenos">198</span></a>            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="IGAPatch.jacobian-199"><a href="#IGAPatch.jacobian-199"><span class="linenos">199</span></a>        <span class="p">)</span>  <span class="c1"># shape(3(param), 3(phy), nb_intg_pts)</span>
</span><span id="IGAPatch.jacobian-200"><a href="#IGAPatch.jacobian-200"><span class="linenos">200</span></a>        <span class="n">detJ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">J</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>  <span class="c1"># vector of nb_intg_pts values</span>
</span><span id="IGAPatch.jacobian-201"><a href="#IGAPatch.jacobian-201"><span class="linenos">201</span></a>        <span class="k">return</span> <span class="n">J</span><span class="p">,</span> <span class="n">Jinv</span><span class="p">,</span> <span class="n">detJ</span>
</span></pre></div>


            <div class="docstring"><p>Compute the Jacobian matrix of the mapping from parametric to physical space,
its inverse, and its determinant at all integration points.</p>

<p>The Jacobian describes how the parametric (xi, eta, zeta) coordinates
are mapped to physical coordinates using the patch's control points.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>dN_dXI</strong> (tuple[sps.spmatrix, sps.spmatrix, sps.spmatrix]):
Derivatives of the shape functions with respect to the parametric coordinates.
Tuple of sparse matrices <code>(dN_dxi, dN_deta, dN_dzeta)</code>, each of shape
(n_intg_pts, n_ctrl_pts).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>J</strong> (np.ndarray[np.floating]):
Jacobian matrices at each integration point,
shape <code>(3, 3, n_intg_pts)</code> corresponding to (physical_dim, param_dim, n_intg_pts).</li>
<li><strong>Jinv</strong> (np.ndarray[np.floating]):
Inverse of the Jacobian matrices, shape <code>(3, 3, n_intg_pts)</code> corresponding to
(param_dim, physical_dim, n_intg_pts).</li>
<li><strong>detJ</strong> (np.ndarray[np.floating]):
Determinant of the Jacobian at each integration point, shape <code>(n_intg_pts,)</code>.</li>
</ul>

<h6 id="notes">Notes</h6>

<ul>
<li><code>J[:, :, i]</code> gives the 33 Jacobian matrix at the i-th integration point.</li>
<li><code>Jinv[:, :, i]</code> is the inverse of that matrix, used to compute derivatives
with respect to physical coordinates.</li>
<li><code>detJ[i]</code> is the determinant of <code>J[:, :, i]</code>, used for integration weights.</li>
</ul>
</div>


                            </div>
                            <div id="IGAPatch.grad_N" class="classattr">
                                        <input id="IGAPatch.grad_N-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">grad_N</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">Jinv</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>,</span><span class="param">	<span class="n">dN_dXI</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">_matrix</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">,</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">_matrix</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">,</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">_matrix</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">object_</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="IGAPatch.grad_N-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IGAPatch.grad_N"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IGAPatch.grad_N-203"><a href="#IGAPatch.grad_N-203"><span class="linenos">203</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">grad_N</span><span class="p">(</span>
</span><span id="IGAPatch.grad_N-204"><a href="#IGAPatch.grad_N-204"><span class="linenos">204</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="IGAPatch.grad_N-205"><a href="#IGAPatch.grad_N-205"><span class="linenos">205</span></a>        <span class="n">Jinv</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span>
</span><span id="IGAPatch.grad_N-206"><a href="#IGAPatch.grad_N-206"><span class="linenos">206</span></a>        <span class="n">dN_dXI</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">,</span> <span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">,</span> <span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">],</span>
</span><span id="IGAPatch.grad_N-207"><a href="#IGAPatch.grad_N-207"><span class="linenos">207</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">object_</span><span class="p">]:</span>
</span><span id="IGAPatch.grad_N-208"><a href="#IGAPatch.grad_N-208"><span class="linenos">208</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatch.grad_N-209"><a href="#IGAPatch.grad_N-209"><span class="linenos">209</span></a><span class="sd">        Compute the gradient of the B-spline shape functions with respect to physical coordinates.</span>
</span><span id="IGAPatch.grad_N-210"><a href="#IGAPatch.grad_N-210"><span class="linenos">210</span></a>
</span><span id="IGAPatch.grad_N-211"><a href="#IGAPatch.grad_N-211"><span class="linenos">211</span></a><span class="sd">        The gradient is obtained by applying the chain rule:</span>
</span><span id="IGAPatch.grad_N-212"><a href="#IGAPatch.grad_N-212"><span class="linenos">212</span></a><span class="sd">            dN/dX_i = [J]_ij @ dN/dXI_j</span>
</span><span id="IGAPatch.grad_N-213"><a href="#IGAPatch.grad_N-213"><span class="linenos">213</span></a><span class="sd">        for each integration point.</span>
</span><span id="IGAPatch.grad_N-214"><a href="#IGAPatch.grad_N-214"><span class="linenos">214</span></a>
</span><span id="IGAPatch.grad_N-215"><a href="#IGAPatch.grad_N-215"><span class="linenos">215</span></a><span class="sd">        Parameters</span>
</span><span id="IGAPatch.grad_N-216"><a href="#IGAPatch.grad_N-216"><span class="linenos">216</span></a><span class="sd">        ----------</span>
</span><span id="IGAPatch.grad_N-217"><a href="#IGAPatch.grad_N-217"><span class="linenos">217</span></a><span class="sd">        Jinv : np.ndarray[np.floating]</span>
</span><span id="IGAPatch.grad_N-218"><a href="#IGAPatch.grad_N-218"><span class="linenos">218</span></a><span class="sd">            Inverse Jacobian matrices at all integration points,</span>
</span><span id="IGAPatch.grad_N-219"><a href="#IGAPatch.grad_N-219"><span class="linenos">219</span></a><span class="sd">            shape `(3, 3, n_intg_pts)` corresponding to (param_dim, physical_dim, n_intg_pts).</span>
</span><span id="IGAPatch.grad_N-220"><a href="#IGAPatch.grad_N-220"><span class="linenos">220</span></a><span class="sd">        dN_dXI : tuple[sps.spmatrix, sps.spmatrix, sps.spmatrix]</span>
</span><span id="IGAPatch.grad_N-221"><a href="#IGAPatch.grad_N-221"><span class="linenos">221</span></a><span class="sd">            Derivatives of shape functions with respect to parametric coordinates</span>
</span><span id="IGAPatch.grad_N-222"><a href="#IGAPatch.grad_N-222"><span class="linenos">222</span></a><span class="sd">            `(dN_dxi, dN_deta, dN_dzeta)`.</span>
</span><span id="IGAPatch.grad_N-223"><a href="#IGAPatch.grad_N-223"><span class="linenos">223</span></a><span class="sd">            Each sparse matrix has shape `(n_intg_pts, n_ctrl_pts)`.</span>
</span><span id="IGAPatch.grad_N-224"><a href="#IGAPatch.grad_N-224"><span class="linenos">224</span></a>
</span><span id="IGAPatch.grad_N-225"><a href="#IGAPatch.grad_N-225"><span class="linenos">225</span></a><span class="sd">        Returns</span>
</span><span id="IGAPatch.grad_N-226"><a href="#IGAPatch.grad_N-226"><span class="linenos">226</span></a><span class="sd">        -------</span>
</span><span id="IGAPatch.grad_N-227"><a href="#IGAPatch.grad_N-227"><span class="linenos">227</span></a><span class="sd">        dN_dX : np.ndarray[np.object_]</span>
</span><span id="IGAPatch.grad_N-228"><a href="#IGAPatch.grad_N-228"><span class="linenos">228</span></a><span class="sd">            Gradients of the shape functions with respect to physical coordinates.</span>
</span><span id="IGAPatch.grad_N-229"><a href="#IGAPatch.grad_N-229"><span class="linenos">229</span></a><span class="sd">            Numpy array of shape `(3,)`, where each element is a `sps.spmatrix` of shape</span>
</span><span id="IGAPatch.grad_N-230"><a href="#IGAPatch.grad_N-230"><span class="linenos">230</span></a><span class="sd">            `(n_intg_pts, n_ctrl_pts)` corresponding to the derivative along each physical axis.</span>
</span><span id="IGAPatch.grad_N-231"><a href="#IGAPatch.grad_N-231"><span class="linenos">231</span></a>
</span><span id="IGAPatch.grad_N-232"><a href="#IGAPatch.grad_N-232"><span class="linenos">232</span></a><span class="sd">        Notes</span>
</span><span id="IGAPatch.grad_N-233"><a href="#IGAPatch.grad_N-233"><span class="linenos">233</span></a><span class="sd">        -----</span>
</span><span id="IGAPatch.grad_N-234"><a href="#IGAPatch.grad_N-234"><span class="linenos">234</span></a><span class="sd">        - `dN_dX[i]` gives the derivative of all shape functions along the i-th physical direction</span>
</span><span id="IGAPatch.grad_N-235"><a href="#IGAPatch.grad_N-235"><span class="linenos">235</span></a><span class="sd">        at all integration points.</span>
</span><span id="IGAPatch.grad_N-236"><a href="#IGAPatch.grad_N-236"><span class="linenos">236</span></a><span class="sd">        - Each sparse matrix can be directly used in the assembly of the stiffness matrix or other</span>
</span><span id="IGAPatch.grad_N-237"><a href="#IGAPatch.grad_N-237"><span class="linenos">237</span></a><span class="sd">        integrals over the physical domain.</span>
</span><span id="IGAPatch.grad_N-238"><a href="#IGAPatch.grad_N-238"><span class="linenos">238</span></a><span class="sd">        - The use of `np.object_` array allows each entry to hold a separate sparse matrix.</span>
</span><span id="IGAPatch.grad_N-239"><a href="#IGAPatch.grad_N-239"><span class="linenos">239</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatch.grad_N-240"><a href="#IGAPatch.grad_N-240"><span class="linenos">240</span></a>        <span class="n">dN_dX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="IGAPatch.grad_N-241"><a href="#IGAPatch.grad_N-241"><span class="linenos">241</span></a>            <span class="p">[</span>
</span><span id="IGAPatch.grad_N-242"><a href="#IGAPatch.grad_N-242"><span class="linenos">242</span></a>                <span class="nb">sum</span><span class="p">([</span><span class="n">dN_dXI</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">Jinv</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span>
</span><span id="IGAPatch.grad_N-243"><a href="#IGAPatch.grad_N-243"><span class="linenos">243</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="IGAPatch.grad_N-244"><a href="#IGAPatch.grad_N-244"><span class="linenos">244</span></a>            <span class="p">]</span>
</span><span id="IGAPatch.grad_N-245"><a href="#IGAPatch.grad_N-245"><span class="linenos">245</span></a>        <span class="p">)</span>
</span><span id="IGAPatch.grad_N-246"><a href="#IGAPatch.grad_N-246"><span class="linenos">246</span></a>        <span class="k">return</span> <span class="n">dN_dX</span>
</span></pre></div>


            <div class="docstring"><p>Compute the gradient of the B-spline shape functions with respect to physical coordinates.</p>

<p>The gradient is obtained by applying the chain rule:
    dN/dX_i = [J]_ij @ dN/dXI_j
for each integration point.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>Jinv</strong> (np.ndarray[np.floating]):
Inverse Jacobian matrices at all integration points,
shape <code>(3, 3, n_intg_pts)</code> corresponding to (param_dim, physical_dim, n_intg_pts).</li>
<li><strong>dN_dXI</strong> (tuple[sps.spmatrix, sps.spmatrix, sps.spmatrix]):
Derivatives of shape functions with respect to parametric coordinates
<code>(dN_dxi, dN_deta, dN_dzeta)</code>.
Each sparse matrix has shape <code>(n_intg_pts, n_ctrl_pts)</code>.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>dN_dX</strong> (np.ndarray[np.object_]):
Gradients of the shape functions with respect to physical coordinates.
Numpy array of shape <code>(3,)</code>, where each element is a <code>sps.spmatrix</code> of shape
<code>(n_intg_pts, n_ctrl_pts)</code> corresponding to the derivative along each physical axis.</li>
</ul>

<h6 id="notes">Notes</h6>

<ul>
<li><code>dN_dX[i]</code> gives the derivative of all shape functions along the i-th physical direction
at all integration points.</li>
<li>Each sparse matrix can be directly used in the assembly of the stiffness matrix or other
integrals over the physical domain.</li>
<li>The use of <code>np.object_</code> array allows each entry to hold a separate sparse matrix.</li>
</ul>
</div>


                            </div>
                            <div id="IGAPatch.make_W" class="classattr">
                                        <input id="IGAPatch.make_W-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">make_W</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">detJ</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="IGAPatch.make_W-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IGAPatch.make_W"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IGAPatch.make_W-248"><a href="#IGAPatch.make_W-248"><span class="linenos">248</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">make_W</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detJ</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]:</span>
</span><span id="IGAPatch.make_W-249"><a href="#IGAPatch.make_W-249"><span class="linenos">249</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatch.make_W-250"><a href="#IGAPatch.make_W-250"><span class="linenos">250</span></a><span class="sd">        Compute the integration weights in physical space for Gaussian quadrature.</span>
</span><span id="IGAPatch.make_W-251"><a href="#IGAPatch.make_W-251"><span class="linenos">251</span></a>
</span><span id="IGAPatch.make_W-252"><a href="#IGAPatch.make_W-252"><span class="linenos">252</span></a><span class="sd">        The integration measure W at each quadrature point combines:</span>
</span><span id="IGAPatch.make_W-253"><a href="#IGAPatch.make_W-253"><span class="linenos">253</span></a><span class="sd">        1. The local volume scaling from the Jacobian determinant `detJ`.</span>
</span><span id="IGAPatch.make_W-254"><a href="#IGAPatch.make_W-254"><span class="linenos">254</span></a><span class="sd">        2. The parametric quadrature weights (`dxi`, `deta`, `dzeta`) in each direction.</span>
</span><span id="IGAPatch.make_W-255"><a href="#IGAPatch.make_W-255"><span class="linenos">255</span></a>
</span><span id="IGAPatch.make_W-256"><a href="#IGAPatch.make_W-256"><span class="linenos">256</span></a><span class="sd">        Mathematically:</span>
</span><span id="IGAPatch.make_W-257"><a href="#IGAPatch.make_W-257"><span class="linenos">257</span></a><span class="sd">            W = |detJ| * dxi  deta  dzeta</span>
</span><span id="IGAPatch.make_W-258"><a href="#IGAPatch.make_W-258"><span class="linenos">258</span></a><span class="sd">        with * the pointwise multiplication and  the Kronecker product.</span>
</span><span id="IGAPatch.make_W-259"><a href="#IGAPatch.make_W-259"><span class="linenos">259</span></a>
</span><span id="IGAPatch.make_W-260"><a href="#IGAPatch.make_W-260"><span class="linenos">260</span></a><span class="sd">        Parameters</span>
</span><span id="IGAPatch.make_W-261"><a href="#IGAPatch.make_W-261"><span class="linenos">261</span></a><span class="sd">        ----------</span>
</span><span id="IGAPatch.make_W-262"><a href="#IGAPatch.make_W-262"><span class="linenos">262</span></a><span class="sd">        detJ : np.ndarray[np.floating]</span>
</span><span id="IGAPatch.make_W-263"><a href="#IGAPatch.make_W-263"><span class="linenos">263</span></a><span class="sd">            Determinant of the Jacobian at each integration point.</span>
</span><span id="IGAPatch.make_W-264"><a href="#IGAPatch.make_W-264"><span class="linenos">264</span></a><span class="sd">            Shape: (n_intg_pts,)</span>
</span><span id="IGAPatch.make_W-265"><a href="#IGAPatch.make_W-265"><span class="linenos">265</span></a>
</span><span id="IGAPatch.make_W-266"><a href="#IGAPatch.make_W-266"><span class="linenos">266</span></a><span class="sd">        Returns</span>
</span><span id="IGAPatch.make_W-267"><a href="#IGAPatch.make_W-267"><span class="linenos">267</span></a><span class="sd">        -------</span>
</span><span id="IGAPatch.make_W-268"><a href="#IGAPatch.make_W-268"><span class="linenos">268</span></a><span class="sd">        W : np.ndarray[np.floating]</span>
</span><span id="IGAPatch.make_W-269"><a href="#IGAPatch.make_W-269"><span class="linenos">269</span></a><span class="sd">            Integration weights in physical space for each quadrature point.</span>
</span><span id="IGAPatch.make_W-270"><a href="#IGAPatch.make_W-270"><span class="linenos">270</span></a><span class="sd">            Shape: (n_intg_pts,)</span>
</span><span id="IGAPatch.make_W-271"><a href="#IGAPatch.make_W-271"><span class="linenos">271</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatch.make_W-272"><a href="#IGAPatch.make_W-272"><span class="linenos">272</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">detJ</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dxi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deta</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dzeta</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="IGAPatch.make_W-273"><a href="#IGAPatch.make_W-273"><span class="linenos">273</span></a>        <span class="k">return</span> <span class="n">W</span>
</span></pre></div>


            <div class="docstring"><p>Compute the integration weights in physical space for Gaussian quadrature.</p>

<p>The integration measure W at each quadrature point combines:</p>

<ol>
<li>The local volume scaling from the Jacobian determinant <code>detJ</code>.</li>
<li>The parametric quadrature weights (<code><a href="#IGAPatch.dxi">dxi</a></code>, <code><a href="#IGAPatch.deta">deta</a></code>, <code><a href="#IGAPatch.dzeta">dzeta</a></code>) in each direction.</li>
</ol>

<p>Mathematically:
    W = |detJ| * dxi  deta  dzeta
with * the pointwise multiplication and  the Kronecker product.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>detJ</strong> (np.ndarray[np.floating]):
Determinant of the Jacobian at each integration point.
Shape: (n_intg_pts,)</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>W</strong> (np.ndarray[np.floating]):
Integration weights in physical space for each quadrature point.
Shape: (n_intg_pts,)</li>
</ul>
</div>


                            </div>
                            <div id="IGAPatch.stiffness" class="classattr">
                                        <input id="IGAPatch.stiffness-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">stiffness</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">_matrix</span><span class="o">.</span><span class="n">spmatrix</span>:</span></span>

                <label class="view-source-button" for="IGAPatch.stiffness-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IGAPatch.stiffness"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IGAPatch.stiffness-275"><a href="#IGAPatch.stiffness-275"><span class="linenos">275</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">stiffness</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">:</span>
</span><span id="IGAPatch.stiffness-276"><a href="#IGAPatch.stiffness-276"><span class="linenos">276</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatch.stiffness-277"><a href="#IGAPatch.stiffness-277"><span class="linenos">277</span></a><span class="sd">        Compute the linear elasticity stiffness matrix for this IGAPatch.</span>
</span><span id="IGAPatch.stiffness-278"><a href="#IGAPatch.stiffness-278"><span class="linenos">278</span></a>
</span><span id="IGAPatch.stiffness-279"><a href="#IGAPatch.stiffness-279"><span class="linenos">279</span></a><span class="sd">        This method constructs the 3D linear elasticity stiffness matrix</span>
</span><span id="IGAPatch.stiffness-280"><a href="#IGAPatch.stiffness-280"><span class="linenos">280</span></a><span class="sd">        using Gaussian quadrature in the parametric space of the B-spline patch.</span>
</span><span id="IGAPatch.stiffness-281"><a href="#IGAPatch.stiffness-281"><span class="linenos">281</span></a><span class="sd">        The computation follows standard isogeometric analysis (IGA) procedure:</span>
</span><span id="IGAPatch.stiffness-282"><a href="#IGAPatch.stiffness-282"><span class="linenos">282</span></a>
</span><span id="IGAPatch.stiffness-283"><a href="#IGAPatch.stiffness-283"><span class="linenos">283</span></a><span class="sd">        1. Evaluate the derivatives of the B-spline shape functions with respect to</span>
</span><span id="IGAPatch.stiffness-284"><a href="#IGAPatch.stiffness-284"><span class="linenos">284</span></a><span class="sd">        the parametric coordinates (dN/dXI).</span>
</span><span id="IGAPatch.stiffness-285"><a href="#IGAPatch.stiffness-285"><span class="linenos">285</span></a><span class="sd">        2. Compute the Jacobian, its inverse, and determinant at all integration points.</span>
</span><span id="IGAPatch.stiffness-286"><a href="#IGAPatch.stiffness-286"><span class="linenos">286</span></a><span class="sd">        3. Transform shape function derivatives to the physical space (dN/dX).</span>
</span><span id="IGAPatch.stiffness-287"><a href="#IGAPatch.stiffness-287"><span class="linenos">287</span></a><span class="sd">        4. Build the strain-displacement matrices B (Bxx, Byy, Bzz, Bxy, Byz, Bxz).</span>
</span><span id="IGAPatch.stiffness-288"><a href="#IGAPatch.stiffness-288"><span class="linenos">288</span></a><span class="sd">        5. Assemble the stiffness contributions using the material elasticity tensor H</span>
</span><span id="IGAPatch.stiffness-289"><a href="#IGAPatch.stiffness-289"><span class="linenos">289</span></a><span class="sd">        and the integration weights W derived from the Jacobian.</span>
</span><span id="IGAPatch.stiffness-290"><a href="#IGAPatch.stiffness-290"><span class="linenos">290</span></a><span class="sd">        6. Sum all contributions to obtain the global stiffness matrix `K`.</span>
</span><span id="IGAPatch.stiffness-291"><a href="#IGAPatch.stiffness-291"><span class="linenos">291</span></a>
</span><span id="IGAPatch.stiffness-292"><a href="#IGAPatch.stiffness-292"><span class="linenos">292</span></a><span class="sd">        Returns</span>
</span><span id="IGAPatch.stiffness-293"><a href="#IGAPatch.stiffness-293"><span class="linenos">293</span></a><span class="sd">        -------</span>
</span><span id="IGAPatch.stiffness-294"><a href="#IGAPatch.stiffness-294"><span class="linenos">294</span></a><span class="sd">        K : sps.spmatrix</span>
</span><span id="IGAPatch.stiffness-295"><a href="#IGAPatch.stiffness-295"><span class="linenos">295</span></a><span class="sd">            Sparse stiffness matrix of the patch.</span>
</span><span id="IGAPatch.stiffness-296"><a href="#IGAPatch.stiffness-296"><span class="linenos">296</span></a><span class="sd">            Shape: (3 * n_ctrl_pts, 3 * n_ctrl_pts), in physical coordinates.</span>
</span><span id="IGAPatch.stiffness-297"><a href="#IGAPatch.stiffness-297"><span class="linenos">297</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatch.stiffness-298"><a href="#IGAPatch.stiffness-298"><span class="linenos">298</span></a>        <span class="n">dN_dXI</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">DN</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeta</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="IGAPatch.stiffness-299"><a href="#IGAPatch.stiffness-299"><span class="linenos">299</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">Jinv</span><span class="p">,</span> <span class="n">detJ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jacobian</span><span class="p">(</span><span class="n">dN_dXI</span><span class="p">)</span>
</span><span id="IGAPatch.stiffness-300"><a href="#IGAPatch.stiffness-300"><span class="linenos">300</span></a>        <span class="n">dN_dx</span><span class="p">,</span> <span class="n">dN_dy</span><span class="p">,</span> <span class="n">dN_dz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grad_N</span><span class="p">(</span><span class="n">Jinv</span><span class="p">,</span> <span class="n">dN_dXI</span><span class="p">)</span>
</span><span id="IGAPatch.stiffness-301"><a href="#IGAPatch.stiffness-301"><span class="linenos">301</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_W</span><span class="p">(</span><span class="n">detJ</span><span class="p">)</span>
</span><span id="IGAPatch.stiffness-302"><a href="#IGAPatch.stiffness-302"><span class="linenos">302</span></a>        <span class="c1"># B = sps.bmat([[dN_dx, None, None],</span>
</span><span id="IGAPatch.stiffness-303"><a href="#IGAPatch.stiffness-303"><span class="linenos">303</span></a>        <span class="c1">#               [None, dN_dy, None],</span>
</span><span id="IGAPatch.stiffness-304"><a href="#IGAPatch.stiffness-304"><span class="linenos">304</span></a>        <span class="c1">#               [None, None, dN_dz],</span>
</span><span id="IGAPatch.stiffness-305"><a href="#IGAPatch.stiffness-305"><span class="linenos">305</span></a>        <span class="c1">#               [dN_dy, dN_dx, None],</span>
</span><span id="IGAPatch.stiffness-306"><a href="#IGAPatch.stiffness-306"><span class="linenos">306</span></a>        <span class="c1">#               [None, dN_dz, dN_dy],</span>
</span><span id="IGAPatch.stiffness-307"><a href="#IGAPatch.stiffness-307"><span class="linenos">307</span></a>        <span class="c1">#               [dN_dz, None, dN_dx]])</span>
</span><span id="IGAPatch.stiffness-308"><a href="#IGAPatch.stiffness-308"><span class="linenos">308</span></a>
</span><span id="IGAPatch.stiffness-309"><a href="#IGAPatch.stiffness-309"><span class="linenos">309</span></a>        <span class="n">Z</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">coo_matrix</span><span class="p">(</span><span class="n">dN_dx</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
</span><span id="IGAPatch.stiffness-310"><a href="#IGAPatch.stiffness-310"><span class="linenos">310</span></a>        <span class="n">Bxx</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">dN_dx</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">Z</span><span class="p">))</span>
</span><span id="IGAPatch.stiffness-311"><a href="#IGAPatch.stiffness-311"><span class="linenos">311</span></a>        <span class="n">Byy</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Z</span><span class="p">,</span> <span class="n">dN_dy</span><span class="p">,</span> <span class="n">Z</span><span class="p">))</span>
</span><span id="IGAPatch.stiffness-312"><a href="#IGAPatch.stiffness-312"><span class="linenos">312</span></a>        <span class="n">Bzz</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Z</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">dN_dz</span><span class="p">))</span>
</span><span id="IGAPatch.stiffness-313"><a href="#IGAPatch.stiffness-313"><span class="linenos">313</span></a>        <span class="n">Bxy</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">dN_dy</span><span class="p">,</span> <span class="n">dN_dx</span><span class="p">,</span> <span class="n">Z</span><span class="p">))</span>
</span><span id="IGAPatch.stiffness-314"><a href="#IGAPatch.stiffness-314"><span class="linenos">314</span></a>        <span class="n">Byz</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Z</span><span class="p">,</span> <span class="n">dN_dz</span><span class="p">,</span> <span class="n">dN_dy</span><span class="p">))</span>
</span><span id="IGAPatch.stiffness-315"><a href="#IGAPatch.stiffness-315"><span class="linenos">315</span></a>        <span class="n">Bxz</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">dN_dz</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">dN_dx</span><span class="p">))</span>
</span><span id="IGAPatch.stiffness-316"><a href="#IGAPatch.stiffness-316"><span class="linenos">316</span></a>        <span class="n">K0</span> <span class="o">=</span> <span class="n">Bxx</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bzz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxz</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="IGAPatch.stiffness-317"><a href="#IGAPatch.stiffness-317"><span class="linenos">317</span></a>        <span class="n">K1</span> <span class="o">=</span> <span class="n">Byy</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bzz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxz</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="IGAPatch.stiffness-318"><a href="#IGAPatch.stiffness-318"><span class="linenos">318</span></a>        <span class="n">K2</span> <span class="o">=</span> <span class="n">Bzz</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bzz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxz</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="IGAPatch.stiffness-319"><a href="#IGAPatch.stiffness-319"><span class="linenos">319</span></a>        <span class="n">K3</span> <span class="o">=</span> <span class="n">Bxy</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bzz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxz</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="IGAPatch.stiffness-320"><a href="#IGAPatch.stiffness-320"><span class="linenos">320</span></a>        <span class="n">K4</span> <span class="o">=</span> <span class="n">Byz</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bzz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxz</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="IGAPatch.stiffness-321"><a href="#IGAPatch.stiffness-321"><span class="linenos">321</span></a>        <span class="n">K5</span> <span class="o">=</span> <span class="n">Bxz</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bzz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">Byz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bxz</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="IGAPatch.stiffness-322"><a href="#IGAPatch.stiffness-322"><span class="linenos">322</span></a>        <span class="n">K</span><span class="p">:</span> <span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">K0</span><span class="p">,</span> <span class="n">K1</span><span class="p">,</span> <span class="n">K2</span><span class="p">,</span> <span class="n">K3</span><span class="p">,</span> <span class="n">K4</span><span class="p">,</span> <span class="n">K5</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
</span><span id="IGAPatch.stiffness-323"><a href="#IGAPatch.stiffness-323"><span class="linenos">323</span></a>        <span class="k">return</span> <span class="n">K</span>
</span></pre></div>


            <div class="docstring"><p>Compute the linear elasticity stiffness matrix for this IGAPatch.</p>

<p>This method constructs the 3D linear elasticity stiffness matrix
using Gaussian quadrature in the parametric space of the B-spline patch.
The computation follows standard isogeometric analysis (IGA) procedure:</p>

<ol>
<li>Evaluate the derivatives of the B-spline shape functions with respect to
the parametric coordinates (dN/dXI).</li>
<li>Compute the Jacobian, its inverse, and determinant at all integration points.</li>
<li>Transform shape function derivatives to the physical space (dN/dX).</li>
<li>Build the strain-displacement matrices B (Bxx, Byy, Bzz, Bxy, Byz, Bxz).</li>
<li>Assemble the stiffness contributions using the material elasticity tensor H
and the integration weights W derived from the Jacobian.</li>
<li>Sum all contributions to obtain the global stiffness matrix <code>K</code>.</li>
</ol>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>K</strong> (sps.spmatrix):
Sparse stiffness matrix of the patch.
Shape: (3 * n_ctrl_pts, 3 * n_ctrl_pts), in physical coordinates.</li>
</ul>
</div>


                            </div>
                            <div id="IGAPatch.rhs" class="classattr">
                                        <input id="IGAPatch.rhs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rhs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="IGAPatch.rhs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IGAPatch.rhs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IGAPatch.rhs-325"><a href="#IGAPatch.rhs-325"><span class="linenos">325</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">rhs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]:</span>
</span><span id="IGAPatch.rhs-326"><a href="#IGAPatch.rhs-326"><span class="linenos">326</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatch.rhs-327"><a href="#IGAPatch.rhs-327"><span class="linenos">327</span></a><span class="sd">        Compute the right-hand side (load) vector for this `IGAPatch`.</span>
</span><span id="IGAPatch.rhs-328"><a href="#IGAPatch.rhs-328"><span class="linenos">328</span></a>
</span><span id="IGAPatch.rhs-329"><a href="#IGAPatch.rhs-329"><span class="linenos">329</span></a><span class="sd">        This method assembles the contribution of the surface forces applied on the</span>
</span><span id="IGAPatch.rhs-330"><a href="#IGAPatch.rhs-330"><span class="linenos">330</span></a><span class="sd">        patch boundary. It uses Gaussian quadrature along the patch faces where</span>
</span><span id="IGAPatch.rhs-331"><a href="#IGAPatch.rhs-331"><span class="linenos">331</span></a><span class="sd">        forces are defined. The procedure is:</span>
</span><span id="IGAPatch.rhs-332"><a href="#IGAPatch.rhs-332"><span class="linenos">332</span></a>
</span><span id="IGAPatch.rhs-333"><a href="#IGAPatch.rhs-333"><span class="linenos">333</span></a><span class="sd">        1. Loop over each physical axis (x, y, z) and each side of the patch (0=lower, 1=upper).</span>
</span><span id="IGAPatch.rhs-334"><a href="#IGAPatch.rhs-334"><span class="linenos">334</span></a><span class="sd">        2. Skip faces with zero surface forces.</span>
</span><span id="IGAPatch.rhs-335"><a href="#IGAPatch.rhs-335"><span class="linenos">335</span></a><span class="sd">        3. For each face with a force:</span>
</span><span id="IGAPatch.rhs-336"><a href="#IGAPatch.rhs-336"><span class="linenos">336</span></a><span class="sd">            a. Select the isoparametric coordinate corresponding to the face.</span>
</span><span id="IGAPatch.rhs-337"><a href="#IGAPatch.rhs-337"><span class="linenos">337</span></a><span class="sd">            b. Compute the shape functions `N` and their derivatives along the face.</span>
</span><span id="IGAPatch.rhs-338"><a href="#IGAPatch.rhs-338"><span class="linenos">338</span></a><span class="sd">            c. Compute the surface measure `dS` using the cross product of</span>
</span><span id="IGAPatch.rhs-339"><a href="#IGAPatch.rhs-339"><span class="linenos">339</span></a><span class="sd">                tangent vectors to the surface and parametric quadrature weights.</span>
</span><span id="IGAPatch.rhs-340"><a href="#IGAPatch.rhs-340"><span class="linenos">340</span></a><span class="sd">            d. Integrate the contribution of the shape functions over the surface.</span>
</span><span id="IGAPatch.rhs-341"><a href="#IGAPatch.rhs-341"><span class="linenos">341</span></a><span class="sd">        4. Sum all face contributions into the global right-hand side vector.</span>
</span><span id="IGAPatch.rhs-342"><a href="#IGAPatch.rhs-342"><span class="linenos">342</span></a>
</span><span id="IGAPatch.rhs-343"><a href="#IGAPatch.rhs-343"><span class="linenos">343</span></a><span class="sd">        Returns</span>
</span><span id="IGAPatch.rhs-344"><a href="#IGAPatch.rhs-344"><span class="linenos">344</span></a><span class="sd">        -------</span>
</span><span id="IGAPatch.rhs-345"><a href="#IGAPatch.rhs-345"><span class="linenos">345</span></a><span class="sd">        rhs : np.ndarray[np.floating]</span>
</span><span id="IGAPatch.rhs-346"><a href="#IGAPatch.rhs-346"><span class="linenos">346</span></a><span class="sd">            Right-hand side vector for the patch.</span>
</span><span id="IGAPatch.rhs-347"><a href="#IGAPatch.rhs-347"><span class="linenos">347</span></a><span class="sd">            Shape: (3 * n_ctrl_pts,), in physical coordinates.</span>
</span><span id="IGAPatch.rhs-348"><a href="#IGAPatch.rhs-348"><span class="linenos">348</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatch.rhs-349"><a href="#IGAPatch.rhs-349"><span class="linenos">349</span></a>        <span class="n">rhs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
</span><span id="IGAPatch.rhs-350"><a href="#IGAPatch.rhs-350"><span class="linenos">350</span></a>        <span class="n">XI</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeta</span><span class="p">]</span>
</span><span id="IGAPatch.rhs-351"><a href="#IGAPatch.rhs-351"><span class="linenos">351</span></a>        <span class="n">dXI</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dxi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dzeta</span><span class="p">]</span>
</span><span id="IGAPatch.rhs-352"><a href="#IGAPatch.rhs-352"><span class="linenos">352</span></a>        <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
</span><span id="IGAPatch.rhs-353"><a href="#IGAPatch.rhs-353"><span class="linenos">353</span></a>            <span class="k">for</span> <span class="n">side</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
</span><span id="IGAPatch.rhs-354"><a href="#IGAPatch.rhs-354"><span class="linenos">354</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">F_N</span><span class="p">[</span><span class="n">axis</span><span class="p">,</span> <span class="n">side</span><span class="p">],</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="IGAPatch.rhs-355"><a href="#IGAPatch.rhs-355"><span class="linenos">355</span></a>                    <span class="n">xi</span> <span class="o">=</span> <span class="p">[</span><span class="n">xi_i</span> <span class="k">for</span> <span class="n">xi_i</span> <span class="ow">in</span> <span class="n">XI</span><span class="p">]</span>
</span><span id="IGAPatch.rhs-356"><a href="#IGAPatch.rhs-356"><span class="linenos">356</span></a>                    <span class="k">if</span> <span class="n">side</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="IGAPatch.rhs-357"><a href="#IGAPatch.rhs-357"><span class="linenos">357</span></a>                        <span class="n">xi</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">bases</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</span><span id="IGAPatch.rhs-358"><a href="#IGAPatch.rhs-358"><span class="linenos">358</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="IGAPatch.rhs-359"><a href="#IGAPatch.rhs-359"><span class="linenos">359</span></a>                        <span class="n">xi</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">bases</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
</span><span id="IGAPatch.rhs-360"><a href="#IGAPatch.rhs-360"><span class="linenos">360</span></a>                    <span class="n">dxi</span> <span class="o">=</span> <span class="p">[</span><span class="n">dxi_i</span> <span class="k">for</span> <span class="n">dxi_i</span> <span class="ow">in</span> <span class="n">dXI</span><span class="p">]</span>
</span><span id="IGAPatch.rhs-361"><a href="#IGAPatch.rhs-361"><span class="linenos">361</span></a>                    <span class="n">dxi</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="IGAPatch.rhs-362"><a href="#IGAPatch.rhs-362"><span class="linenos">362</span></a>                    <span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">DN</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>
</span><span id="IGAPatch.rhs-363"><a href="#IGAPatch.rhs-363"><span class="linenos">363</span></a>                    <span class="n">k1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)[(</span><span class="n">axis</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="IGAPatch.rhs-364"><a href="#IGAPatch.rhs-364"><span class="linenos">364</span></a>                    <span class="n">k2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)[(</span><span class="n">axis</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="IGAPatch.rhs-365"><a href="#IGAPatch.rhs-365"><span class="linenos">365</span></a>                    <span class="n">dX1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="IGAPatch.rhs-366"><a href="#IGAPatch.rhs-366"><span class="linenos">366</span></a>                    <span class="n">dX2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k2</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="IGAPatch.rhs-367"><a href="#IGAPatch.rhs-367"><span class="linenos">367</span></a>                    <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">dX1</span><span class="p">,</span> <span class="n">dX2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="IGAPatch.rhs-368"><a href="#IGAPatch.rhs-368"><span class="linenos">368</span></a>                    <span class="n">dxi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">dxi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">dxi</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dxi</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="IGAPatch.rhs-369"><a href="#IGAPatch.rhs-369"><span class="linenos">369</span></a>                    <span class="n">dS</span> <span class="o">=</span> <span class="n">J</span> <span class="o">*</span> <span class="n">dxi</span>
</span><span id="IGAPatch.rhs-370"><a href="#IGAPatch.rhs-370"><span class="linenos">370</span></a>                    <span class="n">intg</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">dS</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
</span><span id="IGAPatch.rhs-371"><a href="#IGAPatch.rhs-371"><span class="linenos">371</span></a>                    <span class="n">rhs</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">F_N</span><span class="p">[</span><span class="n">axis</span><span class="p">,</span> <span class="n">side</span><span class="p">],</span> <span class="n">intg</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="IGAPatch.rhs-372"><a href="#IGAPatch.rhs-372"><span class="linenos">372</span></a>        <span class="k">return</span> <span class="n">rhs</span>
</span></pre></div>


            <div class="docstring"><p>Compute the right-hand side (load) vector for this <code><a href="#IGAPatch">IGAPatch</a></code>.</p>

<p>This method assembles the contribution of the surface forces applied on the
patch boundary. It uses Gaussian quadrature along the patch faces where
forces are defined. The procedure is:</p>

<ol>
<li>Loop over each physical axis (x, y, z) and each side of the patch (0=lower, 1=upper).</li>
<li>Skip faces with zero surface forces.</li>
<li>For each face with a force:
a. Select the isoparametric coordinate corresponding to the face.
b. Compute the shape functions <code>N</code> and their derivatives along the face.
c. Compute the surface measure <code>dS</code> using the cross product of
    tangent vectors to the surface and parametric quadrature weights.
d. Integrate the contribution of the shape functions over the surface.</li>
<li>Sum all face contributions into the global right-hand side vector.</li>
</ol>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>rhs</strong> (np.ndarray[np.floating]):
Right-hand side vector for the patch.
Shape: (3 * n_ctrl_pts,), in physical coordinates.</li>
</ul>
</div>


                            </div>
                            <div id="IGAPatch.area_border" class="classattr">
                                        <input id="IGAPatch.area_border-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">area_border</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">axis</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">front_side</span><span class="p">:</span> <span class="nb">bool</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="IGAPatch.area_border-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IGAPatch.area_border"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IGAPatch.area_border-374"><a href="#IGAPatch.area_border-374"><span class="linenos">374</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">area_border</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">front_side</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="IGAPatch.area_border-375"><a href="#IGAPatch.area_border-375"><span class="linenos">375</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatch.area_border-376"><a href="#IGAPatch.area_border-376"><span class="linenos">376</span></a><span class="sd">        Compute the total surface area of a patch face across a given axis.</span>
</span><span id="IGAPatch.area_border-377"><a href="#IGAPatch.area_border-377"><span class="linenos">377</span></a>
</span><span id="IGAPatch.area_border-378"><a href="#IGAPatch.area_border-378"><span class="linenos">378</span></a><span class="sd">        The face is defined by fixing one parametric coordinate (`xi`, `eta`, or `zeta`)</span>
</span><span id="IGAPatch.area_border-379"><a href="#IGAPatch.area_border-379"><span class="linenos">379</span></a><span class="sd">        to either its front or back boundary. The surface area is computed by</span>
</span><span id="IGAPatch.area_border-380"><a href="#IGAPatch.area_border-380"><span class="linenos">380</span></a><span class="sd">        integrating the differential surface measure over the face using</span>
</span><span id="IGAPatch.area_border-381"><a href="#IGAPatch.area_border-381"><span class="linenos">381</span></a><span class="sd">        the Gaussian quadrature points and weights.</span>
</span><span id="IGAPatch.area_border-382"><a href="#IGAPatch.area_border-382"><span class="linenos">382</span></a>
</span><span id="IGAPatch.area_border-383"><a href="#IGAPatch.area_border-383"><span class="linenos">383</span></a><span class="sd">        Parameters</span>
</span><span id="IGAPatch.area_border-384"><a href="#IGAPatch.area_border-384"><span class="linenos">384</span></a><span class="sd">        ----------</span>
</span><span id="IGAPatch.area_border-385"><a href="#IGAPatch.area_border-385"><span class="linenos">385</span></a><span class="sd">        axis : int</span>
</span><span id="IGAPatch.area_border-386"><a href="#IGAPatch.area_border-386"><span class="linenos">386</span></a><span class="sd">            Axis across which the face is oriented:</span>
</span><span id="IGAPatch.area_border-387"><a href="#IGAPatch.area_border-387"><span class="linenos">387</span></a><span class="sd">            0  xi, 1  eta, 2  zeta.</span>
</span><span id="IGAPatch.area_border-388"><a href="#IGAPatch.area_border-388"><span class="linenos">388</span></a><span class="sd">        front_side : bool</span>
</span><span id="IGAPatch.area_border-389"><a href="#IGAPatch.area_border-389"><span class="linenos">389</span></a><span class="sd">            If True, select the &quot;front&quot; boundary across the given axis;</span>
</span><span id="IGAPatch.area_border-390"><a href="#IGAPatch.area_border-390"><span class="linenos">390</span></a><span class="sd">            otherwise, select the &quot;back&quot; boundary.</span>
</span><span id="IGAPatch.area_border-391"><a href="#IGAPatch.area_border-391"><span class="linenos">391</span></a>
</span><span id="IGAPatch.area_border-392"><a href="#IGAPatch.area_border-392"><span class="linenos">392</span></a><span class="sd">        Returns</span>
</span><span id="IGAPatch.area_border-393"><a href="#IGAPatch.area_border-393"><span class="linenos">393</span></a><span class="sd">        -------</span>
</span><span id="IGAPatch.area_border-394"><a href="#IGAPatch.area_border-394"><span class="linenos">394</span></a><span class="sd">        area : float</span>
</span><span id="IGAPatch.area_border-395"><a href="#IGAPatch.area_border-395"><span class="linenos">395</span></a><span class="sd">            Total surface area of the specified patch face in physical space.</span>
</span><span id="IGAPatch.area_border-396"><a href="#IGAPatch.area_border-396"><span class="linenos">396</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatch.area_border-397"><a href="#IGAPatch.area_border-397"><span class="linenos">397</span></a>        <span class="n">XI</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeta</span><span class="p">]</span>
</span><span id="IGAPatch.area_border-398"><a href="#IGAPatch.area_border-398"><span class="linenos">398</span></a>        <span class="n">xi</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="IGAPatch.area_border-399"><a href="#IGAPatch.area_border-399"><span class="linenos">399</span></a>            <span class="p">(</span>
</span><span id="IGAPatch.area_border-400"><a href="#IGAPatch.area_border-400"><span class="linenos">400</span></a>                <span class="n">XI</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="IGAPatch.area_border-401"><a href="#IGAPatch.area_border-401"><span class="linenos">401</span></a>                <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">axis</span>
</span><span id="IGAPatch.area_border-402"><a href="#IGAPatch.area_border-402"><span class="linenos">402</span></a>                <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="IGAPatch.area_border-403"><a href="#IGAPatch.area_border-403"><span class="linenos">403</span></a>                    <span class="p">[</span>
</span><span id="IGAPatch.area_border-404"><a href="#IGAPatch.area_border-404"><span class="linenos">404</span></a>                        <span class="p">(</span>
</span><span id="IGAPatch.area_border-405"><a href="#IGAPatch.area_border-405"><span class="linenos">405</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">bases</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="IGAPatch.area_border-406"><a href="#IGAPatch.area_border-406"><span class="linenos">406</span></a>                            <span class="k">if</span> <span class="n">front_side</span>
</span><span id="IGAPatch.area_border-407"><a href="#IGAPatch.area_border-407"><span class="linenos">407</span></a>                            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">bases</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="IGAPatch.area_border-408"><a href="#IGAPatch.area_border-408"><span class="linenos">408</span></a>                        <span class="p">)</span>
</span><span id="IGAPatch.area_border-409"><a href="#IGAPatch.area_border-409"><span class="linenos">409</span></a>                    <span class="p">]</span>
</span><span id="IGAPatch.area_border-410"><a href="#IGAPatch.area_border-410"><span class="linenos">410</span></a>                <span class="p">)</span>
</span><span id="IGAPatch.area_border-411"><a href="#IGAPatch.area_border-411"><span class="linenos">411</span></a>            <span class="p">)</span>
</span><span id="IGAPatch.area_border-412"><a href="#IGAPatch.area_border-412"><span class="linenos">412</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="IGAPatch.area_border-413"><a href="#IGAPatch.area_border-413"><span class="linenos">413</span></a>        <span class="p">]</span>
</span><span id="IGAPatch.area_border-414"><a href="#IGAPatch.area_border-414"><span class="linenos">414</span></a>        <span class="n">dXI</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dxi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dzeta</span><span class="p">]</span>
</span><span id="IGAPatch.area_border-415"><a href="#IGAPatch.area_border-415"><span class="linenos">415</span></a>        <span class="n">dxi</span> <span class="o">=</span> <span class="p">[</span><span class="n">dXI</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">axis</span><span class="p">]</span>
</span><span id="IGAPatch.area_border-416"><a href="#IGAPatch.area_border-416"><span class="linenos">416</span></a>        <span class="n">dN1</span><span class="p">,</span> <span class="n">dN2</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="IGAPatch.area_border-417"><a href="#IGAPatch.area_border-417"><span class="linenos">417</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">DN</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="IGAPatch.area_border-418"><a href="#IGAPatch.area_border-418"><span class="linenos">418</span></a>            <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</span><span id="IGAPatch.area_border-419"><a href="#IGAPatch.area_border-419"><span class="linenos">419</span></a>            <span class="k">if</span> <span class="n">ax</span> <span class="o">!=</span> <span class="n">axis</span>
</span><span id="IGAPatch.area_border-420"><a href="#IGAPatch.area_border-420"><span class="linenos">420</span></a>        <span class="p">]</span>
</span><span id="IGAPatch.area_border-421"><a href="#IGAPatch.area_border-421"><span class="linenos">421</span></a>        <span class="n">dSdXI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
</span><span id="IGAPatch.area_border-422"><a href="#IGAPatch.area_border-422"><span class="linenos">422</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span>
</span><span id="IGAPatch.area_border-423"><a href="#IGAPatch.area_border-423"><span class="linenos">423</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">@</span> <span class="n">dN1</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
</span><span id="IGAPatch.area_border-424"><a href="#IGAPatch.area_border-424"><span class="linenos">424</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">@</span> <span class="n">dN2</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
</span><span id="IGAPatch.area_border-425"><a href="#IGAPatch.area_border-425"><span class="linenos">425</span></a>                <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="IGAPatch.area_border-426"><a href="#IGAPatch.area_border-426"><span class="linenos">426</span></a>            <span class="p">),</span>
</span><span id="IGAPatch.area_border-427"><a href="#IGAPatch.area_border-427"><span class="linenos">427</span></a>            <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="IGAPatch.area_border-428"><a href="#IGAPatch.area_border-428"><span class="linenos">428</span></a>        <span class="p">)</span>
</span><span id="IGAPatch.area_border-429"><a href="#IGAPatch.area_border-429"><span class="linenos">429</span></a>        <span class="n">dXI_area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="o">*</span><span class="n">dxi</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span id="IGAPatch.area_border-430"><a href="#IGAPatch.area_border-430"><span class="linenos">430</span></a>        <span class="n">area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dSdXI</span><span class="p">,</span> <span class="n">dXI_area</span><span class="p">)</span>
</span><span id="IGAPatch.area_border-431"><a href="#IGAPatch.area_border-431"><span class="linenos">431</span></a>        <span class="k">return</span> <span class="n">area</span>
</span></pre></div>


            <div class="docstring"><p>Compute the total surface area of a patch face across a given axis.</p>

<p>The face is defined by fixing one parametric coordinate (<code><a href="#IGAPatch.xi">xi</a></code>, <code><a href="#IGAPatch.eta">eta</a></code>, or <code><a href="#IGAPatch.zeta">zeta</a></code>)
to either its front or back boundary. The surface area is computed by
integrating the differential surface measure over the face using
the Gaussian quadrature points and weights.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>axis</strong> (int):
Axis across which the face is oriented:
0  xi, 1  eta, 2  zeta.</li>
<li><strong>front_side</strong> (bool):
If True, select the "front" boundary across the given axis;
otherwise, select the "back" boundary.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>area</strong> (float):
Total surface area of the specified patch face in physical space.</li>
</ul>
</div>


                            </div>
                            <div id="IGAPatch.epsilon" class="classattr">
                                        <input id="IGAPatch.epsilon-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">epsilon</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">U</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>,</span><span class="param">	<span class="n">XI</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="IGAPatch.epsilon-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IGAPatch.epsilon"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IGAPatch.epsilon-433"><a href="#IGAPatch.epsilon-433"><span class="linenos">433</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">epsilon</span><span class="p">(</span>
</span><span id="IGAPatch.epsilon-434"><a href="#IGAPatch.epsilon-434"><span class="linenos">434</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">U</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="n">XI</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]]</span>
</span><span id="IGAPatch.epsilon-435"><a href="#IGAPatch.epsilon-435"><span class="linenos">435</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]:</span>
</span><span id="IGAPatch.epsilon-436"><a href="#IGAPatch.epsilon-436"><span class="linenos">436</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatch.epsilon-437"><a href="#IGAPatch.epsilon-437"><span class="linenos">437</span></a><span class="sd">        Compute the strain tensor in Voigt notation for the patch.</span>
</span><span id="IGAPatch.epsilon-438"><a href="#IGAPatch.epsilon-438"><span class="linenos">438</span></a>
</span><span id="IGAPatch.epsilon-439"><a href="#IGAPatch.epsilon-439"><span class="linenos">439</span></a><span class="sd">        The strain tensor is computed as:</span>
</span><span id="IGAPatch.epsilon-440"><a href="#IGAPatch.epsilon-440"><span class="linenos">440</span></a><span class="sd">            eps = [_xx, _yy, _zz, _xy, _yz, _xz]^T</span>
</span><span id="IGAPatch.epsilon-441"><a href="#IGAPatch.epsilon-441"><span class="linenos">441</span></a><span class="sd">        using the displacement field `U` and the isoparametric coordinates `XI`.</span>
</span><span id="IGAPatch.epsilon-442"><a href="#IGAPatch.epsilon-442"><span class="linenos">442</span></a><span class="sd">        Small adjustments are applied at the parametric boundaries to avoid</span>
</span><span id="IGAPatch.epsilon-443"><a href="#IGAPatch.epsilon-443"><span class="linenos">443</span></a><span class="sd">        evaluation exactly on the control point spans.</span>
</span><span id="IGAPatch.epsilon-444"><a href="#IGAPatch.epsilon-444"><span class="linenos">444</span></a>
</span><span id="IGAPatch.epsilon-445"><a href="#IGAPatch.epsilon-445"><span class="linenos">445</span></a><span class="sd">        Parameters</span>
</span><span id="IGAPatch.epsilon-446"><a href="#IGAPatch.epsilon-446"><span class="linenos">446</span></a><span class="sd">        ----------</span>
</span><span id="IGAPatch.epsilon-447"><a href="#IGAPatch.epsilon-447"><span class="linenos">447</span></a><span class="sd">        U : np.ndarray[np.floating]</span>
</span><span id="IGAPatch.epsilon-448"><a href="#IGAPatch.epsilon-448"><span class="linenos">448</span></a><span class="sd">            Displacement field of shape (3, nb_ctrl_pts), with the first dimension</span>
</span><span id="IGAPatch.epsilon-449"><a href="#IGAPatch.epsilon-449"><span class="linenos">449</span></a><span class="sd">            corresponding to the physical coordinates (x, y, z).</span>
</span><span id="IGAPatch.epsilon-450"><a href="#IGAPatch.epsilon-450"><span class="linenos">450</span></a><span class="sd">        XI : list[np.ndarray[np.floating]]</span>
</span><span id="IGAPatch.epsilon-451"><a href="#IGAPatch.epsilon-451"><span class="linenos">451</span></a><span class="sd">            List of arrays for the parametric coordinates in each direction</span>
</span><span id="IGAPatch.epsilon-452"><a href="#IGAPatch.epsilon-452"><span class="linenos">452</span></a><span class="sd">            [xi, eta, zeta].</span>
</span><span id="IGAPatch.epsilon-453"><a href="#IGAPatch.epsilon-453"><span class="linenos">453</span></a>
</span><span id="IGAPatch.epsilon-454"><a href="#IGAPatch.epsilon-454"><span class="linenos">454</span></a><span class="sd">        Returns</span>
</span><span id="IGAPatch.epsilon-455"><a href="#IGAPatch.epsilon-455"><span class="linenos">455</span></a><span class="sd">        -------</span>
</span><span id="IGAPatch.epsilon-456"><a href="#IGAPatch.epsilon-456"><span class="linenos">456</span></a><span class="sd">        eps : np.ndarray[np.floating]</span>
</span><span id="IGAPatch.epsilon-457"><a href="#IGAPatch.epsilon-457"><span class="linenos">457</span></a><span class="sd">            Strain tensor in Voigt notation, shape (6, n_param_pts),</span>
</span><span id="IGAPatch.epsilon-458"><a href="#IGAPatch.epsilon-458"><span class="linenos">458</span></a><span class="sd">            where n_param_pts = product of lengths of XI arrays.</span>
</span><span id="IGAPatch.epsilon-459"><a href="#IGAPatch.epsilon-459"><span class="linenos">459</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatch.epsilon-460"><a href="#IGAPatch.epsilon-460"><span class="linenos">460</span></a>        <span class="k">for</span> <span class="n">xi</span><span class="p">,</span> <span class="n">basis</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">XI</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">bases</span><span class="p">):</span>
</span><span id="IGAPatch.epsilon-461"><a href="#IGAPatch.epsilon-461"><span class="linenos">461</span></a>            <span class="n">xi</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">basis</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)]</span> <span class="o">+=</span> <span class="mf">1e-5</span>
</span><span id="IGAPatch.epsilon-462"><a href="#IGAPatch.epsilon-462"><span class="linenos">462</span></a>            <span class="n">xi</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">basis</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)]</span> <span class="o">-=</span> <span class="mf">1e-5</span>
</span><span id="IGAPatch.epsilon-463"><a href="#IGAPatch.epsilon-463"><span class="linenos">463</span></a>        <span class="n">dN_dXI</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">DN</span><span class="p">(</span><span class="n">XI</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="IGAPatch.epsilon-464"><a href="#IGAPatch.epsilon-464"><span class="linenos">464</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">Jinv</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jacobian</span><span class="p">(</span><span class="n">dN_dXI</span><span class="p">)</span>  <span class="c1"># dXI_dX</span>
</span><span id="IGAPatch.epsilon-465"><a href="#IGAPatch.epsilon-465"><span class="linenos">465</span></a>        <span class="n">dN_dx</span><span class="p">,</span> <span class="n">dN_dy</span><span class="p">,</span> <span class="n">dN_dz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grad_N</span><span class="p">(</span><span class="n">Jinv</span><span class="p">,</span> <span class="n">dN_dXI</span><span class="p">)</span>
</span><span id="IGAPatch.epsilon-466"><a href="#IGAPatch.epsilon-466"><span class="linenos">466</span></a>        <span class="n">eps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="IGAPatch.epsilon-467"><a href="#IGAPatch.epsilon-467"><span class="linenos">467</span></a>            <span class="p">[</span>
</span><span id="IGAPatch.epsilon-468"><a href="#IGAPatch.epsilon-468"><span class="linenos">468</span></a>                <span class="n">dN_dx</span> <span class="o">@</span> <span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
</span><span id="IGAPatch.epsilon-469"><a href="#IGAPatch.epsilon-469"><span class="linenos">469</span></a>                <span class="n">dN_dy</span> <span class="o">@</span> <span class="n">U</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
</span><span id="IGAPatch.epsilon-470"><a href="#IGAPatch.epsilon-470"><span class="linenos">470</span></a>                <span class="n">dN_dz</span> <span class="o">@</span> <span class="n">U</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
</span><span id="IGAPatch.epsilon-471"><a href="#IGAPatch.epsilon-471"><span class="linenos">471</span></a>                <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">dN_dy</span> <span class="o">@</span> <span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="o">+</span> <span class="n">dN_dx</span> <span class="o">@</span> <span class="n">U</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()),</span>
</span><span id="IGAPatch.epsilon-472"><a href="#IGAPatch.epsilon-472"><span class="linenos">472</span></a>                <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">dN_dz</span> <span class="o">@</span> <span class="n">U</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="o">+</span> <span class="n">dN_dy</span> <span class="o">@</span> <span class="n">U</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()),</span>
</span><span id="IGAPatch.epsilon-473"><a href="#IGAPatch.epsilon-473"><span class="linenos">473</span></a>                <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">dN_dz</span> <span class="o">@</span> <span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="o">+</span> <span class="n">dN_dx</span> <span class="o">@</span> <span class="n">U</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()),</span>
</span><span id="IGAPatch.epsilon-474"><a href="#IGAPatch.epsilon-474"><span class="linenos">474</span></a>            <span class="p">]</span>
</span><span id="IGAPatch.epsilon-475"><a href="#IGAPatch.epsilon-475"><span class="linenos">475</span></a>        <span class="p">)</span>
</span><span id="IGAPatch.epsilon-476"><a href="#IGAPatch.epsilon-476"><span class="linenos">476</span></a>        <span class="k">return</span> <span class="n">eps</span>
</span></pre></div>


            <div class="docstring"><p>Compute the strain tensor in Voigt notation for the patch.</p>

<p>The strain tensor is computed as:
    eps = [_xx, _yy, _zz, _xy, _yz, _xz]^T
using the displacement field <code>U</code> and the isoparametric coordinates <code>XI</code>.
Small adjustments are applied at the parametric boundaries to avoid
evaluation exactly on the control point spans.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>U</strong> (np.ndarray[np.floating]):
Displacement field of shape (3, nb_ctrl_pts), with the first dimension
corresponding to the physical coordinates (x, y, z).</li>
<li><strong>XI</strong> (list[np.ndarray[np.floating]]):
List of arrays for the parametric coordinates in each direction
[xi, eta, zeta].</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>eps</strong> (np.ndarray[np.floating]):
Strain tensor in Voigt notation, shape (6, n_param_pts),
where n_param_pts = product of lengths of XI arrays.</li>
</ul>
</div>


                            </div>
                            <div id="IGAPatch.sigma" class="classattr">
                                        <input id="IGAPatch.sigma-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sigma</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">eps</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="IGAPatch.sigma-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IGAPatch.sigma"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IGAPatch.sigma-478"><a href="#IGAPatch.sigma-478"><span class="linenos">478</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">sigma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eps</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]:</span>
</span><span id="IGAPatch.sigma-479"><a href="#IGAPatch.sigma-479"><span class="linenos">479</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatch.sigma-480"><a href="#IGAPatch.sigma-480"><span class="linenos">480</span></a><span class="sd">        Compute the stress tensor in Voigt notation for the patch.</span>
</span><span id="IGAPatch.sigma-481"><a href="#IGAPatch.sigma-481"><span class="linenos">481</span></a>
</span><span id="IGAPatch.sigma-482"><a href="#IGAPatch.sigma-482"><span class="linenos">482</span></a><span class="sd">        The stress tensor is computed as:</span>
</span><span id="IGAPatch.sigma-483"><a href="#IGAPatch.sigma-483"><span class="linenos">483</span></a><span class="sd">            sigma = H @ eps</span>
</span><span id="IGAPatch.sigma-484"><a href="#IGAPatch.sigma-484"><span class="linenos">484</span></a><span class="sd">        where H is the linear elasticity matrix of the material.</span>
</span><span id="IGAPatch.sigma-485"><a href="#IGAPatch.sigma-485"><span class="linenos">485</span></a>
</span><span id="IGAPatch.sigma-486"><a href="#IGAPatch.sigma-486"><span class="linenos">486</span></a><span class="sd">        Parameters</span>
</span><span id="IGAPatch.sigma-487"><a href="#IGAPatch.sigma-487"><span class="linenos">487</span></a><span class="sd">        ----------</span>
</span><span id="IGAPatch.sigma-488"><a href="#IGAPatch.sigma-488"><span class="linenos">488</span></a><span class="sd">        eps : np.ndarray[np.floating]</span>
</span><span id="IGAPatch.sigma-489"><a href="#IGAPatch.sigma-489"><span class="linenos">489</span></a><span class="sd">            Strain tensor in Voigt notation, shape (6, n_param_pts).</span>
</span><span id="IGAPatch.sigma-490"><a href="#IGAPatch.sigma-490"><span class="linenos">490</span></a>
</span><span id="IGAPatch.sigma-491"><a href="#IGAPatch.sigma-491"><span class="linenos">491</span></a><span class="sd">        Returns</span>
</span><span id="IGAPatch.sigma-492"><a href="#IGAPatch.sigma-492"><span class="linenos">492</span></a><span class="sd">        -------</span>
</span><span id="IGAPatch.sigma-493"><a href="#IGAPatch.sigma-493"><span class="linenos">493</span></a><span class="sd">        sig : np.ndarray[np.floating]</span>
</span><span id="IGAPatch.sigma-494"><a href="#IGAPatch.sigma-494"><span class="linenos">494</span></a><span class="sd">            Stress tensor in Voigt notation, shape (6, n_param_pts).</span>
</span><span id="IGAPatch.sigma-495"><a href="#IGAPatch.sigma-495"><span class="linenos">495</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatch.sigma-496"><a href="#IGAPatch.sigma-496"><span class="linenos">496</span></a>        <span class="n">eps</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span> <span class="o">*=</span> <span class="mi">2</span>
</span><span id="IGAPatch.sigma-497"><a href="#IGAPatch.sigma-497"><span class="linenos">497</span></a>        <span class="n">sig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">@</span> <span class="n">eps</span>
</span><span id="IGAPatch.sigma-498"><a href="#IGAPatch.sigma-498"><span class="linenos">498</span></a>        <span class="k">return</span> <span class="n">sig</span>
</span></pre></div>


            <div class="docstring"><p>Compute the stress tensor in Voigt notation for the patch.</p>

<p>The stress tensor is computed as:
    sigma = H @ eps
where H is the linear elasticity matrix of the material.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>eps</strong> (np.ndarray[np.floating]):
Strain tensor in Voigt notation, shape (6, n_param_pts).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>sig</strong> (np.ndarray[np.floating]):
Stress tensor in Voigt notation, shape (6, n_param_pts).</li>
</ul>
</div>


                            </div>
                            <div id="IGAPatch.sigma_eig" class="classattr">
                                        <input id="IGAPatch.sigma_eig-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sigma_eig</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">sig</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="IGAPatch.sigma_eig-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IGAPatch.sigma_eig"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IGAPatch.sigma_eig-500"><a href="#IGAPatch.sigma_eig-500"><span class="linenos">500</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">sigma_eig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]:</span>
</span><span id="IGAPatch.sigma_eig-501"><a href="#IGAPatch.sigma_eig-501"><span class="linenos">501</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatch.sigma_eig-502"><a href="#IGAPatch.sigma_eig-502"><span class="linenos">502</span></a><span class="sd">        Compute the principal stresses (eigenvalues of the stress tensor)</span>
</span><span id="IGAPatch.sigma_eig-503"><a href="#IGAPatch.sigma_eig-503"><span class="linenos">503</span></a><span class="sd">        at the specified parametric points.</span>
</span><span id="IGAPatch.sigma_eig-504"><a href="#IGAPatch.sigma_eig-504"><span class="linenos">504</span></a>
</span><span id="IGAPatch.sigma_eig-505"><a href="#IGAPatch.sigma_eig-505"><span class="linenos">505</span></a><span class="sd">        The stress tensor is first converted from Voigt notation to</span>
</span><span id="IGAPatch.sigma_eig-506"><a href="#IGAPatch.sigma_eig-506"><span class="linenos">506</span></a><span class="sd">        full 3x3 tensors before computing eigenvalues.</span>
</span><span id="IGAPatch.sigma_eig-507"><a href="#IGAPatch.sigma_eig-507"><span class="linenos">507</span></a>
</span><span id="IGAPatch.sigma_eig-508"><a href="#IGAPatch.sigma_eig-508"><span class="linenos">508</span></a><span class="sd">        Parameters</span>
</span><span id="IGAPatch.sigma_eig-509"><a href="#IGAPatch.sigma_eig-509"><span class="linenos">509</span></a><span class="sd">        ----------</span>
</span><span id="IGAPatch.sigma_eig-510"><a href="#IGAPatch.sigma_eig-510"><span class="linenos">510</span></a><span class="sd">        sig : np.ndarray[np.floating]</span>
</span><span id="IGAPatch.sigma_eig-511"><a href="#IGAPatch.sigma_eig-511"><span class="linenos">511</span></a><span class="sd">            Stress tensor in Voigt notation, shape (6, n_param_pts).</span>
</span><span id="IGAPatch.sigma_eig-512"><a href="#IGAPatch.sigma_eig-512"><span class="linenos">512</span></a>
</span><span id="IGAPatch.sigma_eig-513"><a href="#IGAPatch.sigma_eig-513"><span class="linenos">513</span></a><span class="sd">        Returns</span>
</span><span id="IGAPatch.sigma_eig-514"><a href="#IGAPatch.sigma_eig-514"><span class="linenos">514</span></a><span class="sd">        -------</span>
</span><span id="IGAPatch.sigma_eig-515"><a href="#IGAPatch.sigma_eig-515"><span class="linenos">515</span></a><span class="sd">        sig_eig : np.ndarray[np.floating]</span>
</span><span id="IGAPatch.sigma_eig-516"><a href="#IGAPatch.sigma_eig-516"><span class="linenos">516</span></a><span class="sd">            Principal stresses (eigenvalues) of shape (n_param_pts, 3),</span>
</span><span id="IGAPatch.sigma_eig-517"><a href="#IGAPatch.sigma_eig-517"><span class="linenos">517</span></a><span class="sd">            sorted by magnitude.</span>
</span><span id="IGAPatch.sigma_eig-518"><a href="#IGAPatch.sigma_eig-518"><span class="linenos">518</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatch.sigma_eig-519"><a href="#IGAPatch.sigma_eig-519"><span class="linenos">519</span></a>        <span class="n">sig</span> <span class="o">=</span> <span class="n">sig</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])]</span>
</span><span id="IGAPatch.sigma_eig-520"><a href="#IGAPatch.sigma_eig-520"><span class="linenos">520</span></a>        <span class="n">sig_eig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvalsh</span><span class="p">(</span><span class="n">sig</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span><span class="o">.</span><span class="n">T</span>
</span><span id="IGAPatch.sigma_eig-521"><a href="#IGAPatch.sigma_eig-521"><span class="linenos">521</span></a>        <span class="n">order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sig_eig</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="IGAPatch.sigma_eig-522"><a href="#IGAPatch.sigma_eig-522"><span class="linenos">522</span></a>        <span class="n">sig_eig</span> <span class="o">=</span> <span class="n">sig_eig</span><span class="p">[</span><span class="n">order</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">sig_eig</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="kc">None</span><span class="p">]]</span>
</span><span id="IGAPatch.sigma_eig-523"><a href="#IGAPatch.sigma_eig-523"><span class="linenos">523</span></a>        <span class="k">return</span> <span class="n">sig_eig</span>
</span></pre></div>


            <div class="docstring"><p>Compute the principal stresses (eigenvalues of the stress tensor)
at the specified parametric points.</p>

<p>The stress tensor is first converted from Voigt notation to
full 3x3 tensors before computing eigenvalues.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>sig</strong> (np.ndarray[np.floating]):
Stress tensor in Voigt notation, shape (6, n_param_pts).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>sig_eig</strong> (np.ndarray[np.floating]):
Principal stresses (eigenvalues) of shape (n_param_pts, 3),
sorted by magnitude.</li>
</ul>
</div>


                            </div>
                            <div id="IGAPatch.von_mises" class="classattr">
                                        <input id="IGAPatch.von_mises-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">von_mises</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">sig_eig</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="IGAPatch.von_mises-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IGAPatch.von_mises"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IGAPatch.von_mises-525"><a href="#IGAPatch.von_mises-525"><span class="linenos">525</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">von_mises</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig_eig</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]:</span>
</span><span id="IGAPatch.von_mises-526"><a href="#IGAPatch.von_mises-526"><span class="linenos">526</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatch.von_mises-527"><a href="#IGAPatch.von_mises-527"><span class="linenos">527</span></a><span class="sd">        Compute the von Mises equivalent stress at the specified parametric points.</span>
</span><span id="IGAPatch.von_mises-528"><a href="#IGAPatch.von_mises-528"><span class="linenos">528</span></a>
</span><span id="IGAPatch.von_mises-529"><a href="#IGAPatch.von_mises-529"><span class="linenos">529</span></a><span class="sd">        The von Mises stress is computed from the principal stresses (eigenvalues</span>
</span><span id="IGAPatch.von_mises-530"><a href="#IGAPatch.von_mises-530"><span class="linenos">530</span></a><span class="sd">        of the stress tensor) as a scalar measure of the deviatoric stress.</span>
</span><span id="IGAPatch.von_mises-531"><a href="#IGAPatch.von_mises-531"><span class="linenos">531</span></a>
</span><span id="IGAPatch.von_mises-532"><a href="#IGAPatch.von_mises-532"><span class="linenos">532</span></a><span class="sd">        Parameters</span>
</span><span id="IGAPatch.von_mises-533"><a href="#IGAPatch.von_mises-533"><span class="linenos">533</span></a><span class="sd">        ----------</span>
</span><span id="IGAPatch.von_mises-534"><a href="#IGAPatch.von_mises-534"><span class="linenos">534</span></a><span class="sd">        sig_eig : np.ndarray[np.floating]</span>
</span><span id="IGAPatch.von_mises-535"><a href="#IGAPatch.von_mises-535"><span class="linenos">535</span></a><span class="sd">            Principal stresses (eigenvalues) of shape (n_param_pts, 3),</span>
</span><span id="IGAPatch.von_mises-536"><a href="#IGAPatch.von_mises-536"><span class="linenos">536</span></a><span class="sd">            sorted by magnitude.</span>
</span><span id="IGAPatch.von_mises-537"><a href="#IGAPatch.von_mises-537"><span class="linenos">537</span></a>
</span><span id="IGAPatch.von_mises-538"><a href="#IGAPatch.von_mises-538"><span class="linenos">538</span></a><span class="sd">        Returns</span>
</span><span id="IGAPatch.von_mises-539"><a href="#IGAPatch.von_mises-539"><span class="linenos">539</span></a><span class="sd">        -------</span>
</span><span id="IGAPatch.von_mises-540"><a href="#IGAPatch.von_mises-540"><span class="linenos">540</span></a><span class="sd">        vm : np.ndarray[np.floating]</span>
</span><span id="IGAPatch.von_mises-541"><a href="#IGAPatch.von_mises-541"><span class="linenos">541</span></a><span class="sd">            Von Mises stress at each parametric point, shape (n_param_pts,).</span>
</span><span id="IGAPatch.von_mises-542"><a href="#IGAPatch.von_mises-542"><span class="linenos">542</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatch.von_mises-543"><a href="#IGAPatch.von_mises-543"><span class="linenos">543</span></a>        <span class="n">vm</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
</span><span id="IGAPatch.von_mises-544"><a href="#IGAPatch.von_mises-544"><span class="linenos">544</span></a>            <span class="n">sig_eig</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">sig_eig</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
</span><span id="IGAPatch.von_mises-545"><a href="#IGAPatch.von_mises-545"><span class="linenos">545</span></a>        <span class="p">)</span>
</span><span id="IGAPatch.von_mises-546"><a href="#IGAPatch.von_mises-546"><span class="linenos">546</span></a>        <span class="k">return</span> <span class="n">vm</span>
</span></pre></div>


            <div class="docstring"><p>Compute the von Mises equivalent stress at the specified parametric points.</p>

<p>The von Mises stress is computed from the principal stresses (eigenvalues
of the stress tensor) as a scalar measure of the deviatoric stress.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>sig_eig</strong> (np.ndarray[np.floating]):
Principal stresses (eigenvalues) of shape (n_param_pts, 3),
sorted by magnitude.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>vm</strong> (np.ndarray[np.floating]):
Von Mises stress at each parametric point, shape (n_param_pts,).</li>
</ul>
</div>


                            </div>
                            <div id="IGAPatch.save_paraview" class="classattr">
                                        <input id="IGAPatch.save_paraview-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save_paraview</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">U</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>,</span><span class="param">	<span class="n">path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="IGAPatch.save_paraview-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IGAPatch.save_paraview"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IGAPatch.save_paraview-548"><a href="#IGAPatch.save_paraview-548"><span class="linenos">548</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_paraview</span><span class="p">(</span>
</span><span id="IGAPatch.save_paraview-549"><a href="#IGAPatch.save_paraview-549"><span class="linenos">549</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="IGAPatch.save_paraview-550"><a href="#IGAPatch.save_paraview-550"><span class="linenos">550</span></a>        <span class="n">U</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span>
</span><span id="IGAPatch.save_paraview-551"><a href="#IGAPatch.save_paraview-551"><span class="linenos">551</span></a>        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="IGAPatch.save_paraview-552"><a href="#IGAPatch.save_paraview-552"><span class="linenos">552</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="IGAPatch.save_paraview-553"><a href="#IGAPatch.save_paraview-553"><span class="linenos">553</span></a>        <span class="n">n_eval_per_elem</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="IGAPatch.save_paraview-554"><a href="#IGAPatch.save_paraview-554"><span class="linenos">554</span></a>    <span class="p">):</span>
</span><span id="IGAPatch.save_paraview-555"><a href="#IGAPatch.save_paraview-555"><span class="linenos">555</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatch.save_paraview-556"><a href="#IGAPatch.save_paraview-556"><span class="linenos">556</span></a><span class="sd">        Export the patch data to a ParaView-readable format.</span>
</span><span id="IGAPatch.save_paraview-557"><a href="#IGAPatch.save_paraview-557"><span class="linenos">557</span></a>
</span><span id="IGAPatch.save_paraview-558"><a href="#IGAPatch.save_paraview-558"><span class="linenos">558</span></a><span class="sd">        The saved data includes the displacement field and derived fields</span>
</span><span id="IGAPatch.save_paraview-559"><a href="#IGAPatch.save_paraview-559"><span class="linenos">559</span></a><span class="sd">        (strain, stress, principal stresses, von Mises stress) for visualization.</span>
</span><span id="IGAPatch.save_paraview-560"><a href="#IGAPatch.save_paraview-560"><span class="linenos">560</span></a>
</span><span id="IGAPatch.save_paraview-561"><a href="#IGAPatch.save_paraview-561"><span class="linenos">561</span></a><span class="sd">        Parameters</span>
</span><span id="IGAPatch.save_paraview-562"><a href="#IGAPatch.save_paraview-562"><span class="linenos">562</span></a><span class="sd">        ----------</span>
</span><span id="IGAPatch.save_paraview-563"><a href="#IGAPatch.save_paraview-563"><span class="linenos">563</span></a><span class="sd">        U : np.ndarray[np.floating]</span>
</span><span id="IGAPatch.save_paraview-564"><a href="#IGAPatch.save_paraview-564"><span class="linenos">564</span></a><span class="sd">            Displacement field, shape (3, nb_ctrl_pts), with physical coordinates first.</span>
</span><span id="IGAPatch.save_paraview-565"><a href="#IGAPatch.save_paraview-565"><span class="linenos">565</span></a><span class="sd">        path : str</span>
</span><span id="IGAPatch.save_paraview-566"><a href="#IGAPatch.save_paraview-566"><span class="linenos">566</span></a><span class="sd">            Directory path where the ParaView file will be saved.</span>
</span><span id="IGAPatch.save_paraview-567"><a href="#IGAPatch.save_paraview-567"><span class="linenos">567</span></a><span class="sd">        name : str</span>
</span><span id="IGAPatch.save_paraview-568"><a href="#IGAPatch.save_paraview-568"><span class="linenos">568</span></a><span class="sd">            Base name of the saved file.</span>
</span><span id="IGAPatch.save_paraview-569"><a href="#IGAPatch.save_paraview-569"><span class="linenos">569</span></a><span class="sd">        n_eval_per_elem : int, optional</span>
</span><span id="IGAPatch.save_paraview-570"><a href="#IGAPatch.save_paraview-570"><span class="linenos">570</span></a><span class="sd">            Number of evaluation points per element in each parametric direction</span>
</span><span id="IGAPatch.save_paraview-571"><a href="#IGAPatch.save_paraview-571"><span class="linenos">571</span></a><span class="sd">            (higher values produce smoother visualizations). Default is 10.</span>
</span><span id="IGAPatch.save_paraview-572"><a href="#IGAPatch.save_paraview-572"><span class="linenos">572</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatch.save_paraview-573"><a href="#IGAPatch.save_paraview-573"><span class="linenos">573</span></a>        <span class="n">XI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">n_eval_per_elem</span><span class="o">=</span><span class="n">n_eval_per_elem</span><span class="p">)</span>
</span><span id="IGAPatch.save_paraview-574"><a href="#IGAPatch.save_paraview-574"><span class="linenos">574</span></a>        <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_paraview_fields</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">XI</span><span class="p">)</span>
</span><span id="IGAPatch.save_paraview-575"><a href="#IGAPatch.save_paraview-575"><span class="linenos">575</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">saveParaview</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">XI</span><span class="o">=</span><span class="n">XI</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Export the patch data to a ParaView-readable format.</p>

<p>The saved data includes the displacement field and derived fields
(strain, stress, principal stresses, von Mises stress) for visualization.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>U</strong> (np.ndarray[np.floating]):
Displacement field, shape (3, nb_ctrl_pts), with physical coordinates first.</li>
<li><strong>path</strong> (str):
Directory path where the ParaView file will be saved.</li>
<li><strong>name</strong> (str):
Base name of the saved file.</li>
<li><strong>n_eval_per_elem</strong> (int, optional):
Number of evaluation points per element in each parametric direction
(higher values produce smoother visualizations). Default is 10.</li>
</ul>
</div>


                            </div>
                            <div id="IGAPatch.make_paraview_fields" class="classattr">
                                        <input id="IGAPatch.make_paraview_fields-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">make_paraview_fields</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">U</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>,</span><span class="param">	<span class="n">XI</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="IGAPatch.make_paraview_fields-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IGAPatch.make_paraview_fields"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IGAPatch.make_paraview_fields-577"><a href="#IGAPatch.make_paraview_fields-577"><span class="linenos">577</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">make_paraview_fields</span><span class="p">(</span>
</span><span id="IGAPatch.make_paraview_fields-578"><a href="#IGAPatch.make_paraview_fields-578"><span class="linenos">578</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">U</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="n">XI</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]]</span>
</span><span id="IGAPatch.make_paraview_fields-579"><a href="#IGAPatch.make_paraview_fields-579"><span class="linenos">579</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]]:</span>
</span><span id="IGAPatch.make_paraview_fields-580"><a href="#IGAPatch.make_paraview_fields-580"><span class="linenos">580</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatch.make_paraview_fields-581"><a href="#IGAPatch.make_paraview_fields-581"><span class="linenos">581</span></a><span class="sd">        Generate fields for visualization in ParaView from the displacement field.</span>
</span><span id="IGAPatch.make_paraview_fields-582"><a href="#IGAPatch.make_paraview_fields-582"><span class="linenos">582</span></a>
</span><span id="IGAPatch.make_paraview_fields-583"><a href="#IGAPatch.make_paraview_fields-583"><span class="linenos">583</span></a><span class="sd">        This function computes the following fields:</span>
</span><span id="IGAPatch.make_paraview_fields-584"><a href="#IGAPatch.make_paraview_fields-584"><span class="linenos">584</span></a><span class="sd">            - Displacement `U`</span>
</span><span id="IGAPatch.make_paraview_fields-585"><a href="#IGAPatch.make_paraview_fields-585"><span class="linenos">585</span></a><span class="sd">            - Strain tensor `epsilon` in Voigt notation</span>
</span><span id="IGAPatch.make_paraview_fields-586"><a href="#IGAPatch.make_paraview_fields-586"><span class="linenos">586</span></a><span class="sd">            - Stress tensor `sigma` in Voigt notation</span>
</span><span id="IGAPatch.make_paraview_fields-587"><a href="#IGAPatch.make_paraview_fields-587"><span class="linenos">587</span></a><span class="sd">            - Principal stresses `sigma_eig`</span>
</span><span id="IGAPatch.make_paraview_fields-588"><a href="#IGAPatch.make_paraview_fields-588"><span class="linenos">588</span></a><span class="sd">            - Von Mises stress `von_mises`</span>
</span><span id="IGAPatch.make_paraview_fields-589"><a href="#IGAPatch.make_paraview_fields-589"><span class="linenos">589</span></a>
</span><span id="IGAPatch.make_paraview_fields-590"><a href="#IGAPatch.make_paraview_fields-590"><span class="linenos">590</span></a><span class="sd">        The resulting arrays are reshaped to match the expected ParaView format:</span>
</span><span id="IGAPatch.make_paraview_fields-591"><a href="#IGAPatch.make_paraview_fields-591"><span class="linenos">591</span></a><span class="sd">            - The first dimension is for potential time/step (here 1)</span>
</span><span id="IGAPatch.make_paraview_fields-592"><a href="#IGAPatch.make_paraview_fields-592"><span class="linenos">592</span></a><span class="sd">            - Subsequent dimensions correspond to physical or Voigt components,</span>
</span><span id="IGAPatch.make_paraview_fields-593"><a href="#IGAPatch.make_paraview_fields-593"><span class="linenos">593</span></a><span class="sd">            followed by the parametric grid shape defined by `XI`.</span>
</span><span id="IGAPatch.make_paraview_fields-594"><a href="#IGAPatch.make_paraview_fields-594"><span class="linenos">594</span></a>
</span><span id="IGAPatch.make_paraview_fields-595"><a href="#IGAPatch.make_paraview_fields-595"><span class="linenos">595</span></a><span class="sd">        Parameters</span>
</span><span id="IGAPatch.make_paraview_fields-596"><a href="#IGAPatch.make_paraview_fields-596"><span class="linenos">596</span></a><span class="sd">        ----------</span>
</span><span id="IGAPatch.make_paraview_fields-597"><a href="#IGAPatch.make_paraview_fields-597"><span class="linenos">597</span></a><span class="sd">        U : np.ndarray[np.floating]</span>
</span><span id="IGAPatch.make_paraview_fields-598"><a href="#IGAPatch.make_paraview_fields-598"><span class="linenos">598</span></a><span class="sd">            Displacement field of shape (3, nb_ctrl_pts), with the first dimension</span>
</span><span id="IGAPatch.make_paraview_fields-599"><a href="#IGAPatch.make_paraview_fields-599"><span class="linenos">599</span></a><span class="sd">            corresponding to physical coordinates (x, y, z).</span>
</span><span id="IGAPatch.make_paraview_fields-600"><a href="#IGAPatch.make_paraview_fields-600"><span class="linenos">600</span></a><span class="sd">        XI : list[np.ndarray[np.floating]]</span>
</span><span id="IGAPatch.make_paraview_fields-601"><a href="#IGAPatch.make_paraview_fields-601"><span class="linenos">601</span></a><span class="sd">            List of parametric coordinates for each direction [xi, eta, zeta].</span>
</span><span id="IGAPatch.make_paraview_fields-602"><a href="#IGAPatch.make_paraview_fields-602"><span class="linenos">602</span></a><span class="sd">            Determines the evaluation grid for the derived fields.</span>
</span><span id="IGAPatch.make_paraview_fields-603"><a href="#IGAPatch.make_paraview_fields-603"><span class="linenos">603</span></a>
</span><span id="IGAPatch.make_paraview_fields-604"><a href="#IGAPatch.make_paraview_fields-604"><span class="linenos">604</span></a><span class="sd">        Returns</span>
</span><span id="IGAPatch.make_paraview_fields-605"><a href="#IGAPatch.make_paraview_fields-605"><span class="linenos">605</span></a><span class="sd">        -------</span>
</span><span id="IGAPatch.make_paraview_fields-606"><a href="#IGAPatch.make_paraview_fields-606"><span class="linenos">606</span></a><span class="sd">        fields : dict[str, np.ndarray[np.floating]]</span>
</span><span id="IGAPatch.make_paraview_fields-607"><a href="#IGAPatch.make_paraview_fields-607"><span class="linenos">607</span></a><span class="sd">            Dictionary of fields ready for ParaView, with the following shapes:</span>
</span><span id="IGAPatch.make_paraview_fields-608"><a href="#IGAPatch.make_paraview_fields-608"><span class="linenos">608</span></a><span class="sd">                - &quot;U&quot; : shape (1, 3, nxi, neta, nzeta)</span>
</span><span id="IGAPatch.make_paraview_fields-609"><a href="#IGAPatch.make_paraview_fields-609"><span class="linenos">609</span></a><span class="sd">                - &quot;epsilon&quot; : shape (1, 6, nxi, neta, nzeta)</span>
</span><span id="IGAPatch.make_paraview_fields-610"><a href="#IGAPatch.make_paraview_fields-610"><span class="linenos">610</span></a><span class="sd">                - &quot;sigma&quot; : shape (1, 6, nxi, neta, nzeta)</span>
</span><span id="IGAPatch.make_paraview_fields-611"><a href="#IGAPatch.make_paraview_fields-611"><span class="linenos">611</span></a><span class="sd">                - &quot;sigma_eig&quot; : shape (1, 3, nxi, neta, nzeta)</span>
</span><span id="IGAPatch.make_paraview_fields-612"><a href="#IGAPatch.make_paraview_fields-612"><span class="linenos">612</span></a><span class="sd">                - &quot;von_mises&quot; : shape (1, 1, nxi, neta, nzeta)</span>
</span><span id="IGAPatch.make_paraview_fields-613"><a href="#IGAPatch.make_paraview_fields-613"><span class="linenos">613</span></a><span class="sd">            where (nxi, neta, nzeta) = tuple(xi.size for xi in XI)</span>
</span><span id="IGAPatch.make_paraview_fields-614"><a href="#IGAPatch.make_paraview_fields-614"><span class="linenos">614</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatch.make_paraview_fields-615"><a href="#IGAPatch.make_paraview_fields-615"><span class="linenos">615</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="IGAPatch.make_paraview_fields-616"><a href="#IGAPatch.make_paraview_fields-616"><span class="linenos">616</span></a>        <span class="n">epsilon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">XI</span><span class="p">)</span>
</span><span id="IGAPatch.make_paraview_fields-617"><a href="#IGAPatch.make_paraview_fields-617"><span class="linenos">617</span></a>        <span class="n">sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">(</span><span class="n">epsilon</span><span class="p">)</span>
</span><span id="IGAPatch.make_paraview_fields-618"><a href="#IGAPatch.make_paraview_fields-618"><span class="linenos">618</span></a>        <span class="n">sigma_eig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_eig</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span>
</span><span id="IGAPatch.make_paraview_fields-619"><a href="#IGAPatch.make_paraview_fields-619"><span class="linenos">619</span></a>        <span class="n">von_mises</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">von_mises</span><span class="p">(</span><span class="n">sigma_eig</span><span class="p">)</span>
</span><span id="IGAPatch.make_paraview_fields-620"><a href="#IGAPatch.make_paraview_fields-620"><span class="linenos">620</span></a>        <span class="n">XI_shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">xi</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">XI</span><span class="p">)</span>
</span><span id="IGAPatch.make_paraview_fields-621"><a href="#IGAPatch.make_paraview_fields-621"><span class="linenos">621</span></a>        <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="IGAPatch.make_paraview_fields-622"><a href="#IGAPatch.make_paraview_fields-622"><span class="linenos">622</span></a>            <span class="s2">&quot;U&quot;</span><span class="p">:</span> <span class="n">u</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span>
</span><span id="IGAPatch.make_paraview_fields-623"><a href="#IGAPatch.make_paraview_fields-623"><span class="linenos">623</span></a>            <span class="s2">&quot;epsilon&quot;</span><span class="p">:</span> <span class="n">epsilon</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="n">XI_shape</span><span class="p">)),</span>
</span><span id="IGAPatch.make_paraview_fields-624"><a href="#IGAPatch.make_paraview_fields-624"><span class="linenos">624</span></a>            <span class="s2">&quot;sigma&quot;</span><span class="p">:</span> <span class="n">sigma</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="n">XI_shape</span><span class="p">)),</span>
</span><span id="IGAPatch.make_paraview_fields-625"><a href="#IGAPatch.make_paraview_fields-625"><span class="linenos">625</span></a>            <span class="s2">&quot;sigma_eig&quot;</span><span class="p">:</span> <span class="n">sigma_eig</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">*</span><span class="n">XI_shape</span><span class="p">)),</span>
</span><span id="IGAPatch.make_paraview_fields-626"><a href="#IGAPatch.make_paraview_fields-626"><span class="linenos">626</span></a>            <span class="s2">&quot;von_mises&quot;</span><span class="p">:</span> <span class="n">von_mises</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">XI_shape</span><span class="p">)),</span>
</span><span id="IGAPatch.make_paraview_fields-627"><a href="#IGAPatch.make_paraview_fields-627"><span class="linenos">627</span></a>        <span class="p">}</span>
</span><span id="IGAPatch.make_paraview_fields-628"><a href="#IGAPatch.make_paraview_fields-628"><span class="linenos">628</span></a>        <span class="k">return</span> <span class="n">fields</span>
</span></pre></div>


            <div class="docstring"><p>Generate fields for visualization in ParaView from the displacement field.</p>

<p>This function computes the following fields:
    - Displacement <code>U</code>
    - Strain tensor <code><a href="#IGAPatch.epsilon">epsilon</a></code> in Voigt notation
    - Stress tensor <code><a href="#IGAPatch.sigma">sigma</a></code> in Voigt notation
    - Principal stresses <code><a href="#IGAPatch.sigma_eig">sigma_eig</a></code>
    - Von Mises stress <code><a href="#IGAPatch.von_mises">von_mises</a></code></p>

<p>The resulting arrays are reshaped to match the expected ParaView format:
    - The first dimension is for potential time/step (here 1)
    - Subsequent dimensions correspond to physical or Voigt components,
    followed by the parametric grid shape defined by <code>XI</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>U</strong> (np.ndarray[np.floating]):
Displacement field of shape (3, nb_ctrl_pts), with the first dimension
corresponding to physical coordinates (x, y, z).</li>
<li><strong>XI</strong> (list[np.ndarray[np.floating]]):
List of parametric coordinates for each direction [xi, eta, zeta].
Determines the evaluation grid for the derived fields.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>fields</strong> (dict[str, np.ndarray[np.floating]]):
Dictionary of fields ready for ParaView, with the following shapes:
    - "U" : shape (1, 3, nxi, neta, nzeta)
    - "epsilon" : shape (1, 6, nxi, neta, nzeta)
    - "sigma" : shape (1, 6, nxi, neta, nzeta)
    - "sigma_eig" : shape (1, 3, nxi, neta, nzeta)
    - "von_mises" : shape (1, 1, nxi, neta, nzeta)
where (nxi, neta, nzeta) = tuple(xi.size for xi in XI)</li>
</ul>
</div>


                            </div>
                </section>
                <section id="IGAPatchDensity">
                            <input id="IGAPatchDensity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">IGAPatchDensity</span><wbr>(<span class="base"><a href="#IGAPatch">IGAPatch</a></span>):

                <label class="view-source-button" for="IGAPatchDensity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IGAPatchDensity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IGAPatchDensity-631"><a href="#IGAPatchDensity-631"><span class="linenos">631</span></a><span class="k">class</span><span class="w"> </span><span class="nc">IGAPatchDensity</span><span class="p">(</span><span class="n">IGAPatch</span><span class="p">):</span>
</span><span id="IGAPatchDensity-632"><a href="#IGAPatchDensity-632"><span class="linenos">632</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatchDensity-633"><a href="#IGAPatchDensity-633"><span class="linenos">633</span></a><span class="sd">    Density-weighted representation of a 3D B-spline patch for linear elasticity.</span>
</span><span id="IGAPatchDensity-634"><a href="#IGAPatchDensity-634"><span class="linenos">634</span></a>
</span><span id="IGAPatchDensity-635"><a href="#IGAPatchDensity-635"><span class="linenos">635</span></a><span class="sd">    This class extends :py:class:`IGAPatch` by allowing a spatially varying</span>
</span><span id="IGAPatchDensity-636"><a href="#IGAPatchDensity-636"><span class="linenos">636</span></a><span class="sd">    material density. The density field is defined at the control points and</span>
</span><span id="IGAPatchDensity-637"><a href="#IGAPatchDensity-637"><span class="linenos">637</span></a><span class="sd">    interpolated over the parametric domain, scaling the constitutive matrix locally</span>
</span><span id="IGAPatchDensity-638"><a href="#IGAPatchDensity-638"><span class="linenos">638</span></a><span class="sd">    for both stiffness assembly and stress evaluation.</span>
</span><span id="IGAPatchDensity-639"><a href="#IGAPatchDensity-639"><span class="linenos">639</span></a>
</span><span id="IGAPatchDensity-640"><a href="#IGAPatchDensity-640"><span class="linenos">640</span></a><span class="sd">    IGAPatchDensity is intended as a component of a multipatch problem and is</span>
</span><span id="IGAPatchDensity-641"><a href="#IGAPatchDensity-641"><span class="linenos">641</span></a><span class="sd">    not a standalone solver. Typically, objects of this class are managed by a</span>
</span><span id="IGAPatchDensity-642"><a href="#IGAPatchDensity-642"><span class="linenos">642</span></a><span class="sd">    `ProblemIGA` instance that assembles multiple patches, enforces Dirichlet</span>
</span><span id="IGAPatchDensity-643"><a href="#IGAPatchDensity-643"><span class="linenos">643</span></a><span class="sd">    constraints, and solves the global elasticity problem.</span>
</span><span id="IGAPatchDensity-644"><a href="#IGAPatchDensity-644"><span class="linenos">644</span></a>
</span><span id="IGAPatchDensity-645"><a href="#IGAPatchDensity-645"><span class="linenos">645</span></a><span class="sd">    Features provided by IGAPatchDensity include:</span>
</span><span id="IGAPatchDensity-646"><a href="#IGAPatchDensity-646"><span class="linenos">646</span></a><span class="sd">        - computation of the Jacobian and its determinant,</span>
</span><span id="IGAPatchDensity-647"><a href="#IGAPatchDensity-647"><span class="linenos">647</span></a><span class="sd">        - gradients of shape functions in physical space,</span>
</span><span id="IGAPatchDensity-648"><a href="#IGAPatchDensity-648"><span class="linenos">648</span></a><span class="sd">        - density-weighted linear elastic stiffness matrix assembly,</span>
</span><span id="IGAPatchDensity-649"><a href="#IGAPatchDensity-649"><span class="linenos">649</span></a><span class="sd">        - evaluation of prescribed surface forces,</span>
</span><span id="IGAPatchDensity-650"><a href="#IGAPatchDensity-650"><span class="linenos">650</span></a><span class="sd">        - post-processing quantities such as displacement, strain, stress,</span>
</span><span id="IGAPatchDensity-651"><a href="#IGAPatchDensity-651"><span class="linenos">651</span></a><span class="sd">        principal stresses, von Mises stress, and local density,</span>
</span><span id="IGAPatchDensity-652"><a href="#IGAPatchDensity-652"><span class="linenos">652</span></a><span class="sd">        - export of results to visualization tools (e.g., ParaView).</span>
</span><span id="IGAPatchDensity-653"><a href="#IGAPatchDensity-653"><span class="linenos">653</span></a>
</span><span id="IGAPatchDensity-654"><a href="#IGAPatchDensity-654"><span class="linenos">654</span></a><span class="sd">    Attributes</span>
</span><span id="IGAPatchDensity-655"><a href="#IGAPatchDensity-655"><span class="linenos">655</span></a><span class="sd">    ----------</span>
</span><span id="IGAPatchDensity-656"><a href="#IGAPatchDensity-656"><span class="linenos">656</span></a><span class="sd">    spline : BSpline</span>
</span><span id="IGAPatchDensity-657"><a href="#IGAPatchDensity-657"><span class="linenos">657</span></a><span class="sd">        The 3D B-spline volume representing the patch geometry and shape functions.</span>
</span><span id="IGAPatchDensity-658"><a href="#IGAPatchDensity-658"><span class="linenos">658</span></a><span class="sd">    ctrl_pts : np.ndarray[np.floating]</span>
</span><span id="IGAPatchDensity-659"><a href="#IGAPatchDensity-659"><span class="linenos">659</span></a><span class="sd">        Array of control points of shape (3, n_xi, n_eta, n_zeta) defining the patch geometry.</span>
</span><span id="IGAPatchDensity-660"><a href="#IGAPatchDensity-660"><span class="linenos">660</span></a><span class="sd">    xi : np.ndarray[np.floating]</span>
</span><span id="IGAPatchDensity-661"><a href="#IGAPatchDensity-661"><span class="linenos">661</span></a><span class="sd">        Isoparametric integration points along the xi direction.</span>
</span><span id="IGAPatchDensity-662"><a href="#IGAPatchDensity-662"><span class="linenos">662</span></a><span class="sd">    dxi : np.ndarray[np.floating]</span>
</span><span id="IGAPatchDensity-663"><a href="#IGAPatchDensity-663"><span class="linenos">663</span></a><span class="sd">        Corresponding quadrature weights for xi.</span>
</span><span id="IGAPatchDensity-664"><a href="#IGAPatchDensity-664"><span class="linenos">664</span></a><span class="sd">    eta : np.ndarray[np.floating]</span>
</span><span id="IGAPatchDensity-665"><a href="#IGAPatchDensity-665"><span class="linenos">665</span></a><span class="sd">        Isoparametric integration points along the eta direction.</span>
</span><span id="IGAPatchDensity-666"><a href="#IGAPatchDensity-666"><span class="linenos">666</span></a><span class="sd">    deta : np.ndarray[np.floating]</span>
</span><span id="IGAPatchDensity-667"><a href="#IGAPatchDensity-667"><span class="linenos">667</span></a><span class="sd">        Corresponding quadrature weights for eta.</span>
</span><span id="IGAPatchDensity-668"><a href="#IGAPatchDensity-668"><span class="linenos">668</span></a><span class="sd">    zeta : np.ndarray[np.floating]</span>
</span><span id="IGAPatchDensity-669"><a href="#IGAPatchDensity-669"><span class="linenos">669</span></a><span class="sd">        Isoparametric integration points along the zeta direction.</span>
</span><span id="IGAPatchDensity-670"><a href="#IGAPatchDensity-670"><span class="linenos">670</span></a><span class="sd">    dzeta : np.ndarray[np.floating]</span>
</span><span id="IGAPatchDensity-671"><a href="#IGAPatchDensity-671"><span class="linenos">671</span></a><span class="sd">        Corresponding quadrature weights for zeta.</span>
</span><span id="IGAPatchDensity-672"><a href="#IGAPatchDensity-672"><span class="linenos">672</span></a><span class="sd">    F_N : np.ndarray[np.floating]</span>
</span><span id="IGAPatchDensity-673"><a href="#IGAPatchDensity-673"><span class="linenos">673</span></a><span class="sd">        Prescribed surface forces, shape (3 (direction), 2 (side: front/back), 3 (physical components)),</span>
</span><span id="IGAPatchDensity-674"><a href="#IGAPatchDensity-674"><span class="linenos">674</span></a><span class="sd">        used for computing the right-hand side vector.</span>
</span><span id="IGAPatchDensity-675"><a href="#IGAPatchDensity-675"><span class="linenos">675</span></a><span class="sd">    H : np.ndarray[np.floating]</span>
</span><span id="IGAPatchDensity-676"><a href="#IGAPatchDensity-676"><span class="linenos">676</span></a><span class="sd">        Constitutive matrix in Voigt notation (6x6) for linear isotropic elasticity.</span>
</span><span id="IGAPatchDensity-677"><a href="#IGAPatchDensity-677"><span class="linenos">677</span></a><span class="sd">        Defined from `E` and `nu`.</span>
</span><span id="IGAPatchDensity-678"><a href="#IGAPatchDensity-678"><span class="linenos">678</span></a><span class="sd">    d : np.ndarray[np.floating]</span>
</span><span id="IGAPatchDensity-679"><a href="#IGAPatchDensity-679"><span class="linenos">679</span></a><span class="sd">        Density field expressed in the B-spline basis, used to scale the</span>
</span><span id="IGAPatchDensity-680"><a href="#IGAPatchDensity-680"><span class="linenos">680</span></a><span class="sd">        constitutive matrix locally. At evaluation, values are clipped to [0, 1].</span>
</span><span id="IGAPatchDensity-681"><a href="#IGAPatchDensity-681"><span class="linenos">681</span></a>
</span><span id="IGAPatchDensity-682"><a href="#IGAPatchDensity-682"><span class="linenos">682</span></a><span class="sd">    Notes</span>
</span><span id="IGAPatchDensity-683"><a href="#IGAPatchDensity-683"><span class="linenos">683</span></a><span class="sd">    -----</span>
</span><span id="IGAPatchDensity-684"><a href="#IGAPatchDensity-684"><span class="linenos">684</span></a><span class="sd">    - All integration points are generated using Gaussian quadrature with a number</span>
</span><span id="IGAPatchDensity-685"><a href="#IGAPatchDensity-685"><span class="linenos">685</span></a><span class="sd">    of points determined from the spline degree.</span>
</span><span id="IGAPatchDensity-686"><a href="#IGAPatchDensity-686"><span class="linenos">686</span></a><span class="sd">    - The density field modifies the stiffness and stress at each integration point.</span>
</span><span id="IGAPatchDensity-687"><a href="#IGAPatchDensity-687"><span class="linenos">687</span></a><span class="sd">    - This class does not handle multipatch connectivity or global constraints.</span>
</span><span id="IGAPatchDensity-688"><a href="#IGAPatchDensity-688"><span class="linenos">688</span></a><span class="sd">    Use `ProblemIGA` to assemble and solve multipatch problems.</span>
</span><span id="IGAPatchDensity-689"><a href="#IGAPatchDensity-689"><span class="linenos">689</span></a><span class="sd">    - Post-processing quantities can be evaluated at the integration points or exported</span>
</span><span id="IGAPatchDensity-690"><a href="#IGAPatchDensity-690"><span class="linenos">690</span></a><span class="sd">    to visualization tools like ParaView.</span>
</span><span id="IGAPatchDensity-691"><a href="#IGAPatchDensity-691"><span class="linenos">691</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="IGAPatchDensity-692"><a href="#IGAPatchDensity-692"><span class="linenos">692</span></a>
</span><span id="IGAPatchDensity-693"><a href="#IGAPatchDensity-693"><span class="linenos">693</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="IGAPatchDensity-694"><a href="#IGAPatchDensity-694"><span class="linenos">694</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="IGAPatchDensity-695"><a href="#IGAPatchDensity-695"><span class="linenos">695</span></a>        <span class="n">spline</span><span class="p">:</span> <span class="n">BSpline</span><span class="p">,</span>
</span><span id="IGAPatchDensity-696"><a href="#IGAPatchDensity-696"><span class="linenos">696</span></a>        <span class="n">ctrl_pts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span>
</span><span id="IGAPatchDensity-697"><a href="#IGAPatchDensity-697"><span class="linenos">697</span></a>        <span class="n">E</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="IGAPatchDensity-698"><a href="#IGAPatchDensity-698"><span class="linenos">698</span></a>        <span class="n">nu</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="IGAPatchDensity-699"><a href="#IGAPatchDensity-699"><span class="linenos">699</span></a>        <span class="n">d</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span>
</span><span id="IGAPatchDensity-700"><a href="#IGAPatchDensity-700"><span class="linenos">700</span></a>        <span class="n">F_N</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">),</span>
</span><span id="IGAPatchDensity-701"><a href="#IGAPatchDensity-701"><span class="linenos">701</span></a>    <span class="p">):</span>
</span><span id="IGAPatchDensity-702"><a href="#IGAPatchDensity-702"><span class="linenos">702</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatchDensity-703"><a href="#IGAPatchDensity-703"><span class="linenos">703</span></a><span class="sd">        Initialize a density-weighted IGA patch.</span>
</span><span id="IGAPatchDensity-704"><a href="#IGAPatchDensity-704"><span class="linenos">704</span></a>
</span><span id="IGAPatchDensity-705"><a href="#IGAPatchDensity-705"><span class="linenos">705</span></a><span class="sd">        This constructor extends :py:meth:`IGAPatch.__init__` by introducing</span>
</span><span id="IGAPatchDensity-706"><a href="#IGAPatchDensity-706"><span class="linenos">706</span></a><span class="sd">        a control-point-based density field and by initializing Gaussian</span>
</span><span id="IGAPatchDensity-707"><a href="#IGAPatchDensity-707"><span class="linenos">707</span></a><span class="sd">        quadrature points for volumetric integration including the density field.</span>
</span><span id="IGAPatchDensity-708"><a href="#IGAPatchDensity-708"><span class="linenos">708</span></a>
</span><span id="IGAPatchDensity-709"><a href="#IGAPatchDensity-709"><span class="linenos">709</span></a><span class="sd">        The density field is reshaped to match the control point grid.</span>
</span><span id="IGAPatchDensity-710"><a href="#IGAPatchDensity-710"><span class="linenos">710</span></a>
</span><span id="IGAPatchDensity-711"><a href="#IGAPatchDensity-711"><span class="linenos">711</span></a><span class="sd">        Parameters</span>
</span><span id="IGAPatchDensity-712"><a href="#IGAPatchDensity-712"><span class="linenos">712</span></a><span class="sd">        ----------</span>
</span><span id="IGAPatchDensity-713"><a href="#IGAPatchDensity-713"><span class="linenos">713</span></a><span class="sd">        spline : BSpline</span>
</span><span id="IGAPatchDensity-714"><a href="#IGAPatchDensity-714"><span class="linenos">714</span></a><span class="sd">            B-spline volume defining the parametric domain.</span>
</span><span id="IGAPatchDensity-715"><a href="#IGAPatchDensity-715"><span class="linenos">715</span></a><span class="sd">        ctrl_pts : np.ndarray[np.floating]</span>
</span><span id="IGAPatchDensity-716"><a href="#IGAPatchDensity-716"><span class="linenos">716</span></a><span class="sd">            Control points defining the patch geometry.</span>
</span><span id="IGAPatchDensity-717"><a href="#IGAPatchDensity-717"><span class="linenos">717</span></a><span class="sd">        E : float</span>
</span><span id="IGAPatchDensity-718"><a href="#IGAPatchDensity-718"><span class="linenos">718</span></a><span class="sd">            Young&#39;s modulus of the material.</span>
</span><span id="IGAPatchDensity-719"><a href="#IGAPatchDensity-719"><span class="linenos">719</span></a><span class="sd">        nu : float</span>
</span><span id="IGAPatchDensity-720"><a href="#IGAPatchDensity-720"><span class="linenos">720</span></a><span class="sd">            Poisson&#39;s ratio of the material.</span>
</span><span id="IGAPatchDensity-721"><a href="#IGAPatchDensity-721"><span class="linenos">721</span></a><span class="sd">        d : np.ndarray[np.floating]</span>
</span><span id="IGAPatchDensity-722"><a href="#IGAPatchDensity-722"><span class="linenos">722</span></a><span class="sd">            Density field expressed in the B-spline basis.</span>
</span><span id="IGAPatchDensity-723"><a href="#IGAPatchDensity-723"><span class="linenos">723</span></a><span class="sd">            Evaluated density (N @ d) will be clipped to the range [0, 1].</span>
</span><span id="IGAPatchDensity-724"><a href="#IGAPatchDensity-724"><span class="linenos">724</span></a><span class="sd">        F_N : np.ndarray[np.floating], optional</span>
</span><span id="IGAPatchDensity-725"><a href="#IGAPatchDensity-725"><span class="linenos">725</span></a><span class="sd">            Surfacic Neumann forces applied on the patch boundaries.</span>
</span><span id="IGAPatchDensity-726"><a href="#IGAPatchDensity-726"><span class="linenos">726</span></a><span class="sd">            Shape: (3, 2, 3). Default is zero.</span>
</span><span id="IGAPatchDensity-727"><a href="#IGAPatchDensity-727"><span class="linenos">727</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatchDensity-728"><a href="#IGAPatchDensity-728"><span class="linenos">728</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">spline</span><span class="p">,</span> <span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">F_N</span><span class="p">)</span>
</span><span id="IGAPatchDensity-729"><a href="#IGAPatchDensity-729"><span class="linenos">729</span></a>        <span class="n">xi_eta_zeta_pts_pds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">gauss_legendre_for_integration</span><span class="p">(</span>
</span><span id="IGAPatchDensity-730"><a href="#IGAPatchDensity-730"><span class="linenos">730</span></a>            <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">getDegrees</span><span class="p">())</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="IGAPatchDensity-731"><a href="#IGAPatchDensity-731"><span class="linenos">731</span></a>        <span class="p">)</span>
</span><span id="IGAPatchDensity-732"><a href="#IGAPatchDensity-732"><span class="linenos">732</span></a>        <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeta</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dxi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dzeta</span><span class="p">))</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="IGAPatchDensity-733"><a href="#IGAPatchDensity-733"><span class="linenos">733</span></a>            <span class="n">xi_eta_zeta_pts_pds</span>
</span><span id="IGAPatchDensity-734"><a href="#IGAPatchDensity-734"><span class="linenos">734</span></a>        <span class="p">)</span>
</span><span id="IGAPatchDensity-735"><a href="#IGAPatchDensity-735"><span class="linenos">735</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="IGAPatchDensity-736"><a href="#IGAPatchDensity-736"><span class="linenos">736</span></a>
</span><span id="IGAPatchDensity-737"><a href="#IGAPatchDensity-737"><span class="linenos">737</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">stiffness</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">:</span>
</span><span id="IGAPatchDensity-738"><a href="#IGAPatchDensity-738"><span class="linenos">738</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatchDensity-739"><a href="#IGAPatchDensity-739"><span class="linenos">739</span></a><span class="sd">        Assemble the density-weighted stiffness matrix.</span>
</span><span id="IGAPatchDensity-740"><a href="#IGAPatchDensity-740"><span class="linenos">740</span></a>
</span><span id="IGAPatchDensity-741"><a href="#IGAPatchDensity-741"><span class="linenos">741</span></a><span class="sd">        This method follows the same formulation as</span>
</span><span id="IGAPatchDensity-742"><a href="#IGAPatchDensity-742"><span class="linenos">742</span></a><span class="sd">        :py:meth:`IGAPatch.stiffness`, but the constitutive matrix is scaled</span>
</span><span id="IGAPatchDensity-743"><a href="#IGAPatchDensity-743"><span class="linenos">743</span></a><span class="sd">        pointwise by the interpolated density field.</span>
</span><span id="IGAPatchDensity-744"><a href="#IGAPatchDensity-744"><span class="linenos">744</span></a>
</span><span id="IGAPatchDensity-745"><a href="#IGAPatchDensity-745"><span class="linenos">745</span></a><span class="sd">        At each integration point, the elasticity tensor is multiplied by</span>
</span><span id="IGAPatchDensity-746"><a href="#IGAPatchDensity-746"><span class="linenos">746</span></a><span class="sd">        the local density value, resulting in a spatially varying stiffness.</span>
</span><span id="IGAPatchDensity-747"><a href="#IGAPatchDensity-747"><span class="linenos">747</span></a>
</span><span id="IGAPatchDensity-748"><a href="#IGAPatchDensity-748"><span class="linenos">748</span></a><span class="sd">        Returns</span>
</span><span id="IGAPatchDensity-749"><a href="#IGAPatchDensity-749"><span class="linenos">749</span></a><span class="sd">        -------</span>
</span><span id="IGAPatchDensity-750"><a href="#IGAPatchDensity-750"><span class="linenos">750</span></a><span class="sd">        K : sps.spmatrix</span>
</span><span id="IGAPatchDensity-751"><a href="#IGAPatchDensity-751"><span class="linenos">751</span></a><span class="sd">            Sparse stiffness matrix of shape</span>
</span><span id="IGAPatchDensity-752"><a href="#IGAPatchDensity-752"><span class="linenos">752</span></a><span class="sd">            (3 * nb_ctrl_pts, 3 * nb_ctrl_pts).</span>
</span><span id="IGAPatchDensity-753"><a href="#IGAPatchDensity-753"><span class="linenos">753</span></a>
</span><span id="IGAPatchDensity-754"><a href="#IGAPatchDensity-754"><span class="linenos">754</span></a><span class="sd">        See Also</span>
</span><span id="IGAPatchDensity-755"><a href="#IGAPatchDensity-755"><span class="linenos">755</span></a><span class="sd">        --------</span>
</span><span id="IGAPatchDensity-756"><a href="#IGAPatchDensity-756"><span class="linenos">756</span></a><span class="sd">        IGAPatch.stiffness :</span>
</span><span id="IGAPatchDensity-757"><a href="#IGAPatchDensity-757"><span class="linenos">757</span></a><span class="sd">            Stiffness assembly without density weighting.</span>
</span><span id="IGAPatchDensity-758"><a href="#IGAPatchDensity-758"><span class="linenos">758</span></a><span class="sd">        IGAPatchDensity.density :</span>
</span><span id="IGAPatchDensity-759"><a href="#IGAPatchDensity-759"><span class="linenos">759</span></a><span class="sd">            Evaluation of the density field at parametric points.</span>
</span><span id="IGAPatchDensity-760"><a href="#IGAPatchDensity-760"><span class="linenos">760</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatchDensity-761"><a href="#IGAPatchDensity-761"><span class="linenos">761</span></a>        <span class="n">dN_dXI</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">DN</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeta</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="IGAPatchDensity-762"><a href="#IGAPatchDensity-762"><span class="linenos">762</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">Jinv</span><span class="p">,</span> <span class="n">detJ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jacobian</span><span class="p">(</span><span class="n">dN_dXI</span><span class="p">)</span>
</span><span id="IGAPatchDensity-763"><a href="#IGAPatchDensity-763"><span class="linenos">763</span></a>        <span class="n">dN_dx</span><span class="p">,</span> <span class="n">dN_dy</span><span class="p">,</span> <span class="n">dN_dz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grad_N</span><span class="p">(</span><span class="n">Jinv</span><span class="p">,</span> <span class="n">dN_dXI</span><span class="p">)</span>
</span><span id="IGAPatchDensity-764"><a href="#IGAPatchDensity-764"><span class="linenos">764</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_W</span><span class="p">(</span><span class="n">detJ</span><span class="p">)</span>
</span><span id="IGAPatchDensity-765"><a href="#IGAPatchDensity-765"><span class="linenos">765</span></a>        <span class="n">Z</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">coo_matrix</span><span class="p">(</span><span class="n">dN_dx</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
</span><span id="IGAPatchDensity-766"><a href="#IGAPatchDensity-766"><span class="linenos">766</span></a>        <span class="n">Bxx</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">dN_dx</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">Z</span><span class="p">))</span>
</span><span id="IGAPatchDensity-767"><a href="#IGAPatchDensity-767"><span class="linenos">767</span></a>        <span class="n">Byy</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Z</span><span class="p">,</span> <span class="n">dN_dy</span><span class="p">,</span> <span class="n">Z</span><span class="p">))</span>
</span><span id="IGAPatchDensity-768"><a href="#IGAPatchDensity-768"><span class="linenos">768</span></a>        <span class="n">Bzz</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Z</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">dN_dz</span><span class="p">))</span>
</span><span id="IGAPatchDensity-769"><a href="#IGAPatchDensity-769"><span class="linenos">769</span></a>        <span class="n">Bxy</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">dN_dy</span><span class="p">,</span> <span class="n">dN_dx</span><span class="p">,</span> <span class="n">Z</span><span class="p">))</span>
</span><span id="IGAPatchDensity-770"><a href="#IGAPatchDensity-770"><span class="linenos">770</span></a>        <span class="n">Byz</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Z</span><span class="p">,</span> <span class="n">dN_dz</span><span class="p">,</span> <span class="n">dN_dy</span><span class="p">))</span>
</span><span id="IGAPatchDensity-771"><a href="#IGAPatchDensity-771"><span class="linenos">771</span></a>        <span class="n">Bxz</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">dN_dz</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">dN_dx</span><span class="p">))</span>
</span><span id="IGAPatchDensity-772"><a href="#IGAPatchDensity-772"><span class="linenos">772</span></a>        <span class="n">H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">density</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeta</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
</span><span id="IGAPatchDensity-773"><a href="#IGAPatchDensity-773"><span class="linenos">773</span></a>            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="IGAPatchDensity-774"><a href="#IGAPatchDensity-774"><span class="linenos">774</span></a>        <span class="p">)</span>
</span><span id="IGAPatchDensity-775"><a href="#IGAPatchDensity-775"><span class="linenos">775</span></a>        <span class="n">K0</span> <span class="o">=</span> <span class="n">Bxx</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="n">Bxx</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bzz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">])))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="IGAPatchDensity-776"><a href="#IGAPatchDensity-776"><span class="linenos">776</span></a>        <span class="n">K1</span> <span class="o">=</span> <span class="n">Byy</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="n">Bxx</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bzz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">])))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="IGAPatchDensity-777"><a href="#IGAPatchDensity-777"><span class="linenos">777</span></a>        <span class="n">K2</span> <span class="o">=</span> <span class="n">Bzz</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="n">Bxx</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bzz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">])))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="IGAPatchDensity-778"><a href="#IGAPatchDensity-778"><span class="linenos">778</span></a>        <span class="n">K3</span> <span class="o">=</span> <span class="n">Bxy</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="n">Bxx</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bzz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">])))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="IGAPatchDensity-779"><a href="#IGAPatchDensity-779"><span class="linenos">779</span></a>        <span class="n">K4</span> <span class="o">=</span> <span class="n">Byz</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="n">Bxx</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bzz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">])))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="IGAPatchDensity-780"><a href="#IGAPatchDensity-780"><span class="linenos">780</span></a>        <span class="n">K5</span> <span class="o">=</span> <span class="n">Bxz</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="n">Bxx</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bzz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">])))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="IGAPatchDensity-781"><a href="#IGAPatchDensity-781"><span class="linenos">781</span></a>        <span class="n">K</span><span class="p">:</span> <span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">K0</span><span class="p">,</span> <span class="n">K1</span><span class="p">,</span> <span class="n">K2</span><span class="p">,</span> <span class="n">K3</span><span class="p">,</span> <span class="n">K4</span><span class="p">,</span> <span class="n">K5</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
</span><span id="IGAPatchDensity-782"><a href="#IGAPatchDensity-782"><span class="linenos">782</span></a>        <span class="k">return</span> <span class="n">K</span>
</span><span id="IGAPatchDensity-783"><a href="#IGAPatchDensity-783"><span class="linenos">783</span></a>
</span><span id="IGAPatchDensity-784"><a href="#IGAPatchDensity-784"><span class="linenos">784</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">XI</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]:</span>
</span><span id="IGAPatchDensity-785"><a href="#IGAPatchDensity-785"><span class="linenos">785</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatchDensity-786"><a href="#IGAPatchDensity-786"><span class="linenos">786</span></a><span class="sd">        Evaluate the interpolated density field at parametric points.</span>
</span><span id="IGAPatchDensity-787"><a href="#IGAPatchDensity-787"><span class="linenos">787</span></a>
</span><span id="IGAPatchDensity-788"><a href="#IGAPatchDensity-788"><span class="linenos">788</span></a><span class="sd">        The density is obtained by composition of the evaluated B-spline</span>
</span><span id="IGAPatchDensity-789"><a href="#IGAPatchDensity-789"><span class="linenos">789</span></a><span class="sd">        density field with a clipping operator to the interval [0, 1].</span>
</span><span id="IGAPatchDensity-790"><a href="#IGAPatchDensity-790"><span class="linenos">790</span></a>
</span><span id="IGAPatchDensity-791"><a href="#IGAPatchDensity-791"><span class="linenos">791</span></a><span class="sd">        Parameters</span>
</span><span id="IGAPatchDensity-792"><a href="#IGAPatchDensity-792"><span class="linenos">792</span></a><span class="sd">        ----------</span>
</span><span id="IGAPatchDensity-793"><a href="#IGAPatchDensity-793"><span class="linenos">793</span></a><span class="sd">        XI : list[np.ndarray[np.floating]]</span>
</span><span id="IGAPatchDensity-794"><a href="#IGAPatchDensity-794"><span class="linenos">794</span></a><span class="sd">            Parametric coordinates [xi, eta, zeta] at which to evaluate the density.</span>
</span><span id="IGAPatchDensity-795"><a href="#IGAPatchDensity-795"><span class="linenos">795</span></a>
</span><span id="IGAPatchDensity-796"><a href="#IGAPatchDensity-796"><span class="linenos">796</span></a><span class="sd">        Returns</span>
</span><span id="IGAPatchDensity-797"><a href="#IGAPatchDensity-797"><span class="linenos">797</span></a><span class="sd">        -------</span>
</span><span id="IGAPatchDensity-798"><a href="#IGAPatchDensity-798"><span class="linenos">798</span></a><span class="sd">        density : np.ndarray[np.floating]</span>
</span><span id="IGAPatchDensity-799"><a href="#IGAPatchDensity-799"><span class="linenos">799</span></a><span class="sd">            Density values at the parametric points.</span>
</span><span id="IGAPatchDensity-800"><a href="#IGAPatchDensity-800"><span class="linenos">800</span></a><span class="sd">            Shape corresponds to the tensor-product grid defined by `XI`.</span>
</span><span id="IGAPatchDensity-801"><a href="#IGAPatchDensity-801"><span class="linenos">801</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatchDensity-802"><a href="#IGAPatchDensity-802"><span class="linenos">802</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">XI</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="IGAPatchDensity-803"><a href="#IGAPatchDensity-803"><span class="linenos">803</span></a>
</span><span id="IGAPatchDensity-804"><a href="#IGAPatchDensity-804"><span class="linenos">804</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">sigma</span><span class="p">(</span>
</span><span id="IGAPatchDensity-805"><a href="#IGAPatchDensity-805"><span class="linenos">805</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">eps</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="n">density</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>
</span><span id="IGAPatchDensity-806"><a href="#IGAPatchDensity-806"><span class="linenos">806</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]:</span>
</span><span id="IGAPatchDensity-807"><a href="#IGAPatchDensity-807"><span class="linenos">807</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatchDensity-808"><a href="#IGAPatchDensity-808"><span class="linenos">808</span></a><span class="sd">        Compute the density-weighted stress tensor in Voigt notation.</span>
</span><span id="IGAPatchDensity-809"><a href="#IGAPatchDensity-809"><span class="linenos">809</span></a>
</span><span id="IGAPatchDensity-810"><a href="#IGAPatchDensity-810"><span class="linenos">810</span></a><span class="sd">        The stress is computed from the strain tensor using a linear elastic</span>
</span><span id="IGAPatchDensity-811"><a href="#IGAPatchDensity-811"><span class="linenos">811</span></a><span class="sd">        constitutive law, where the constitutive matrix is scaled pointwise</span>
</span><span id="IGAPatchDensity-812"><a href="#IGAPatchDensity-812"><span class="linenos">812</span></a><span class="sd">        by the provided density field.</span>
</span><span id="IGAPatchDensity-813"><a href="#IGAPatchDensity-813"><span class="linenos">813</span></a>
</span><span id="IGAPatchDensity-814"><a href="#IGAPatchDensity-814"><span class="linenos">814</span></a><span class="sd">        Voight notation shear strains are internally converted to tensorial</span>
</span><span id="IGAPatchDensity-815"><a href="#IGAPatchDensity-815"><span class="linenos">815</span></a><span class="sd">        shear strains before applying the constitutive law.</span>
</span><span id="IGAPatchDensity-816"><a href="#IGAPatchDensity-816"><span class="linenos">816</span></a>
</span><span id="IGAPatchDensity-817"><a href="#IGAPatchDensity-817"><span class="linenos">817</span></a><span class="sd">        Parameters</span>
</span><span id="IGAPatchDensity-818"><a href="#IGAPatchDensity-818"><span class="linenos">818</span></a><span class="sd">        ----------</span>
</span><span id="IGAPatchDensity-819"><a href="#IGAPatchDensity-819"><span class="linenos">819</span></a><span class="sd">        eps : np.ndarray[np.floating]</span>
</span><span id="IGAPatchDensity-820"><a href="#IGAPatchDensity-820"><span class="linenos">820</span></a><span class="sd">            Strain tensor in Voigt notation.</span>
</span><span id="IGAPatchDensity-821"><a href="#IGAPatchDensity-821"><span class="linenos">821</span></a><span class="sd">            Shape: (6, n_param_pts).</span>
</span><span id="IGAPatchDensity-822"><a href="#IGAPatchDensity-822"><span class="linenos">822</span></a><span class="sd">        density : np.ndarray[np.floating]</span>
</span><span id="IGAPatchDensity-823"><a href="#IGAPatchDensity-823"><span class="linenos">823</span></a><span class="sd">            Density values at the same parametric points.</span>
</span><span id="IGAPatchDensity-824"><a href="#IGAPatchDensity-824"><span class="linenos">824</span></a><span class="sd">            Shape: (n_param_pts,).</span>
</span><span id="IGAPatchDensity-825"><a href="#IGAPatchDensity-825"><span class="linenos">825</span></a>
</span><span id="IGAPatchDensity-826"><a href="#IGAPatchDensity-826"><span class="linenos">826</span></a><span class="sd">        Returns</span>
</span><span id="IGAPatchDensity-827"><a href="#IGAPatchDensity-827"><span class="linenos">827</span></a><span class="sd">        -------</span>
</span><span id="IGAPatchDensity-828"><a href="#IGAPatchDensity-828"><span class="linenos">828</span></a><span class="sd">        sig : np.ndarray[np.floating]</span>
</span><span id="IGAPatchDensity-829"><a href="#IGAPatchDensity-829"><span class="linenos">829</span></a><span class="sd">            Stress tensor in Voigt notation.</span>
</span><span id="IGAPatchDensity-830"><a href="#IGAPatchDensity-830"><span class="linenos">830</span></a><span class="sd">            Shape: (6, n_param_pts).</span>
</span><span id="IGAPatchDensity-831"><a href="#IGAPatchDensity-831"><span class="linenos">831</span></a>
</span><span id="IGAPatchDensity-832"><a href="#IGAPatchDensity-832"><span class="linenos">832</span></a><span class="sd">        See Also</span>
</span><span id="IGAPatchDensity-833"><a href="#IGAPatchDensity-833"><span class="linenos">833</span></a><span class="sd">        --------</span>
</span><span id="IGAPatchDensity-834"><a href="#IGAPatchDensity-834"><span class="linenos">834</span></a><span class="sd">        IGAPatch.epsilon :</span>
</span><span id="IGAPatchDensity-835"><a href="#IGAPatchDensity-835"><span class="linenos">835</span></a><span class="sd">            Strain computation from the displacement field.</span>
</span><span id="IGAPatchDensity-836"><a href="#IGAPatchDensity-836"><span class="linenos">836</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatchDensity-837"><a href="#IGAPatchDensity-837"><span class="linenos">837</span></a>        <span class="n">eps</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span> <span class="o">*=</span> <span class="mi">2</span>
</span><span id="IGAPatchDensity-838"><a href="#IGAPatchDensity-838"><span class="linenos">838</span></a>        <span class="n">H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">density</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># (6, 6, nb_param_pts)</span>
</span><span id="IGAPatchDensity-839"><a href="#IGAPatchDensity-839"><span class="linenos">839</span></a>        <span class="n">sig</span> <span class="o">=</span> <span class="p">(</span><span class="n">H</span> <span class="o">*</span> <span class="n">eps</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># sig_ij = H_ikj * eps_kj</span>
</span><span id="IGAPatchDensity-840"><a href="#IGAPatchDensity-840"><span class="linenos">840</span></a>        <span class="k">return</span> <span class="n">sig</span>  <span class="c1"># (6, nb_param_pts)</span>
</span><span id="IGAPatchDensity-841"><a href="#IGAPatchDensity-841"><span class="linenos">841</span></a>
</span><span id="IGAPatchDensity-842"><a href="#IGAPatchDensity-842"><span class="linenos">842</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">make_paraview_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">U</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="n">XI</span><span class="p">):</span>
</span><span id="IGAPatchDensity-843"><a href="#IGAPatchDensity-843"><span class="linenos">843</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatchDensity-844"><a href="#IGAPatchDensity-844"><span class="linenos">844</span></a><span class="sd">        Generate ParaView fields including density-dependent quantities.</span>
</span><span id="IGAPatchDensity-845"><a href="#IGAPatchDensity-845"><span class="linenos">845</span></a>
</span><span id="IGAPatchDensity-846"><a href="#IGAPatchDensity-846"><span class="linenos">846</span></a><span class="sd">        This method extends :py:meth:`IGAPatch.make_paraview_fields` by adding</span>
</span><span id="IGAPatchDensity-847"><a href="#IGAPatchDensity-847"><span class="linenos">847</span></a><span class="sd">        the interpolated density field and by ensuring that stress-related</span>
</span><span id="IGAPatchDensity-848"><a href="#IGAPatchDensity-848"><span class="linenos">848</span></a><span class="sd">        quantities are computed using the density-weighted constitutive law.</span>
</span><span id="IGAPatchDensity-849"><a href="#IGAPatchDensity-849"><span class="linenos">849</span></a>
</span><span id="IGAPatchDensity-850"><a href="#IGAPatchDensity-850"><span class="linenos">850</span></a><span class="sd">        The following fields are exported:</span>
</span><span id="IGAPatchDensity-851"><a href="#IGAPatchDensity-851"><span class="linenos">851</span></a><span class="sd">            - displacement `U`</span>
</span><span id="IGAPatchDensity-852"><a href="#IGAPatchDensity-852"><span class="linenos">852</span></a><span class="sd">            - strain tensor `epsilon`</span>
</span><span id="IGAPatchDensity-853"><a href="#IGAPatchDensity-853"><span class="linenos">853</span></a><span class="sd">            - density field `density`</span>
</span><span id="IGAPatchDensity-854"><a href="#IGAPatchDensity-854"><span class="linenos">854</span></a><span class="sd">            - stress tensor `sigma`</span>
</span><span id="IGAPatchDensity-855"><a href="#IGAPatchDensity-855"><span class="linenos">855</span></a><span class="sd">            - principal stresses `sigma_eig`</span>
</span><span id="IGAPatchDensity-856"><a href="#IGAPatchDensity-856"><span class="linenos">856</span></a><span class="sd">            - von Mises stress `von_mises`</span>
</span><span id="IGAPatchDensity-857"><a href="#IGAPatchDensity-857"><span class="linenos">857</span></a>
</span><span id="IGAPatchDensity-858"><a href="#IGAPatchDensity-858"><span class="linenos">858</span></a><span class="sd">        Parameters</span>
</span><span id="IGAPatchDensity-859"><a href="#IGAPatchDensity-859"><span class="linenos">859</span></a><span class="sd">        ----------</span>
</span><span id="IGAPatchDensity-860"><a href="#IGAPatchDensity-860"><span class="linenos">860</span></a><span class="sd">        U : np.ndarray[np.floating]</span>
</span><span id="IGAPatchDensity-861"><a href="#IGAPatchDensity-861"><span class="linenos">861</span></a><span class="sd">            Displacement field of shape (3, nb_ctrl_pts).</span>
</span><span id="IGAPatchDensity-862"><a href="#IGAPatchDensity-862"><span class="linenos">862</span></a><span class="sd">        XI : list[np.ndarray[np.floating]]</span>
</span><span id="IGAPatchDensity-863"><a href="#IGAPatchDensity-863"><span class="linenos">863</span></a><span class="sd">            Parametric coordinates [xi, eta, zeta] defining the evaluation grid.</span>
</span><span id="IGAPatchDensity-864"><a href="#IGAPatchDensity-864"><span class="linenos">864</span></a>
</span><span id="IGAPatchDensity-865"><a href="#IGAPatchDensity-865"><span class="linenos">865</span></a><span class="sd">        Returns</span>
</span><span id="IGAPatchDensity-866"><a href="#IGAPatchDensity-866"><span class="linenos">866</span></a><span class="sd">        -------</span>
</span><span id="IGAPatchDensity-867"><a href="#IGAPatchDensity-867"><span class="linenos">867</span></a><span class="sd">        fields : dict[str, np.ndarray[np.floating]]</span>
</span><span id="IGAPatchDensity-868"><a href="#IGAPatchDensity-868"><span class="linenos">868</span></a><span class="sd">            Dictionary of fields formatted for ParaView export.</span>
</span><span id="IGAPatchDensity-869"><a href="#IGAPatchDensity-869"><span class="linenos">869</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatchDensity-870"><a href="#IGAPatchDensity-870"><span class="linenos">870</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="IGAPatchDensity-871"><a href="#IGAPatchDensity-871"><span class="linenos">871</span></a>        <span class="n">epsilon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">XI</span><span class="p">)</span>
</span><span id="IGAPatchDensity-872"><a href="#IGAPatchDensity-872"><span class="linenos">872</span></a>        <span class="n">density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">XI</span><span class="p">)</span>
</span><span id="IGAPatchDensity-873"><a href="#IGAPatchDensity-873"><span class="linenos">873</span></a>        <span class="n">sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">(</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>
</span><span id="IGAPatchDensity-874"><a href="#IGAPatchDensity-874"><span class="linenos">874</span></a>        <span class="n">sigma_eig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_eig</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span>
</span><span id="IGAPatchDensity-875"><a href="#IGAPatchDensity-875"><span class="linenos">875</span></a>        <span class="n">von_mises</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">von_mises</span><span class="p">(</span><span class="n">sigma_eig</span><span class="p">)</span>
</span><span id="IGAPatchDensity-876"><a href="#IGAPatchDensity-876"><span class="linenos">876</span></a>        <span class="n">XI_shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">xi</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">XI</span><span class="p">)</span>
</span><span id="IGAPatchDensity-877"><a href="#IGAPatchDensity-877"><span class="linenos">877</span></a>        <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="IGAPatchDensity-878"><a href="#IGAPatchDensity-878"><span class="linenos">878</span></a>            <span class="s2">&quot;U&quot;</span><span class="p">:</span> <span class="n">u</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span>
</span><span id="IGAPatchDensity-879"><a href="#IGAPatchDensity-879"><span class="linenos">879</span></a>            <span class="s2">&quot;epsilon&quot;</span><span class="p">:</span> <span class="n">epsilon</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="n">XI_shape</span><span class="p">)),</span>
</span><span id="IGAPatchDensity-880"><a href="#IGAPatchDensity-880"><span class="linenos">880</span></a>            <span class="s2">&quot;density&quot;</span><span class="p">:</span> <span class="n">density</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">XI_shape</span><span class="p">)),</span>
</span><span id="IGAPatchDensity-881"><a href="#IGAPatchDensity-881"><span class="linenos">881</span></a>            <span class="s2">&quot;sigma&quot;</span><span class="p">:</span> <span class="n">sigma</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="n">XI_shape</span><span class="p">)),</span>
</span><span id="IGAPatchDensity-882"><a href="#IGAPatchDensity-882"><span class="linenos">882</span></a>            <span class="s2">&quot;sigma_eig&quot;</span><span class="p">:</span> <span class="n">sigma_eig</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">*</span><span class="n">XI_shape</span><span class="p">)),</span>
</span><span id="IGAPatchDensity-883"><a href="#IGAPatchDensity-883"><span class="linenos">883</span></a>            <span class="s2">&quot;von_mises&quot;</span><span class="p">:</span> <span class="n">von_mises</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">XI_shape</span><span class="p">)),</span>
</span><span id="IGAPatchDensity-884"><a href="#IGAPatchDensity-884"><span class="linenos">884</span></a>        <span class="p">}</span>
</span><span id="IGAPatchDensity-885"><a href="#IGAPatchDensity-885"><span class="linenos">885</span></a>        <span class="k">return</span> <span class="n">fields</span>
</span></pre></div>


            <div class="docstring"><p>Density-weighted representation of a 3D B-spline patch for linear elasticity.</p>

<p>This class extends <code><a href="#IGAPatch">IGAPatch</a></code> by allowing a spatially varying
material density. The density field is defined at the control points and
interpolated over the parametric domain, scaling the constitutive matrix locally
for both stiffness assembly and stress evaluation.</p>

<p>IGAPatchDensity is intended as a component of a multipatch problem and is
not a standalone solver. Typically, objects of this class are managed by a
<code>ProblemIGA</code> instance that assembles multiple patches, enforces Dirichlet
constraints, and solves the global elasticity problem.</p>

<p>Features provided by IGAPatchDensity include:
    - computation of the Jacobian and its determinant,
    - gradients of shape functions in physical space,
    - density-weighted linear elastic stiffness matrix assembly,
    - evaluation of prescribed surface forces,
    - post-processing quantities such as displacement, strain, stress,
    principal stresses, von Mises stress, and local density,
    - export of results to visualization tools (e.g., ParaView).</p>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>spline</strong> (BSpline):
The 3D B-spline volume representing the patch geometry and shape functions.</li>
<li><strong>ctrl_pts</strong> (np.ndarray[np.floating]):
Array of control points of shape (3, n_xi, n_eta, n_zeta) defining the patch geometry.</li>
<li><strong>xi</strong> (np.ndarray[np.floating]):
Isoparametric integration points along the xi direction.</li>
<li><strong>dxi</strong> (np.ndarray[np.floating]):
Corresponding quadrature weights for xi.</li>
<li><strong>eta</strong> (np.ndarray[np.floating]):
Isoparametric integration points along the eta direction.</li>
<li><strong>deta</strong> (np.ndarray[np.floating]):
Corresponding quadrature weights for eta.</li>
<li><strong>zeta</strong> (np.ndarray[np.floating]):
Isoparametric integration points along the zeta direction.</li>
<li><strong>dzeta</strong> (np.ndarray[np.floating]):
Corresponding quadrature weights for zeta.</li>
<li><strong>F_N</strong> (np.ndarray[np.floating]):
Prescribed surface forces, shape (3 (direction), 2 (side: front/back), 3 (physical components)),
used for computing the right-hand side vector.</li>
<li><strong>H</strong> (np.ndarray[np.floating]):
Constitutive matrix in Voigt notation (6x6) for linear isotropic elasticity.
Defined from <code>E</code> and <code>nu</code>.</li>
<li><strong>d</strong> (np.ndarray[np.floating]):
Density field expressed in the B-spline basis, used to scale the
constitutive matrix locally. At evaluation, values are clipped to [0, 1].</li>
</ul>

<h6 id="notes">Notes</h6>

<ul>
<li>All integration points are generated using Gaussian quadrature with a number
of points determined from the spline degree.</li>
<li>The density field modifies the stiffness and stress at each integration point.</li>
<li>This class does not handle multipatch connectivity or global constraints.
Use <code>ProblemIGA</code> to assemble and solve multipatch problems.</li>
<li>Post-processing quantities can be evaluated at the integration points or exported
to visualization tools like ParaView.</li>
</ul>
</div>


                            <div id="IGAPatchDensity.__init__" class="classattr">
                                        <input id="IGAPatchDensity.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">IGAPatchDensity</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">spline</span><span class="p">:</span> <span class="n">bsplyne</span><span class="o">.</span><span class="n">b_spline</span><span class="o">.</span><span class="n">BSpline</span>,</span><span class="param">	<span class="n">ctrl_pts</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>,</span><span class="param">	<span class="n">E</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">nu</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">d</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>,</span><span class="param">	<span class="n">F_N</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">([[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]],</span>

       <span class="p">[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]],</span>

       <span class="p">[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]]])</span></span>)</span>

                <label class="view-source-button" for="IGAPatchDensity.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IGAPatchDensity.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IGAPatchDensity.__init__-693"><a href="#IGAPatchDensity.__init__-693"><span class="linenos">693</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="IGAPatchDensity.__init__-694"><a href="#IGAPatchDensity.__init__-694"><span class="linenos">694</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="IGAPatchDensity.__init__-695"><a href="#IGAPatchDensity.__init__-695"><span class="linenos">695</span></a>        <span class="n">spline</span><span class="p">:</span> <span class="n">BSpline</span><span class="p">,</span>
</span><span id="IGAPatchDensity.__init__-696"><a href="#IGAPatchDensity.__init__-696"><span class="linenos">696</span></a>        <span class="n">ctrl_pts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span>
</span><span id="IGAPatchDensity.__init__-697"><a href="#IGAPatchDensity.__init__-697"><span class="linenos">697</span></a>        <span class="n">E</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="IGAPatchDensity.__init__-698"><a href="#IGAPatchDensity.__init__-698"><span class="linenos">698</span></a>        <span class="n">nu</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="IGAPatchDensity.__init__-699"><a href="#IGAPatchDensity.__init__-699"><span class="linenos">699</span></a>        <span class="n">d</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span>
</span><span id="IGAPatchDensity.__init__-700"><a href="#IGAPatchDensity.__init__-700"><span class="linenos">700</span></a>        <span class="n">F_N</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">),</span>
</span><span id="IGAPatchDensity.__init__-701"><a href="#IGAPatchDensity.__init__-701"><span class="linenos">701</span></a>    <span class="p">):</span>
</span><span id="IGAPatchDensity.__init__-702"><a href="#IGAPatchDensity.__init__-702"><span class="linenos">702</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatchDensity.__init__-703"><a href="#IGAPatchDensity.__init__-703"><span class="linenos">703</span></a><span class="sd">        Initialize a density-weighted IGA patch.</span>
</span><span id="IGAPatchDensity.__init__-704"><a href="#IGAPatchDensity.__init__-704"><span class="linenos">704</span></a>
</span><span id="IGAPatchDensity.__init__-705"><a href="#IGAPatchDensity.__init__-705"><span class="linenos">705</span></a><span class="sd">        This constructor extends :py:meth:`IGAPatch.__init__` by introducing</span>
</span><span id="IGAPatchDensity.__init__-706"><a href="#IGAPatchDensity.__init__-706"><span class="linenos">706</span></a><span class="sd">        a control-point-based density field and by initializing Gaussian</span>
</span><span id="IGAPatchDensity.__init__-707"><a href="#IGAPatchDensity.__init__-707"><span class="linenos">707</span></a><span class="sd">        quadrature points for volumetric integration including the density field.</span>
</span><span id="IGAPatchDensity.__init__-708"><a href="#IGAPatchDensity.__init__-708"><span class="linenos">708</span></a>
</span><span id="IGAPatchDensity.__init__-709"><a href="#IGAPatchDensity.__init__-709"><span class="linenos">709</span></a><span class="sd">        The density field is reshaped to match the control point grid.</span>
</span><span id="IGAPatchDensity.__init__-710"><a href="#IGAPatchDensity.__init__-710"><span class="linenos">710</span></a>
</span><span id="IGAPatchDensity.__init__-711"><a href="#IGAPatchDensity.__init__-711"><span class="linenos">711</span></a><span class="sd">        Parameters</span>
</span><span id="IGAPatchDensity.__init__-712"><a href="#IGAPatchDensity.__init__-712"><span class="linenos">712</span></a><span class="sd">        ----------</span>
</span><span id="IGAPatchDensity.__init__-713"><a href="#IGAPatchDensity.__init__-713"><span class="linenos">713</span></a><span class="sd">        spline : BSpline</span>
</span><span id="IGAPatchDensity.__init__-714"><a href="#IGAPatchDensity.__init__-714"><span class="linenos">714</span></a><span class="sd">            B-spline volume defining the parametric domain.</span>
</span><span id="IGAPatchDensity.__init__-715"><a href="#IGAPatchDensity.__init__-715"><span class="linenos">715</span></a><span class="sd">        ctrl_pts : np.ndarray[np.floating]</span>
</span><span id="IGAPatchDensity.__init__-716"><a href="#IGAPatchDensity.__init__-716"><span class="linenos">716</span></a><span class="sd">            Control points defining the patch geometry.</span>
</span><span id="IGAPatchDensity.__init__-717"><a href="#IGAPatchDensity.__init__-717"><span class="linenos">717</span></a><span class="sd">        E : float</span>
</span><span id="IGAPatchDensity.__init__-718"><a href="#IGAPatchDensity.__init__-718"><span class="linenos">718</span></a><span class="sd">            Young&#39;s modulus of the material.</span>
</span><span id="IGAPatchDensity.__init__-719"><a href="#IGAPatchDensity.__init__-719"><span class="linenos">719</span></a><span class="sd">        nu : float</span>
</span><span id="IGAPatchDensity.__init__-720"><a href="#IGAPatchDensity.__init__-720"><span class="linenos">720</span></a><span class="sd">            Poisson&#39;s ratio of the material.</span>
</span><span id="IGAPatchDensity.__init__-721"><a href="#IGAPatchDensity.__init__-721"><span class="linenos">721</span></a><span class="sd">        d : np.ndarray[np.floating]</span>
</span><span id="IGAPatchDensity.__init__-722"><a href="#IGAPatchDensity.__init__-722"><span class="linenos">722</span></a><span class="sd">            Density field expressed in the B-spline basis.</span>
</span><span id="IGAPatchDensity.__init__-723"><a href="#IGAPatchDensity.__init__-723"><span class="linenos">723</span></a><span class="sd">            Evaluated density (N @ d) will be clipped to the range [0, 1].</span>
</span><span id="IGAPatchDensity.__init__-724"><a href="#IGAPatchDensity.__init__-724"><span class="linenos">724</span></a><span class="sd">        F_N : np.ndarray[np.floating], optional</span>
</span><span id="IGAPatchDensity.__init__-725"><a href="#IGAPatchDensity.__init__-725"><span class="linenos">725</span></a><span class="sd">            Surfacic Neumann forces applied on the patch boundaries.</span>
</span><span id="IGAPatchDensity.__init__-726"><a href="#IGAPatchDensity.__init__-726"><span class="linenos">726</span></a><span class="sd">            Shape: (3, 2, 3). Default is zero.</span>
</span><span id="IGAPatchDensity.__init__-727"><a href="#IGAPatchDensity.__init__-727"><span class="linenos">727</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatchDensity.__init__-728"><a href="#IGAPatchDensity.__init__-728"><span class="linenos">728</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">spline</span><span class="p">,</span> <span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">F_N</span><span class="p">)</span>
</span><span id="IGAPatchDensity.__init__-729"><a href="#IGAPatchDensity.__init__-729"><span class="linenos">729</span></a>        <span class="n">xi_eta_zeta_pts_pds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">gauss_legendre_for_integration</span><span class="p">(</span>
</span><span id="IGAPatchDensity.__init__-730"><a href="#IGAPatchDensity.__init__-730"><span class="linenos">730</span></a>            <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">getDegrees</span><span class="p">())</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="IGAPatchDensity.__init__-731"><a href="#IGAPatchDensity.__init__-731"><span class="linenos">731</span></a>        <span class="p">)</span>
</span><span id="IGAPatchDensity.__init__-732"><a href="#IGAPatchDensity.__init__-732"><span class="linenos">732</span></a>        <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeta</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dxi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dzeta</span><span class="p">))</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="IGAPatchDensity.__init__-733"><a href="#IGAPatchDensity.__init__-733"><span class="linenos">733</span></a>            <span class="n">xi_eta_zeta_pts_pds</span>
</span><span id="IGAPatchDensity.__init__-734"><a href="#IGAPatchDensity.__init__-734"><span class="linenos">734</span></a>        <span class="p">)</span>
</span><span id="IGAPatchDensity.__init__-735"><a href="#IGAPatchDensity.__init__-735"><span class="linenos">735</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span></pre></div>


            <div class="docstring"><p>Initialize a density-weighted IGA patch.</p>

<p>This constructor extends <code><a href="#IGAPatch.__init__">IGAPatch.__init__()</a></code> by introducing
a control-point-based density field and by initializing Gaussian
quadrature points for volumetric integration including the density field.</p>

<p>The density field is reshaped to match the control point grid.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>spline</strong> (BSpline):
B-spline volume defining the parametric domain.</li>
<li><strong>ctrl_pts</strong> (np.ndarray[np.floating]):
Control points defining the patch geometry.</li>
<li><strong>E</strong> (float):
Young's modulus of the material.</li>
<li><strong>nu</strong> (float):
Poisson's ratio of the material.</li>
<li><strong>d</strong> (np.ndarray[np.floating]):
Density field expressed in the B-spline basis.
Evaluated density (N @ d) will be clipped to the range [0, 1].</li>
<li><strong>F_N</strong> (np.ndarray[np.floating], optional):
Surfacic Neumann forces applied on the patch boundaries.
Shape: (3, 2, 3). Default is zero.</li>
</ul>
</div>


                            </div>
                            <div id="IGAPatchDensity.d" class="classattr">
                                <div class="attr variable">
            <span class="name">d</span>

        
    </div>
    <a class="headerlink" href="#IGAPatchDensity.d"></a>
    
    

                            </div>
                            <div id="IGAPatchDensity.stiffness" class="classattr">
                                        <input id="IGAPatchDensity.stiffness-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">stiffness</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">_matrix</span><span class="o">.</span><span class="n">spmatrix</span>:</span></span>

                <label class="view-source-button" for="IGAPatchDensity.stiffness-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IGAPatchDensity.stiffness"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IGAPatchDensity.stiffness-737"><a href="#IGAPatchDensity.stiffness-737"><span class="linenos">737</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">stiffness</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">:</span>
</span><span id="IGAPatchDensity.stiffness-738"><a href="#IGAPatchDensity.stiffness-738"><span class="linenos">738</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatchDensity.stiffness-739"><a href="#IGAPatchDensity.stiffness-739"><span class="linenos">739</span></a><span class="sd">        Assemble the density-weighted stiffness matrix.</span>
</span><span id="IGAPatchDensity.stiffness-740"><a href="#IGAPatchDensity.stiffness-740"><span class="linenos">740</span></a>
</span><span id="IGAPatchDensity.stiffness-741"><a href="#IGAPatchDensity.stiffness-741"><span class="linenos">741</span></a><span class="sd">        This method follows the same formulation as</span>
</span><span id="IGAPatchDensity.stiffness-742"><a href="#IGAPatchDensity.stiffness-742"><span class="linenos">742</span></a><span class="sd">        :py:meth:`IGAPatch.stiffness`, but the constitutive matrix is scaled</span>
</span><span id="IGAPatchDensity.stiffness-743"><a href="#IGAPatchDensity.stiffness-743"><span class="linenos">743</span></a><span class="sd">        pointwise by the interpolated density field.</span>
</span><span id="IGAPatchDensity.stiffness-744"><a href="#IGAPatchDensity.stiffness-744"><span class="linenos">744</span></a>
</span><span id="IGAPatchDensity.stiffness-745"><a href="#IGAPatchDensity.stiffness-745"><span class="linenos">745</span></a><span class="sd">        At each integration point, the elasticity tensor is multiplied by</span>
</span><span id="IGAPatchDensity.stiffness-746"><a href="#IGAPatchDensity.stiffness-746"><span class="linenos">746</span></a><span class="sd">        the local density value, resulting in a spatially varying stiffness.</span>
</span><span id="IGAPatchDensity.stiffness-747"><a href="#IGAPatchDensity.stiffness-747"><span class="linenos">747</span></a>
</span><span id="IGAPatchDensity.stiffness-748"><a href="#IGAPatchDensity.stiffness-748"><span class="linenos">748</span></a><span class="sd">        Returns</span>
</span><span id="IGAPatchDensity.stiffness-749"><a href="#IGAPatchDensity.stiffness-749"><span class="linenos">749</span></a><span class="sd">        -------</span>
</span><span id="IGAPatchDensity.stiffness-750"><a href="#IGAPatchDensity.stiffness-750"><span class="linenos">750</span></a><span class="sd">        K : sps.spmatrix</span>
</span><span id="IGAPatchDensity.stiffness-751"><a href="#IGAPatchDensity.stiffness-751"><span class="linenos">751</span></a><span class="sd">            Sparse stiffness matrix of shape</span>
</span><span id="IGAPatchDensity.stiffness-752"><a href="#IGAPatchDensity.stiffness-752"><span class="linenos">752</span></a><span class="sd">            (3 * nb_ctrl_pts, 3 * nb_ctrl_pts).</span>
</span><span id="IGAPatchDensity.stiffness-753"><a href="#IGAPatchDensity.stiffness-753"><span class="linenos">753</span></a>
</span><span id="IGAPatchDensity.stiffness-754"><a href="#IGAPatchDensity.stiffness-754"><span class="linenos">754</span></a><span class="sd">        See Also</span>
</span><span id="IGAPatchDensity.stiffness-755"><a href="#IGAPatchDensity.stiffness-755"><span class="linenos">755</span></a><span class="sd">        --------</span>
</span><span id="IGAPatchDensity.stiffness-756"><a href="#IGAPatchDensity.stiffness-756"><span class="linenos">756</span></a><span class="sd">        IGAPatch.stiffness :</span>
</span><span id="IGAPatchDensity.stiffness-757"><a href="#IGAPatchDensity.stiffness-757"><span class="linenos">757</span></a><span class="sd">            Stiffness assembly without density weighting.</span>
</span><span id="IGAPatchDensity.stiffness-758"><a href="#IGAPatchDensity.stiffness-758"><span class="linenos">758</span></a><span class="sd">        IGAPatchDensity.density :</span>
</span><span id="IGAPatchDensity.stiffness-759"><a href="#IGAPatchDensity.stiffness-759"><span class="linenos">759</span></a><span class="sd">            Evaluation of the density field at parametric points.</span>
</span><span id="IGAPatchDensity.stiffness-760"><a href="#IGAPatchDensity.stiffness-760"><span class="linenos">760</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatchDensity.stiffness-761"><a href="#IGAPatchDensity.stiffness-761"><span class="linenos">761</span></a>        <span class="n">dN_dXI</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">DN</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeta</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="IGAPatchDensity.stiffness-762"><a href="#IGAPatchDensity.stiffness-762"><span class="linenos">762</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">Jinv</span><span class="p">,</span> <span class="n">detJ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jacobian</span><span class="p">(</span><span class="n">dN_dXI</span><span class="p">)</span>
</span><span id="IGAPatchDensity.stiffness-763"><a href="#IGAPatchDensity.stiffness-763"><span class="linenos">763</span></a>        <span class="n">dN_dx</span><span class="p">,</span> <span class="n">dN_dy</span><span class="p">,</span> <span class="n">dN_dz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grad_N</span><span class="p">(</span><span class="n">Jinv</span><span class="p">,</span> <span class="n">dN_dXI</span><span class="p">)</span>
</span><span id="IGAPatchDensity.stiffness-764"><a href="#IGAPatchDensity.stiffness-764"><span class="linenos">764</span></a>        <span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_W</span><span class="p">(</span><span class="n">detJ</span><span class="p">)</span>
</span><span id="IGAPatchDensity.stiffness-765"><a href="#IGAPatchDensity.stiffness-765"><span class="linenos">765</span></a>        <span class="n">Z</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">coo_matrix</span><span class="p">(</span><span class="n">dN_dx</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
</span><span id="IGAPatchDensity.stiffness-766"><a href="#IGAPatchDensity.stiffness-766"><span class="linenos">766</span></a>        <span class="n">Bxx</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">dN_dx</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">Z</span><span class="p">))</span>
</span><span id="IGAPatchDensity.stiffness-767"><a href="#IGAPatchDensity.stiffness-767"><span class="linenos">767</span></a>        <span class="n">Byy</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Z</span><span class="p">,</span> <span class="n">dN_dy</span><span class="p">,</span> <span class="n">Z</span><span class="p">))</span>
</span><span id="IGAPatchDensity.stiffness-768"><a href="#IGAPatchDensity.stiffness-768"><span class="linenos">768</span></a>        <span class="n">Bzz</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Z</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">dN_dz</span><span class="p">))</span>
</span><span id="IGAPatchDensity.stiffness-769"><a href="#IGAPatchDensity.stiffness-769"><span class="linenos">769</span></a>        <span class="n">Bxy</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">dN_dy</span><span class="p">,</span> <span class="n">dN_dx</span><span class="p">,</span> <span class="n">Z</span><span class="p">))</span>
</span><span id="IGAPatchDensity.stiffness-770"><a href="#IGAPatchDensity.stiffness-770"><span class="linenos">770</span></a>        <span class="n">Byz</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Z</span><span class="p">,</span> <span class="n">dN_dz</span><span class="p">,</span> <span class="n">dN_dy</span><span class="p">))</span>
</span><span id="IGAPatchDensity.stiffness-771"><a href="#IGAPatchDensity.stiffness-771"><span class="linenos">771</span></a>        <span class="n">Bxz</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">dN_dz</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">dN_dx</span><span class="p">))</span>
</span><span id="IGAPatchDensity.stiffness-772"><a href="#IGAPatchDensity.stiffness-772"><span class="linenos">772</span></a>        <span class="n">H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">density</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeta</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
</span><span id="IGAPatchDensity.stiffness-773"><a href="#IGAPatchDensity.stiffness-773"><span class="linenos">773</span></a>            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="IGAPatchDensity.stiffness-774"><a href="#IGAPatchDensity.stiffness-774"><span class="linenos">774</span></a>        <span class="p">)</span>
</span><span id="IGAPatchDensity.stiffness-775"><a href="#IGAPatchDensity.stiffness-775"><span class="linenos">775</span></a>        <span class="n">K0</span> <span class="o">=</span> <span class="n">Bxx</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="n">Bxx</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bzz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">])))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="IGAPatchDensity.stiffness-776"><a href="#IGAPatchDensity.stiffness-776"><span class="linenos">776</span></a>        <span class="n">K1</span> <span class="o">=</span> <span class="n">Byy</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="n">Bxx</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bzz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">])))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="IGAPatchDensity.stiffness-777"><a href="#IGAPatchDensity.stiffness-777"><span class="linenos">777</span></a>        <span class="n">K2</span> <span class="o">=</span> <span class="n">Bzz</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="n">Bxx</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bzz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">])))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="IGAPatchDensity.stiffness-778"><a href="#IGAPatchDensity.stiffness-778"><span class="linenos">778</span></a>        <span class="n">K3</span> <span class="o">=</span> <span class="n">Bxy</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="n">Bxx</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bzz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">])))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="IGAPatchDensity.stiffness-779"><a href="#IGAPatchDensity.stiffness-779"><span class="linenos">779</span></a>        <span class="n">K4</span> <span class="o">=</span> <span class="n">Byz</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="n">Bxx</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bzz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">])))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="IGAPatchDensity.stiffness-780"><a href="#IGAPatchDensity.stiffness-780"><span class="linenos">780</span></a>        <span class="n">K5</span> <span class="o">=</span> <span class="n">Bxz</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="nb">sum</span><span class="p">((</span><span class="n">Bxx</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bzz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxy</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Byz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]),</span> <span class="n">Bxz</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">])))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># type: ignore</span>
</span><span id="IGAPatchDensity.stiffness-781"><a href="#IGAPatchDensity.stiffness-781"><span class="linenos">781</span></a>        <span class="n">K</span><span class="p">:</span> <span class="n">sps</span><span class="o">.</span><span class="n">spmatrix</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">K0</span><span class="p">,</span> <span class="n">K1</span><span class="p">,</span> <span class="n">K2</span><span class="p">,</span> <span class="n">K3</span><span class="p">,</span> <span class="n">K4</span><span class="p">,</span> <span class="n">K5</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
</span><span id="IGAPatchDensity.stiffness-782"><a href="#IGAPatchDensity.stiffness-782"><span class="linenos">782</span></a>        <span class="k">return</span> <span class="n">K</span>
</span></pre></div>


            <div class="docstring"><p>Assemble the density-weighted stiffness matrix.</p>

<p>This method follows the same formulation as
<code><a href="#IGAPatch.stiffness">IGAPatch.stiffness()</a></code>, but the constitutive matrix is scaled
pointwise by the interpolated density field.</p>

<p>At each integration point, the elasticity tensor is multiplied by
the local density value, resulting in a spatially varying stiffness.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>K</strong> (sps.spmatrix):
Sparse stiffness matrix of shape
(3 * nb_ctrl_pts, 3 * nb_ctrl_pts).</li>
</ul>

<h6 id="see-also">See Also</h6>

<p><code><a href="#IGAPatch.stiffness">IGAPatch.stiffness</a></code>: 
Stiffness assembly without density weighting.<br />
<code><a href="#IGAPatchDensity.density">IGAPatchDensity.density</a></code>: 
Evaluation of the density field at parametric points.  </p>
</div>


                            </div>
                            <div id="IGAPatchDensity.density" class="classattr">
                                        <input id="IGAPatchDensity.density-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">density</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">XI</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="IGAPatchDensity.density-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IGAPatchDensity.density"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IGAPatchDensity.density-784"><a href="#IGAPatchDensity.density-784"><span class="linenos">784</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">XI</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]:</span>
</span><span id="IGAPatchDensity.density-785"><a href="#IGAPatchDensity.density-785"><span class="linenos">785</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatchDensity.density-786"><a href="#IGAPatchDensity.density-786"><span class="linenos">786</span></a><span class="sd">        Evaluate the interpolated density field at parametric points.</span>
</span><span id="IGAPatchDensity.density-787"><a href="#IGAPatchDensity.density-787"><span class="linenos">787</span></a>
</span><span id="IGAPatchDensity.density-788"><a href="#IGAPatchDensity.density-788"><span class="linenos">788</span></a><span class="sd">        The density is obtained by composition of the evaluated B-spline</span>
</span><span id="IGAPatchDensity.density-789"><a href="#IGAPatchDensity.density-789"><span class="linenos">789</span></a><span class="sd">        density field with a clipping operator to the interval [0, 1].</span>
</span><span id="IGAPatchDensity.density-790"><a href="#IGAPatchDensity.density-790"><span class="linenos">790</span></a>
</span><span id="IGAPatchDensity.density-791"><a href="#IGAPatchDensity.density-791"><span class="linenos">791</span></a><span class="sd">        Parameters</span>
</span><span id="IGAPatchDensity.density-792"><a href="#IGAPatchDensity.density-792"><span class="linenos">792</span></a><span class="sd">        ----------</span>
</span><span id="IGAPatchDensity.density-793"><a href="#IGAPatchDensity.density-793"><span class="linenos">793</span></a><span class="sd">        XI : list[np.ndarray[np.floating]]</span>
</span><span id="IGAPatchDensity.density-794"><a href="#IGAPatchDensity.density-794"><span class="linenos">794</span></a><span class="sd">            Parametric coordinates [xi, eta, zeta] at which to evaluate the density.</span>
</span><span id="IGAPatchDensity.density-795"><a href="#IGAPatchDensity.density-795"><span class="linenos">795</span></a>
</span><span id="IGAPatchDensity.density-796"><a href="#IGAPatchDensity.density-796"><span class="linenos">796</span></a><span class="sd">        Returns</span>
</span><span id="IGAPatchDensity.density-797"><a href="#IGAPatchDensity.density-797"><span class="linenos">797</span></a><span class="sd">        -------</span>
</span><span id="IGAPatchDensity.density-798"><a href="#IGAPatchDensity.density-798"><span class="linenos">798</span></a><span class="sd">        density : np.ndarray[np.floating]</span>
</span><span id="IGAPatchDensity.density-799"><a href="#IGAPatchDensity.density-799"><span class="linenos">799</span></a><span class="sd">            Density values at the parametric points.</span>
</span><span id="IGAPatchDensity.density-800"><a href="#IGAPatchDensity.density-800"><span class="linenos">800</span></a><span class="sd">            Shape corresponds to the tensor-product grid defined by `XI`.</span>
</span><span id="IGAPatchDensity.density-801"><a href="#IGAPatchDensity.density-801"><span class="linenos">801</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatchDensity.density-802"><a href="#IGAPatchDensity.density-802"><span class="linenos">802</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">XI</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Evaluate the interpolated density field at parametric points.</p>

<p>The density is obtained by composition of the evaluated B-spline
density field with a clipping operator to the interval [0, 1].</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>XI</strong> (list[np.ndarray[np.floating]]):
Parametric coordinates [xi, eta, zeta] at which to evaluate the density.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>density</strong> (np.ndarray[np.floating]):
Density values at the parametric points.
Shape corresponds to the tensor-product grid defined by <code>XI</code>.</li>
</ul>
</div>


                            </div>
                            <div id="IGAPatchDensity.sigma" class="classattr">
                                        <input id="IGAPatchDensity.sigma-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sigma</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">eps</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>,</span><span class="param">	<span class="n">density</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="IGAPatchDensity.sigma-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IGAPatchDensity.sigma"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IGAPatchDensity.sigma-804"><a href="#IGAPatchDensity.sigma-804"><span class="linenos">804</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">sigma</span><span class="p">(</span>
</span><span id="IGAPatchDensity.sigma-805"><a href="#IGAPatchDensity.sigma-805"><span class="linenos">805</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">eps</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="n">density</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>
</span><span id="IGAPatchDensity.sigma-806"><a href="#IGAPatchDensity.sigma-806"><span class="linenos">806</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]:</span>
</span><span id="IGAPatchDensity.sigma-807"><a href="#IGAPatchDensity.sigma-807"><span class="linenos">807</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatchDensity.sigma-808"><a href="#IGAPatchDensity.sigma-808"><span class="linenos">808</span></a><span class="sd">        Compute the density-weighted stress tensor in Voigt notation.</span>
</span><span id="IGAPatchDensity.sigma-809"><a href="#IGAPatchDensity.sigma-809"><span class="linenos">809</span></a>
</span><span id="IGAPatchDensity.sigma-810"><a href="#IGAPatchDensity.sigma-810"><span class="linenos">810</span></a><span class="sd">        The stress is computed from the strain tensor using a linear elastic</span>
</span><span id="IGAPatchDensity.sigma-811"><a href="#IGAPatchDensity.sigma-811"><span class="linenos">811</span></a><span class="sd">        constitutive law, where the constitutive matrix is scaled pointwise</span>
</span><span id="IGAPatchDensity.sigma-812"><a href="#IGAPatchDensity.sigma-812"><span class="linenos">812</span></a><span class="sd">        by the provided density field.</span>
</span><span id="IGAPatchDensity.sigma-813"><a href="#IGAPatchDensity.sigma-813"><span class="linenos">813</span></a>
</span><span id="IGAPatchDensity.sigma-814"><a href="#IGAPatchDensity.sigma-814"><span class="linenos">814</span></a><span class="sd">        Voight notation shear strains are internally converted to tensorial</span>
</span><span id="IGAPatchDensity.sigma-815"><a href="#IGAPatchDensity.sigma-815"><span class="linenos">815</span></a><span class="sd">        shear strains before applying the constitutive law.</span>
</span><span id="IGAPatchDensity.sigma-816"><a href="#IGAPatchDensity.sigma-816"><span class="linenos">816</span></a>
</span><span id="IGAPatchDensity.sigma-817"><a href="#IGAPatchDensity.sigma-817"><span class="linenos">817</span></a><span class="sd">        Parameters</span>
</span><span id="IGAPatchDensity.sigma-818"><a href="#IGAPatchDensity.sigma-818"><span class="linenos">818</span></a><span class="sd">        ----------</span>
</span><span id="IGAPatchDensity.sigma-819"><a href="#IGAPatchDensity.sigma-819"><span class="linenos">819</span></a><span class="sd">        eps : np.ndarray[np.floating]</span>
</span><span id="IGAPatchDensity.sigma-820"><a href="#IGAPatchDensity.sigma-820"><span class="linenos">820</span></a><span class="sd">            Strain tensor in Voigt notation.</span>
</span><span id="IGAPatchDensity.sigma-821"><a href="#IGAPatchDensity.sigma-821"><span class="linenos">821</span></a><span class="sd">            Shape: (6, n_param_pts).</span>
</span><span id="IGAPatchDensity.sigma-822"><a href="#IGAPatchDensity.sigma-822"><span class="linenos">822</span></a><span class="sd">        density : np.ndarray[np.floating]</span>
</span><span id="IGAPatchDensity.sigma-823"><a href="#IGAPatchDensity.sigma-823"><span class="linenos">823</span></a><span class="sd">            Density values at the same parametric points.</span>
</span><span id="IGAPatchDensity.sigma-824"><a href="#IGAPatchDensity.sigma-824"><span class="linenos">824</span></a><span class="sd">            Shape: (n_param_pts,).</span>
</span><span id="IGAPatchDensity.sigma-825"><a href="#IGAPatchDensity.sigma-825"><span class="linenos">825</span></a>
</span><span id="IGAPatchDensity.sigma-826"><a href="#IGAPatchDensity.sigma-826"><span class="linenos">826</span></a><span class="sd">        Returns</span>
</span><span id="IGAPatchDensity.sigma-827"><a href="#IGAPatchDensity.sigma-827"><span class="linenos">827</span></a><span class="sd">        -------</span>
</span><span id="IGAPatchDensity.sigma-828"><a href="#IGAPatchDensity.sigma-828"><span class="linenos">828</span></a><span class="sd">        sig : np.ndarray[np.floating]</span>
</span><span id="IGAPatchDensity.sigma-829"><a href="#IGAPatchDensity.sigma-829"><span class="linenos">829</span></a><span class="sd">            Stress tensor in Voigt notation.</span>
</span><span id="IGAPatchDensity.sigma-830"><a href="#IGAPatchDensity.sigma-830"><span class="linenos">830</span></a><span class="sd">            Shape: (6, n_param_pts).</span>
</span><span id="IGAPatchDensity.sigma-831"><a href="#IGAPatchDensity.sigma-831"><span class="linenos">831</span></a>
</span><span id="IGAPatchDensity.sigma-832"><a href="#IGAPatchDensity.sigma-832"><span class="linenos">832</span></a><span class="sd">        See Also</span>
</span><span id="IGAPatchDensity.sigma-833"><a href="#IGAPatchDensity.sigma-833"><span class="linenos">833</span></a><span class="sd">        --------</span>
</span><span id="IGAPatchDensity.sigma-834"><a href="#IGAPatchDensity.sigma-834"><span class="linenos">834</span></a><span class="sd">        IGAPatch.epsilon :</span>
</span><span id="IGAPatchDensity.sigma-835"><a href="#IGAPatchDensity.sigma-835"><span class="linenos">835</span></a><span class="sd">            Strain computation from the displacement field.</span>
</span><span id="IGAPatchDensity.sigma-836"><a href="#IGAPatchDensity.sigma-836"><span class="linenos">836</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatchDensity.sigma-837"><a href="#IGAPatchDensity.sigma-837"><span class="linenos">837</span></a>        <span class="n">eps</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span> <span class="o">*=</span> <span class="mi">2</span>
</span><span id="IGAPatchDensity.sigma-838"><a href="#IGAPatchDensity.sigma-838"><span class="linenos">838</span></a>        <span class="n">H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">density</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># (6, 6, nb_param_pts)</span>
</span><span id="IGAPatchDensity.sigma-839"><a href="#IGAPatchDensity.sigma-839"><span class="linenos">839</span></a>        <span class="n">sig</span> <span class="o">=</span> <span class="p">(</span><span class="n">H</span> <span class="o">*</span> <span class="n">eps</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># sig_ij = H_ikj * eps_kj</span>
</span><span id="IGAPatchDensity.sigma-840"><a href="#IGAPatchDensity.sigma-840"><span class="linenos">840</span></a>        <span class="k">return</span> <span class="n">sig</span>  <span class="c1"># (6, nb_param_pts)</span>
</span></pre></div>


            <div class="docstring"><p>Compute the density-weighted stress tensor in Voigt notation.</p>

<p>The stress is computed from the strain tensor using a linear elastic
constitutive law, where the constitutive matrix is scaled pointwise
by the provided density field.</p>

<p>Voight notation shear strains are internally converted to tensorial
shear strains before applying the constitutive law.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>eps</strong> (np.ndarray[np.floating]):
Strain tensor in Voigt notation.
Shape: (6, n_param_pts).</li>
<li><strong>density</strong> (np.ndarray[np.floating]):
Density values at the same parametric points.
Shape: (n_param_pts,).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>sig</strong> (np.ndarray[np.floating]):
Stress tensor in Voigt notation.
Shape: (6, n_param_pts).</li>
</ul>

<h6 id="see-also">See Also</h6>

<p><code><a href="#IGAPatch.epsilon">IGAPatch.epsilon</a></code>: 
Strain computation from the displacement field.  </p>
</div>


                            </div>
                            <div id="IGAPatchDensity.make_paraview_fields" class="classattr">
                                        <input id="IGAPatchDensity.make_paraview_fields-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">make_paraview_fields</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">U</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span>, </span><span class="param"><span class="n">XI</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="IGAPatchDensity.make_paraview_fields-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IGAPatchDensity.make_paraview_fields"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IGAPatchDensity.make_paraview_fields-842"><a href="#IGAPatchDensity.make_paraview_fields-842"><span class="linenos">842</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">make_paraview_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">U</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="n">XI</span><span class="p">):</span>
</span><span id="IGAPatchDensity.make_paraview_fields-843"><a href="#IGAPatchDensity.make_paraview_fields-843"><span class="linenos">843</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="IGAPatchDensity.make_paraview_fields-844"><a href="#IGAPatchDensity.make_paraview_fields-844"><span class="linenos">844</span></a><span class="sd">        Generate ParaView fields including density-dependent quantities.</span>
</span><span id="IGAPatchDensity.make_paraview_fields-845"><a href="#IGAPatchDensity.make_paraview_fields-845"><span class="linenos">845</span></a>
</span><span id="IGAPatchDensity.make_paraview_fields-846"><a href="#IGAPatchDensity.make_paraview_fields-846"><span class="linenos">846</span></a><span class="sd">        This method extends :py:meth:`IGAPatch.make_paraview_fields` by adding</span>
</span><span id="IGAPatchDensity.make_paraview_fields-847"><a href="#IGAPatchDensity.make_paraview_fields-847"><span class="linenos">847</span></a><span class="sd">        the interpolated density field and by ensuring that stress-related</span>
</span><span id="IGAPatchDensity.make_paraview_fields-848"><a href="#IGAPatchDensity.make_paraview_fields-848"><span class="linenos">848</span></a><span class="sd">        quantities are computed using the density-weighted constitutive law.</span>
</span><span id="IGAPatchDensity.make_paraview_fields-849"><a href="#IGAPatchDensity.make_paraview_fields-849"><span class="linenos">849</span></a>
</span><span id="IGAPatchDensity.make_paraview_fields-850"><a href="#IGAPatchDensity.make_paraview_fields-850"><span class="linenos">850</span></a><span class="sd">        The following fields are exported:</span>
</span><span id="IGAPatchDensity.make_paraview_fields-851"><a href="#IGAPatchDensity.make_paraview_fields-851"><span class="linenos">851</span></a><span class="sd">            - displacement `U`</span>
</span><span id="IGAPatchDensity.make_paraview_fields-852"><a href="#IGAPatchDensity.make_paraview_fields-852"><span class="linenos">852</span></a><span class="sd">            - strain tensor `epsilon`</span>
</span><span id="IGAPatchDensity.make_paraview_fields-853"><a href="#IGAPatchDensity.make_paraview_fields-853"><span class="linenos">853</span></a><span class="sd">            - density field `density`</span>
</span><span id="IGAPatchDensity.make_paraview_fields-854"><a href="#IGAPatchDensity.make_paraview_fields-854"><span class="linenos">854</span></a><span class="sd">            - stress tensor `sigma`</span>
</span><span id="IGAPatchDensity.make_paraview_fields-855"><a href="#IGAPatchDensity.make_paraview_fields-855"><span class="linenos">855</span></a><span class="sd">            - principal stresses `sigma_eig`</span>
</span><span id="IGAPatchDensity.make_paraview_fields-856"><a href="#IGAPatchDensity.make_paraview_fields-856"><span class="linenos">856</span></a><span class="sd">            - von Mises stress `von_mises`</span>
</span><span id="IGAPatchDensity.make_paraview_fields-857"><a href="#IGAPatchDensity.make_paraview_fields-857"><span class="linenos">857</span></a>
</span><span id="IGAPatchDensity.make_paraview_fields-858"><a href="#IGAPatchDensity.make_paraview_fields-858"><span class="linenos">858</span></a><span class="sd">        Parameters</span>
</span><span id="IGAPatchDensity.make_paraview_fields-859"><a href="#IGAPatchDensity.make_paraview_fields-859"><span class="linenos">859</span></a><span class="sd">        ----------</span>
</span><span id="IGAPatchDensity.make_paraview_fields-860"><a href="#IGAPatchDensity.make_paraview_fields-860"><span class="linenos">860</span></a><span class="sd">        U : np.ndarray[np.floating]</span>
</span><span id="IGAPatchDensity.make_paraview_fields-861"><a href="#IGAPatchDensity.make_paraview_fields-861"><span class="linenos">861</span></a><span class="sd">            Displacement field of shape (3, nb_ctrl_pts).</span>
</span><span id="IGAPatchDensity.make_paraview_fields-862"><a href="#IGAPatchDensity.make_paraview_fields-862"><span class="linenos">862</span></a><span class="sd">        XI : list[np.ndarray[np.floating]]</span>
</span><span id="IGAPatchDensity.make_paraview_fields-863"><a href="#IGAPatchDensity.make_paraview_fields-863"><span class="linenos">863</span></a><span class="sd">            Parametric coordinates [xi, eta, zeta] defining the evaluation grid.</span>
</span><span id="IGAPatchDensity.make_paraview_fields-864"><a href="#IGAPatchDensity.make_paraview_fields-864"><span class="linenos">864</span></a>
</span><span id="IGAPatchDensity.make_paraview_fields-865"><a href="#IGAPatchDensity.make_paraview_fields-865"><span class="linenos">865</span></a><span class="sd">        Returns</span>
</span><span id="IGAPatchDensity.make_paraview_fields-866"><a href="#IGAPatchDensity.make_paraview_fields-866"><span class="linenos">866</span></a><span class="sd">        -------</span>
</span><span id="IGAPatchDensity.make_paraview_fields-867"><a href="#IGAPatchDensity.make_paraview_fields-867"><span class="linenos">867</span></a><span class="sd">        fields : dict[str, np.ndarray[np.floating]]</span>
</span><span id="IGAPatchDensity.make_paraview_fields-868"><a href="#IGAPatchDensity.make_paraview_fields-868"><span class="linenos">868</span></a><span class="sd">            Dictionary of fields formatted for ParaView export.</span>
</span><span id="IGAPatchDensity.make_paraview_fields-869"><a href="#IGAPatchDensity.make_paraview_fields-869"><span class="linenos">869</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IGAPatchDensity.make_paraview_fields-870"><a href="#IGAPatchDensity.make_paraview_fields-870"><span class="linenos">870</span></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctrl_pts</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="IGAPatchDensity.make_paraview_fields-871"><a href="#IGAPatchDensity.make_paraview_fields-871"><span class="linenos">871</span></a>        <span class="n">epsilon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">XI</span><span class="p">)</span>
</span><span id="IGAPatchDensity.make_paraview_fields-872"><a href="#IGAPatchDensity.make_paraview_fields-872"><span class="linenos">872</span></a>        <span class="n">density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">XI</span><span class="p">)</span>
</span><span id="IGAPatchDensity.make_paraview_fields-873"><a href="#IGAPatchDensity.make_paraview_fields-873"><span class="linenos">873</span></a>        <span class="n">sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">(</span><span class="n">epsilon</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>
</span><span id="IGAPatchDensity.make_paraview_fields-874"><a href="#IGAPatchDensity.make_paraview_fields-874"><span class="linenos">874</span></a>        <span class="n">sigma_eig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_eig</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span>
</span><span id="IGAPatchDensity.make_paraview_fields-875"><a href="#IGAPatchDensity.make_paraview_fields-875"><span class="linenos">875</span></a>        <span class="n">von_mises</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">von_mises</span><span class="p">(</span><span class="n">sigma_eig</span><span class="p">)</span>
</span><span id="IGAPatchDensity.make_paraview_fields-876"><a href="#IGAPatchDensity.make_paraview_fields-876"><span class="linenos">876</span></a>        <span class="n">XI_shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">xi</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">XI</span><span class="p">)</span>
</span><span id="IGAPatchDensity.make_paraview_fields-877"><a href="#IGAPatchDensity.make_paraview_fields-877"><span class="linenos">877</span></a>        <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="IGAPatchDensity.make_paraview_fields-878"><a href="#IGAPatchDensity.make_paraview_fields-878"><span class="linenos">878</span></a>            <span class="s2">&quot;U&quot;</span><span class="p">:</span> <span class="n">u</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span>
</span><span id="IGAPatchDensity.make_paraview_fields-879"><a href="#IGAPatchDensity.make_paraview_fields-879"><span class="linenos">879</span></a>            <span class="s2">&quot;epsilon&quot;</span><span class="p">:</span> <span class="n">epsilon</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="n">XI_shape</span><span class="p">)),</span>
</span><span id="IGAPatchDensity.make_paraview_fields-880"><a href="#IGAPatchDensity.make_paraview_fields-880"><span class="linenos">880</span></a>            <span class="s2">&quot;density&quot;</span><span class="p">:</span> <span class="n">density</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">XI_shape</span><span class="p">)),</span>
</span><span id="IGAPatchDensity.make_paraview_fields-881"><a href="#IGAPatchDensity.make_paraview_fields-881"><span class="linenos">881</span></a>            <span class="s2">&quot;sigma&quot;</span><span class="p">:</span> <span class="n">sigma</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="o">*</span><span class="n">XI_shape</span><span class="p">)),</span>
</span><span id="IGAPatchDensity.make_paraview_fields-882"><a href="#IGAPatchDensity.make_paraview_fields-882"><span class="linenos">882</span></a>            <span class="s2">&quot;sigma_eig&quot;</span><span class="p">:</span> <span class="n">sigma_eig</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">*</span><span class="n">XI_shape</span><span class="p">)),</span>
</span><span id="IGAPatchDensity.make_paraview_fields-883"><a href="#IGAPatchDensity.make_paraview_fields-883"><span class="linenos">883</span></a>            <span class="s2">&quot;von_mises&quot;</span><span class="p">:</span> <span class="n">von_mises</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">XI_shape</span><span class="p">)),</span>
</span><span id="IGAPatchDensity.make_paraview_fields-884"><a href="#IGAPatchDensity.make_paraview_fields-884"><span class="linenos">884</span></a>        <span class="p">}</span>
</span><span id="IGAPatchDensity.make_paraview_fields-885"><a href="#IGAPatchDensity.make_paraview_fields-885"><span class="linenos">885</span></a>        <span class="k">return</span> <span class="n">fields</span>
</span></pre></div>


            <div class="docstring"><p>Generate ParaView fields including density-dependent quantities.</p>

<p>This method extends <code><a href="#IGAPatch.make_paraview_fields">IGAPatch.make_paraview_fields()</a></code> by adding
the interpolated density field and by ensuring that stress-related
quantities are computed using the density-weighted constitutive law.</p>

<p>The following fields are exported:
    - displacement <code>U</code>
    - strain tensor <code><a href="#IGAPatchDensity.epsilon">epsilon</a></code>
    - density field <code><a href="#IGAPatchDensity.density">density</a></code>
    - stress tensor <code><a href="#IGAPatchDensity.sigma">sigma</a></code>
    - principal stresses <code><a href="#IGAPatchDensity.sigma_eig">sigma_eig</a></code>
    - von Mises stress <code><a href="#IGAPatchDensity.von_mises">von_mises</a></code></p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>U</strong> (np.ndarray[np.floating]):
Displacement field of shape (3, nb_ctrl_pts).</li>
<li><strong>XI</strong> (list[np.ndarray[np.floating]]):
Parametric coordinates [xi, eta, zeta] defining the evaluation grid.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>fields</strong> (dict[str, np.ndarray[np.floating]]):
Dictionary of fields formatted for ParaView export.</li>
</ul>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#IGAPatch">IGAPatch</a></dt>
                                <dd id="IGAPatchDensity.spline" class="variable"><a href="#IGAPatch.spline">spline</a></dd>
                <dd id="IGAPatchDensity.ctrl_pts" class="variable"><a href="#IGAPatch.ctrl_pts">ctrl_pts</a></dd>
                <dd id="IGAPatchDensity.xi" class="variable"><a href="#IGAPatch.xi">xi</a></dd>
                <dd id="IGAPatchDensity.dxi" class="variable"><a href="#IGAPatch.dxi">dxi</a></dd>
                <dd id="IGAPatchDensity.eta" class="variable"><a href="#IGAPatch.eta">eta</a></dd>
                <dd id="IGAPatchDensity.deta" class="variable"><a href="#IGAPatch.deta">deta</a></dd>
                <dd id="IGAPatchDensity.zeta" class="variable"><a href="#IGAPatch.zeta">zeta</a></dd>
                <dd id="IGAPatchDensity.dzeta" class="variable"><a href="#IGAPatch.dzeta">dzeta</a></dd>
                <dd id="IGAPatchDensity.F_N" class="variable"><a href="#IGAPatch.F_N">F_N</a></dd>
                <dd id="IGAPatchDensity.H" class="variable"><a href="#IGAPatch.H">H</a></dd>
                <dd id="IGAPatchDensity.jacobian" class="function"><a href="#IGAPatch.jacobian">jacobian</a></dd>
                <dd id="IGAPatchDensity.grad_N" class="function"><a href="#IGAPatch.grad_N">grad_N</a></dd>
                <dd id="IGAPatchDensity.make_W" class="function"><a href="#IGAPatch.make_W">make_W</a></dd>
                <dd id="IGAPatchDensity.rhs" class="function"><a href="#IGAPatch.rhs">rhs</a></dd>
                <dd id="IGAPatchDensity.area_border" class="function"><a href="#IGAPatch.area_border">area_border</a></dd>
                <dd id="IGAPatchDensity.epsilon" class="function"><a href="#IGAPatch.epsilon">epsilon</a></dd>
                <dd id="IGAPatchDensity.sigma_eig" class="function"><a href="#IGAPatch.sigma_eig">sigma_eig</a></dd>
                <dd id="IGAPatchDensity.von_mises" class="function"><a href="#IGAPatch.von_mises">von_mises</a></dd>
                <dd id="IGAPatchDensity.save_paraview" class="function"><a href="#IGAPatch.save_paraview">save_paraview</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>